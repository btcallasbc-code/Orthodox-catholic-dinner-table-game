<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css" rel="stylesheet">

  <style>
    :root{
      --gold:#f59e0b;
      --gold-2:#d97706;
      --navy:#0f172a;
      --slate:#1e293b;
      --slate-2:#111827;
      --text:#e2e8f0;
      --muted:#cbd5e1;
      --border:rgba(180,83,9,0.35);
      --border-soft:rgba(148,163,184,0.18);
      --shadow:0 18px 45px rgba(0,0,0,0.34);
      --shadow-soft:0 10px 25px rgba(0,0,0,0.22);
      --r:16px;
      --r2:22px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0a0e27 100%);
      color: var(--text);
      min-height: 100vh;
    }

    /* Type scale */
    .page-title{
      color:#fcd34d;
      font-weight:900;
      letter-spacing:-0.01em;
      line-height:1.1;
      font-size:clamp(1.55rem, 2.4vw, 2.05rem);
      margin:0 0 0.85rem 0;
    }

    .header {
      background: linear-gradient(to right, #0f172a, #1e293b);
      border-bottom: 2px solid #b45309;
      padding: 1.25rem 1.5rem;
      position: static;
      z-index: 40;
    }
    @media (min-width: 769px) {
      .header { position: sticky; top: 0; }
    }
    .header h1 { font-size: 2rem; color: #fcd34d; margin-bottom: 0.25rem; font-weight: bold; }
    .header p { color: #cbd5e1; font-size: 0.9rem; }

    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding: 0.75rem 0 0.5rem;
      margin-top: 0.5rem;
      flex-wrap: nowrap;
      position: relative;
      z-index: 1000;
    }
    .nav-tab {
      padding: 0.5rem 1rem;
      background: #334155;
      color: #cbd5e1;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .nav-tab:hover { background: #475569; }
    .nav-tab.active { background: #b45309; color: #0f172a; }

    .container { max-width: 1200px; margin: 0 auto; padding: 1.25rem; }

    .content-section { display: none; }
    .content-section.active { display: block; animation: fadeIn 0.25s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(3px); } to { opacity: 1; transform: translateY(0); } }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.1rem; margin-bottom: 2rem; }

    /* Base cards */
    .card {
      background: linear-gradient(180deg, rgba(30,41,59,0.92), rgba(17,24,39,0.92));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.05rem 1.1rem;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.16);
      pointer-events:none;
      z-index:0;
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-120px -120px auto auto;
      width:260px;height:260px;
      background: radial-gradient(circle at 30% 30%, rgba(245,158,11,0.16), transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
      z-index:0;
    }
    .card > *{position:relative; z-index:2;}
    .card:hover { border-color: rgba(245,158,11,0.55); transform: translateY(-2px); box-shadow: 0 18px 45px rgba(0,0,0,0.38); }

    .card-h3{color:var(--gold); font-weight:900; letter-spacing:-0.01em; font-size:1.05rem;}
    .card-text { color: #cbd5e1; font-size: 0.96rem; margin-top: 0.65rem; line-height: 1.65; }
    .card-subtitle{color:rgba(245,158,11,0.82); font-size:0.86rem; margin-top:0.45rem;}

    .search-box, .filter-select {
      padding: 0.75rem 1rem;
      background: #0f172a;
      border: 1px solid rgba(180,83,9,0.38);
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
      border-radius: 0.5rem;
      color: #fcd34d;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .search-box::placeholder { color: #92400e; }
    .search-box:focus, .filter-select:focus { outline: none; border-color: rgba(245,158,11,0.7); background: #111827; }

    .filter-select { display: inline-block; width: auto; margin-right: 0.75rem; }
    .filter-select option { background: #0f172a; color: #fcd34d; }

    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: bold; margin-right: 0.5rem; margin-bottom: 0.5rem; }
    .badge-catholic { background: #92400e; color: #fef3c7; }
    .badge-orthodox { background: #1e40af; color: #bfdbfe; }
    .badge-both { background: #6b21a8; color: #e9d5ff; }
    .badge-topic { background: #0b3b60; color: #bfdbfe; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:0.35rem;
      padding:0.2rem 0.6rem;
      border-radius:999px;
      background:#111827;
      border:1px solid rgba(148,163,184,0.22);
      color:#cbd5e1;
      font-size:0.78rem;
      font-weight:700;
    }

    .context-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-bottom: 1.25rem; border-radius: 0.25rem; }
    .context-label { color: #86efac; font-weight: bold; font-size: 0.9rem; }

    .shared-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-top: 1rem; border-radius: 0.25rem; }
    .shared-label { color: #86efac; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem; }

    .proto-note { background: #064e3b; border-left: 4px solid #10b981; padding: 0.75rem; margin-bottom: 1rem; border-radius: 0.25rem; color: #86efac; font-size: 0.85rem; }

    .fun-fact { background: #1e40af; border-left: 4px solid #60a5fa; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #bfdbfe; }
    .fun-fact-title { font-weight: bold; margin-bottom: 0.5rem; }

    .kid-friendly { background: #92400e; border-left: 4px solid #fbbf24; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #fef3c7; }
    .kid-friendly-title { font-weight: bold; margin-bottom: 0.5rem; }

    .story-box { background: #0a0e27; border-left: 4px solid #10b981; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; }
    .story-title { color: #86efac; font-weight: bold; margin-bottom: 0.5rem; }

    /* Buttons */
    .btn {
      background: #b45309;
      color: #0f172a;
      border: none;
      padding: 0.65rem 1rem;
      border-radius: 0.65rem;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .btn:hover { background: #d97706; transform: translateY(-1px); }
    .btn:active { transform: translateY(0px) scale(0.98); }
    .btn.secondary { background: #334155; color: #e2e8f0; font-weight: 700; border:1px solid rgba(148,163,184,0.18);}
    .btn.secondary:hover { background: #475569; }
    .btn.secondary:active { transform: translateY(0px) scale(0.985); }

    .tiny { font-size: 0.85rem; color: #cbd5e1; opacity: 0.95; }

    /* Dinner Tool deck */
    .deck-wrap{display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-start;}
    .deck-visual{position:relative;width:170px;height:120px;flex:0 0 auto;}
    .deck-card{position:absolute;inset:0;border-radius:18px;background:#0f172a;border:1px solid rgba(148,163,184,0.25);box-shadow:0 12px 30px rgba(0,0,0,0.35);}
    .deck-card.one{transform:rotate(-8deg) translateX(-6px);opacity:0.9;}
    .deck-card.two{transform:rotate(4deg) translateX(10px) translateY(2px);opacity:0.95;}
    .deck-card.three{transform:rotate(-1deg) translateY(6px);}

    .game-stage{
      flex:1;
      min-width:280px;
      display:grid;
      grid-template-columns: 1fr 240px;
      gap:0.85rem;
      align-items:start;
    }
    .game-actions{
      display:flex;
      flex-direction:column;
      gap:0.5rem;
      align-items:stretch;
    }
    .game-actions .btn{width:100%;}
    .hintline{color:#94a3b8;font-size:0.85rem;margin-top:0.35rem;}

    @media (max-width: 768px){
      .header { padding: 0.9rem 1rem; }
      .header h1 { font-size: 1.35rem; }
      .header p { display: none; }
      .container { padding: 1rem; }
      .grid { grid-template-columns: 1fr; }
      .game-stage{grid-template-columns:1fr;}
      .game-actions{flex-direction:row;flex-wrap:wrap;}
      .game-actions .btn{width:auto;}
      .deck-visual{width:140px;height:104px;}
    }

    /* Reliable ‚Äúflip‚Äù (no 3D): swap animation */
    .flip{position:relative;width:100%;min-height:270px;}
    .face{
      position:absolute; inset:0;
      border-radius:24px;
      padding:1.1rem 1.1rem 1rem;
      background:
        radial-gradient(1200px 420px at 20% 0%, rgba(59,130,246,0.18), transparent 55%),
        radial-gradient(900px 360px at 90% 30%, rgba(245,158,11,0.16), transparent 55%),
        #0f172a;
      border:1px solid rgba(148,163,184,0.25);
      box-shadow:0 22px 55px rgba(0,0,0,0.42);
      overflow:hidden;
    }
    .face::before{content:"";position:absolute;inset:12px;border-radius:18px;border:1px solid rgba(148,163,184,0.16);pointer-events:none;z-index:0;}
    .face::after{content:"";position:absolute;left:-40px;top:-60px;width:220px;height:220px;background:radial-gradient(circle at 30% 30%, rgba(56,189,248,0.14), transparent 60%);pointer-events:none;z-index:0;}
    .face > *{position:relative;z-index:2;}

    .face.front{opacity:1; transform:translateX(0); transition:opacity .22s ease, transform .22s ease;}
    .face.back{opacity:0; transform:translateX(10px); transition:opacity .22s ease, transform .22s ease; pointer-events:none; overflow:auto;}

    .flip.flipped .face.front{opacity:0; transform:translateX(-10px); pointer-events:none;}
    .flip.flipped .face.back{opacity:1; transform:translateX(0); pointer-events:auto;}

    .face .kicker{color:#f59e0b;font-weight:900;font-size:0.9rem;letter-spacing:0.02em;}
    .face .q{margin-top:0.55rem;font-size:1.12rem;line-height:1.45;color:#e2e8f0;}
    .face .meta{margin-top:0.75rem;display:flex;gap:0.5rem;flex-wrap:wrap;}

    /* Culture card skin */
    #flipCard[data-topic="Culture"] .face{
      background:
        radial-gradient(1100px 420px at 15% 0%, rgba(168,85,247,0.18), transparent 55%),
        radial-gradient(900px 360px at 90% 35%, rgba(34,211,238,0.14), transparent 60%),
        #0b1020;
      border-color: rgba(168,85,247,0.45);
    }
    #flipCard[data-topic="Culture"] .kicker{color:#c4b5fd;}
    #flipCard[data-topic="Culture"] .pill{border-color:rgba(196,181,253,0.25);}

    /* Micro-animations */
    @keyframes dealPop { 0%{transform:translateY(10px) scale(0.98); opacity:0.6;} 60%{transform:translateY(-2px) scale(1.01); opacity:1;} 100%{transform:translateY(0) scale(1);} }
    .deal-animate { animation: dealPop 260ms ease-out; }
    @keyframes softPulse { 0%{transform:scale(1);} 40%{transform:scale(1.01);} 100%{transform:scale(1);} }
    .pulse-animate { animation: softPulse 320ms ease-out; }

    /* Modal */
    .modal-overlay {
      display: none;
      pointer-events: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 50;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: 1.25rem;
    }
    .modal-overlay.active { display: flex; pointer-events: auto; }
    .modal {
      background: #0f172a;
      border: 1px solid rgba(245,158,11,0.5);
      border-radius: var(--r2);
      padding: 1.75rem;
      max-width: 960px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      margin: auto;
      box-shadow: var(--shadow);
    }
    .modal-close { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; color: #b45309; font-size: 1.6rem; cursor: pointer; }
    .modal-close:hover { color: #d97706; }
    .modal h2 { color: #fcd34d; margin-bottom: 0.75rem; font-size: 1.55rem; font-weight: 900; }
    .modal h3 { color: #f59e0b; margin-top: 1.1rem; margin-bottom: 0.6rem; font-size: 1.12rem; font-weight: 800; }
    .modal p { color: #cbd5e1; margin-bottom: 0.75rem; line-height: 1.7; }

  </style>
</head>

<body>
  <div class="header">
    <h1>üçΩÔ∏è Dinner Table Conversations</h1>
    <p>Orthodox & Catholic Christians in deep dialogue over shared meals ‚Äî respectful, lively, and real.</p>

    <div class="nav-tabs" role="tablist" aria-label="Navigation">
      <button class="nav-tab active" onclick="switchTab(event, 'home')">Home</button>
      <button class="nav-tab" onclick="switchTab(event, 'dinner')">Dinner Tool</button>
      <button class="nav-tab" onclick="switchTab(event, 'conversations')">Conversations</button>
      <button class="nav-tab" onclick="switchTab(event, 'commandments')">10 Commandments</button>
      <button class="nav-tab" onclick="switchTab(event, 'rituals')">Rituals & Signs</button>
      <button class="nav-tab" onclick="switchTab(event, 'practices')">Church Practices</button>
      <button class="nav-tab" onclick="switchTab(event, 'saints')">Saints</button>
      <button class="nav-tab" onclick="switchTab(event, 'culture')">Culture Cues</button>
      <button class="nav-tab" onclick="switchTab(event, 'foundations')">Core Differences</button>
      <button class="nav-tab" onclick="switchTab(event, 'theology')">Theology Deep Dives</button>
      <button class="nav-tab" onclick="switchTab(event, 'history')">History</button>
      <button class="nav-tab" onclick="switchTab(event, 'prayers')">Prayers</button>
    </div>
  </div>

  <div class="container">

    <!-- HOME -->
    <section id="home" class="content-section active" role="tabpanel">
      <h2 class="page-title">Welcome to the Table</h2>
      <div class="context-box">
        <div class="context-label">üìñ About This App</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">
          This app helps Christians have better dinner conversations‚Äîcurious, warm, and truthful.
          Explore what divides Orthodox and Catholic traditions, what unites them, and why practices matter.
        </p>
      </div>

      <div class="grid">
        <div class="card" onclick="switchTab(null,'dinner');">
          <h3 class="card-h3">üé≤ Dinner Tool</h3>
          <p class="card-text">Draw a card, flip for the answer, and keep it kind with bridge phrases.</p>
          <p class="card-subtitle">Deck + flip ‚Ä¢ Rapid Fire Culture ‚Ä¢ Deep Dive mode</p>
        </div>
        <div class="card" onclick="switchTab(null,'conversations');">
          <h3 class="card-h3">üó£Ô∏è Real Conversations</h3>
          <p class="card-text">Dialogue scenes you can borrow at the table.</p>
          <p class="card-subtitle">Tap a card to open the full scene.</p>
        </div>
        <div class="card" onclick="switchTab(null,'culture');">
          <h3 class="card-h3">‚ö° Culture Cues</h3>
          <p class="card-text">Family Feud ‚ÄúTop 7‚Äù habits that matter (Mass vs Liturgy, crossing, coffee hour‚Ä¶).</p>
        </div>
        <div class="card" onclick="switchTab(null,'saints');">
          <h3 class="card-h3">‚ú® Saints ‚Äî Helps With‚Ä¶</h3>
          <p class="card-text">Search saints by what they help with (patronage), plus story + notes.</p>
        </div>
      </div>

      <div class="proto-note">Tip: Aim for truth + love. ‚ÄúHelp me understand‚Äù beats ‚ÄúLet me prove you wrong.‚Äù</div>
    </section>

    <!-- DINNER -->
    <section id="dinner" class="content-section" role="tabpanel">
      <h2 class="page-title">üé≤ Dinner Conversation Tool</h2>

      <div class="context-box">
        <div class="context-label">üç∑ How to Use This</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">
          Choose a <strong>topic</strong> + <strong>vibe</strong>. Tap <strong>Draw</strong> to deal a card.
          Tap <strong>Flip</strong> to reveal answer + bridge + follow-up. Turn on <strong>Deep Dive</strong> for extra notes.
        </p>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="dTopic" class="filter-select" onchange="updateDinnerStats()">
          <option value="Any">Any Topic</option>
          <option value="Authority">Authority</option>
          <option value="Mary">Mary</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Lent">Lent</option>
          <option value="Prayer">Prayer</option>
          <option value="Icons">Icons</option>
          <option value="History">History</option>
          <option value="DailyLife">Daily Life</option>
          <option value="Culture">Culture (quick cues)</option>
          <option value="Deep Theology">Deep Theology (Level 2)</option>
        </select>

        <select id="dVibe" class="filter-select" onchange="updateDinnerStats()">
          <option value="Gentle">Gentle (curious)</option>
          <option value="Lively">Lively (honest)</option>
          <option value="Spicy">Spicy (respectful debate)</option>
        </select>

        <select id="dKids" class="filter-select" onchange="updateDinnerStats()">
          <option value="No">Adults only</option>
          <option value="Yes">Kids present</option>
        </select>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="deepDiveToggle" type="checkbox" style="width:16px; height:16px; accent-color:#38bdf8;" />
          Deep Dive
        </label>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="soundToggle" type="checkbox" style="width:16px; height:16px; accent-color:#f59e0b;" />
          Sound
        </label>
      </div>

      <div class="tiny" id="dStats"></div>

      <div class="card" style="cursor:default;" aria-live="polite">
        <h3 class="card-h3">üé¥ Dinner Card Deck</h3>

        <div class="deck-wrap" style="margin-top:0.85rem;">
          <div class="deck-visual" aria-hidden="true">
            <div class="deck-card one"></div>
            <div class="deck-card two"></div>
            <div class="deck-card three"></div>
          </div>

          <div class="game-stage">
            <div class="game-card" id="gameCard">
              <div class="flip" id="flipCard" data-topic="">
                <div class="face front">
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:0.75rem;">
                    <div class="kicker" id="frontKicker">Ready</div>
                    <div class="pill" id="cardCounter" style="opacity:0.95;">Card 0 / 0</div>
                  </div>
                  <div class="q" id="frontQ">Tap <strong>Draw</strong> to deal a card.</div>
                  <div class="meta" id="frontMeta"></div>
                  <div class="hintline">Swipe left for next ‚Ä¢ Swipe right for previous ‚Ä¢ Tap Flip for answer</div>
                </div>

                <div class="face back">
                  <div class="kicker" id="backKicker">Answer</div>
                  <div id="backBody" style="color:#cbd5e1; line-height:1.7;"></div>
                </div>
              </div>
            </div>

            <div class="game-actions">
              <button class="btn" onclick="drawDinnerCard()">üÉè Draw</button>
              <button class="btn secondary" onclick="flipDinnerCard()">üîÑ Flip</button>
              <button class="btn secondary" onclick="prevDinnerCard()">‚¨ÖÔ∏è Back</button>
              <button class="btn secondary" onclick="nextDinnerCard()">‚û°Ô∏è Next</button>
              <button class="btn secondary" onclick="rapidFireCulture()">‚ö° Rapid Fire (Top 7)</button>
              <button class="btn secondary" onclick="deescalate()">üßä De-escalate</button>
              <button class="btn secondary" onclick="endWithPrayer()">üôè End with Prayer</button>
            </div>
          </div>
        </div>
      </div>

      <div class="grid" style="margin-top:1.25rem;">
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">House Rules</h3>
          <ul class="card-text" style="margin-top:0.75rem; list-style:disc; padding-left:1.25rem;">
            <li>Assume goodwill. Ask before you argue.</li>
            <li>Speak in ‚ÄúI‚Äù statements. No labels.</li>
            <li>Steelman the other side: repeat it fairly first.</li>
            <li>One claim at a time. Don‚Äôt stack 12 issues.</li>
            <li>End with what you share: Jesus is Lord.</li>
          </ul>
        </div>
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">Quick Rescues</h3>
          <div class="card-text" style="margin-top:0.75rem;">
            <p><strong>When it gets hot:</strong> ‚ÄúI think we‚Äôre both protecting something sacred. Can we slow down?‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When someone feels attacked:</strong> ‚ÄúThat came out sharper than I meant. Let me restate it.‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When stuck:</strong> ‚ÄúWhat do we both agree is true about Christ here?‚Äù</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CONVERSATIONS -->
    <section id="conversations" class="content-section" role="tabpanel">
      <h2 class="page-title">Dinner Table Conversations</h2>
      <input type="text" id="convSearch" class="search-box" placeholder="Search conversations by title, topic, or keyword..." onkeyup="renderConversations()">
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="convTopic" class="filter-select" onchange="renderConversations()">
          <option value="All">All Topics</option>
          <option value="Sign of the Cross">Sign of the Cross</option>
          <option value="Holy Water Blessing">Holy Water</option>
          <option value="Religious Art">Icons/Statues</option>
          <option value="Mass Obligation">Attendance</option>
          <option value="Saints and Nature">Saints & Nature</option>
          <option value="Filioque">Filioque</option>
          <option value="Purgatory">Purgatory</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Divorce">Marriage/Divorce</option>
        </select>
        <span class="tiny" id="convCount"></span>
        <button class="btn secondary" style="margin-left:auto;" onclick="dealRandomConversation()">üé≤ Deal a Conversation</button>
      </div>
      <div id="conversationsGrid" class="grid"></div>
    </section>

    <!-- COMMANDMENTS -->
    <section id="commandments" class="content-section" role="tabpanel">
      <h2 class="page-title">The Ten Commandments</h2>
      <div class="context-box">
        <div class="context-label">üìú Mount Sinai & Freedom</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">These commandments weren‚Äôt random rules. They were a covenant‚Äîhow to live free after slavery.</p>
      </div>
      <div id="commandmentsGrid"></div>
    </section>

    <!-- RITUALS -->
    <section id="rituals" class="content-section" role="tabpanel">
      <h2 class="page-title">Rituals & Signs</h2>
      <div class="proto-note">Visible gestures reveal deep theology. Every object and movement teaches something.</div>
      <div id="ritualsGrid"></div>
    </section>

    <!-- PRACTICES -->
    <section id="practices" class="content-section" role="tabpanel">
      <h2 class="page-title">Church Practices</h2>
      <p style="color:#cbd5e1; margin-bottom:1rem;">Practices aren‚Äôt arbitrary. They express what each church believes worship does to the human person.</p>
      <div id="practicesGrid" class="grid"></div>
    </section>

    <!-- SAINTS -->
    <section id="saints" class="content-section" role="tabpanel">
      <h2 class="page-title">Saints</h2>
      <div class="proto-note">Search by ‚ÄúHelps with‚Ä¶‚Äù (patronage). Tap a chip for quick filters.</div>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center;">
        <label style="color:#fcd34d; font-weight:700;">Filter:</label>
        <select id="tradFilter" class="filter-select" onchange="renderSaints()">
          <option value="All">All Traditions</option>
          <option value="Both">Both Orthodox & Catholic</option>
          <option value="Catholic">Catholic Saints</option>
          <option value="Orthodox">Orthodox Saints</option>
        </select>
        <input type="text" id="saintSearch" class="search-box" style="margin-bottom:0; flex:1; min-width:260px;"
               placeholder="Search saints by name, role, patronage (what they help with), story‚Ä¶" onkeyup="renderSaints()">
      </div>

      <div class="tiny" id="saintsCount" style="margin-top:0.75rem;"></div>

      <div style="margin-top:0.6rem; display:flex; flex-wrap:wrap; gap:0.5rem; align-items:center;">
        <div id="saintChips" style="display:flex; flex-wrap:wrap; gap:0.5rem;"></div>
        <button class="btn secondary" style="margin-left:auto;" onclick="randomSaint()">üé≤ Random Saint</button>
      </div>

      <div id="saintsGrid" class="grid" style="margin-top:0.75rem;"></div>
    </section>

    <!-- CULTURE -->
    <section id="culture" class="content-section" role="tabpanel">
      <h2 class="page-title">Culture Cues</h2>
      <div class="context-box">
        <div class="context-label">üè† Little things that matter</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">Tap a card to reveal ‚ÄúTop 7‚Äù (Family Feud style).</p>
      </div>
      <div id="cultureGrid" class="grid"></div>
    </section>

    <!-- FOUNDATIONS -->
    <section id="foundations" class="content-section" role="tabpanel">
      <h2 class="page-title">Core Differences</h2>
      <div id="foundationsGrid" class="grid"></div>
    </section>

    <!-- THEOLOGY -->
    <section id="theology" class="content-section" role="tabpanel">
      <h2 class="page-title">Theology Deep Dives</h2>
      <div id="theologyGrid" class="grid"></div>
    </section>

    <!-- HISTORY -->
    <section id="history" class="content-section" role="tabpanel">
      <h2 class="page-title">History Moments</h2>
      <div id="historyGrid" class="grid"></div>
    </section>

    <!-- PRAYERS -->
    <section id="prayers" class="content-section" role="tabpanel">
      <h2 class="page-title">Prayers We Share</h2>
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <button class="btn" onclick="prayNow()">üôè Pray Now</button>
        <span class="tiny">(opens a prayer card)</span>
      </div>
      <div id="prayersGrid" class="grid"></div>
    </section>

  </div>

  <div class="footer" style="border-top:2px solid #b45309;padding:1.5rem;text-align:center;color:#b45309;font-size:0.9rem;margin-top:2rem;">
    Dinner Table Conversations ‚Ä¢ Ecumenical Learning Through Honest Dialogue ‚Ä¢ 2026
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    "use strict";

    /* ---------------------------
       Helpers / micro-interactions
    --------------------------- */
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function playClick(){
      const t = document.getElementById('soundToggle');
      const on = !!(t && t.checked);
      if (!on) return;
      try {
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if (!Ctx) return;
        const ctx = new Ctx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 520;
        g.gain.value = 0.05;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(()=>{ o.stop(); if (ctx.close) ctx.close(); }, 55);
      } catch(e) {}
    }

    function haptic(){
      try { if (navigator.vibrate) navigator.vibrate(12); } catch(e) {}
    }

    function animateOnce(el, cls){
      if (!el) return;
      el.classList.remove(cls);
      void el.offsetWidth;
      el.classList.add(cls);
    }

    function emptyState(message) {
      return `<div style="grid-column:1 / -1; color:#cbd5e1; opacity:0.95; background:#0f172a; border:1px solid #334155; padding:1rem; border-radius:0.75rem;">${message}</div>`;
    }

    /* ---------------------------
       Navigation
    --------------------------- */
    function switchTab(event, tab) {
      document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
      const target = document.getElementById(tab);
      if (target) target.classList.add('active');
      if (event && event.target) event.target.classList.add('active');

      if (tab === 'conversations') renderConversations();
      if (tab === 'commandments') renderCommandments();
      if (tab === 'rituals') renderRituals();
      if (tab === 'practices') renderPractices();
      if (tab === 'saints') renderSaints();
      if (tab === 'culture') renderCulture();
      if (tab === 'foundations') renderFoundations();
      if (tab === 'theology') renderTheology();
      if (tab === 'history') renderHistory();
      if (tab === 'prayers') renderPrayers();
      if (tab === 'dinner') updateDinnerStats();
    }
    window.switchTab = switchTab;

    /* ---------------------------
       DATA (trimmed sample saints list kept from your current state)
       If you want all 131, we can swap saintsPacked to the full file next.
    --------------------------- */

    const saintsPacked = [
      [1,"Saint Aelred of Rievaulx","Both","Mystic ‚Ä¢ Medieval","January 12","Friendship, Spiritual companionship, Loneliness, Community, Monks","Aelred was a Cistercian monk known for his writings on friendship.","Aelred followed Jesus as a mystic.","Integrated spiritual theology with relational depth."],
      [2,"Saint Alphonsa of the Immaculate Conception","Catholic","Healer ‚Ä¢ Modern","July 28","Respiratory illness","Alphonsa was an Indian nun who suffered chronic illness.","Alphonsa followed Jesus as a healer.","First female saint of Indian origin canonized."],
      [3,"Saint Anthony the Great","Both","Monk ‚Ä¢ Early","January 17","Monks, Hermits","Anthony is called the father of monasticism.","Anthony followed Jesus as a monk.","Father of monasticism."],
      [4,"Saint Monica","Both","Mystic ‚Ä¢ Early","August 27","Mothers, Difficult children","Monica prayed for Augustine‚Äôs conversion for years.","Monica prayed with perseverance.","Model of persevering prayer."],
      [5,"Saint Nektarios of Aegina","Orthodox","Healer ‚Ä¢ Modern","November 9","Cancer, Healing","Nektarios endured hardship and is invoked for healing.","Ask God for healing and strength.","Modern miracle-working saint."],
      [6,"Saint Agatha of Sicily","Both","Martyr ‚Ä¢ Early","February 5","Breast cancer, Women‚Äôs health, Nurses","Agatha is widely invoked for breast disease and women‚Äôs health.","Ask her prayers for healing and courage.","Patron for breast disease in popular devotion."],
      [7,"Saint Peregrine Laziosi","Catholic","Healer ‚Ä¢ Medieval","May 4","Cancer, Serious illness","Peregrine is associated in popular devotion with healing from cancer.","Ask for hope and strength.","Often invoked for cancer."],
      [8,"Saint Carlo Acutis","Catholic","Witness ‚Ä¢ Modern","October 12","Internet, Technology, Youth","Carlo used technology to share Eucharistic devotion.","Use screens for good.","Often invoked for digital life."],
      [9,"Saint Josephine Bakhita","Catholic","Witness ‚Ä¢ Modern","February 8","Human trafficking, Trauma healing","Bakhita survived slavery; honored for dignity and healing.","God can heal deep wounds.","Patron for trafficking survivors."],
      [10,"Saint Paisios of Mount Athos","Orthodox","Healer ‚Ä¢ Modern","July 12","Serious illness, Spiritual direction","Paisios is beloved for compassion and counsel.","Love people and pray.","Beloved modern Athonite monk."]
    ];

    const saintsRaw = saintsPacked.map(row => ({
      id: row[0], name: row[1], tradition: row[2], role: row[3], feast: row[4],
      patronage: row[5], story: row[6], kidFriendly: row[7], interestingFact: row[8],
    }));

    const saints = saintsRaw
      .sort((a,b) => (a.name||'').localeCompare(b.name||''))
      .map((s, idx) => ({ ...s, id: idx + 1 }));

    const rituals = [
      {id:1,name:'The Sign of the Cross',icon:'‚úùÔ∏è',
        catholic:'Made left to right (forehead, chest, left shoulder, right shoulder).',
        orthodox:'Made right to left with finger symbolism for Trinity + Incarnation.',
        meaning:'Both confess Trinity and Christ‚Äôs redemption.',
        history:'Direction differs by custom across East/West.'},
      {id:2,name:'Icons vs. Statues',icon:'üñºÔ∏è',
        catholic:'Icons and statues are both used; statues are common in the West.',
        orthodox:'Icons are central in worship life; statues are rare in liturgical space.',
        meaning:'Icons are ‚Äúwindows to heaven,‚Äù tied to the Incarnation.',
        history:'Icon controversy clarified icon theology.'}
    ];

    const conversations = [
      {id:1,title:'Why Do You Make the Cross Backwards?',topic:'Sign of the Cross',tags:['Gesture','Trinity'],speakers:['Orthodox','Catholic'],
        context:'At a service, someone notices the different direction of crossing.',
        exchange:[
          {speaker:'Catherine',role:'Catholic',icon:'‚úùÔ∏è',speech:'‚ÄúIs that wrong?‚Äù'},
          {speaker:'Father Dimitri',role:'Orthodox',icon:'‚ò¶Ô∏è',speech:'‚ÄúDifferent traditions; same Trinity.‚Äù'}
        ]},
      {id:2,title:'Purgatory: Healing After Death?',topic:'Purgatory',tags:['Afterlife'],speakers:['Orthodox','Catholic'],
        context:'Why Catholics define purgatory and Orthodox often avoid tight definitions.',
        exchange:[
          {speaker:'Maria',role:'Catholic',icon:'‚úùÔ∏è',speech:'‚ÄúGod finishes His healing.‚Äù'},
          {speaker:'Yannis',role:'Orthodox',icon:'‚ò¶Ô∏è',speech:'‚ÄúWe pray for the departed, but guard mystery.‚Äù'}
        ]}
    ];

    const commandments = [
      {num:'1st',catholic:'‚ÄúThou shalt have no other gods before Me.‚Äù',origin:'Mount Sinai covenant freedom.',why:'Protects the heart from idols.',deeper:'Anything ultimate becomes an idol.',kidExplanation:'If it bosses your heart, it‚Äôs becoming an idol.'}
    ];

    const practices = [
      {id:1,title:'Confession: Booth vs. Icon',category:'Practice',content:'Catholics often confess privately and receive a penance. Orthodox confession is often face-to-face (often before an icon); the priest commonly places the stole over the penitent‚Äôs head and prays absolution.'}
    ];

    const foundations = [
      {id:1,title:'Authority: Pope vs. Councils',icon:'üëë',description:'How binding decisions are made.',deepDive:'CATHOLIC: Papal infallibility under specific conditions.\\n\\nORTHODOX: Councils discern together.\\n\\nDINNER TIP: Ask about safeguards.'}
    ];

    const theologyTopics = [
      {id:1,title:'Mary: Different Frameworks',question:'Why the framing differs.',catholicView:'Defined dogma in the West.',orthodoxView:'Different sin framework; caution about late definitions.',sharedTruth:'Both honor Mary as Theotokos.'}
    ];

    const historyMoments = [
      {id:1,title:'One Church, Many Cultures',year:'33‚Äì1054',story:'Unity amid diversity before tensions hardened.'}
    ];

    const prayers = [
      {id:1,title:"The Lord's Prayer",text:'Our Father... Amen.'},
      {id:2,title:"Jesus Prayer",text:'Lord Jesus Christ, Son of God, have mercy on me, a sinner.'}
    ];

    const dinnerDeck = [
      { topic:'Authority', vibe:'Gentle', kids:'No',
        q:'When you hear ‚ÄúChurch authority,‚Äù what do you hope it protects‚Äîand what do you fear it can harm?',
        ans:'Healthy authority protects the Gospel and unity without becoming control.',
        bridge:'I‚Äôm not trying to win‚Äî I want to understand what you‚Äôre protecting.',
        follow:'What safeguards keep leaders humble and faithful?' },
      { topic:'Lent', vibe:'Gentle', kids:'Yes',
        q:'What is one Lenten practice that actually makes you kinder?',
        ans:'If fasting makes you harsher, simplify. The goal is love.',
        bridge:'Let‚Äôs focus on fruit: love, humility, patience.',
        follow:'What‚Äôs one small act of mercy you can do this week?' }
    ];

    const cultureCards = [
      { title:'Mass vs Divine Liturgy', q:'Top 7 words you‚Äôll hear.', top7:[
        'Mass (Catholic, esp. Latin Rite)',
        'Divine Liturgy (Orthodox)',
        'Liturgy (Orthodox shorthand)',
        'Vespers (evening prayer)',
        'Orthros/Matins (morning prayer)',
        'Holy Mysteries (Orthodox)',
        'Sacraments (Catholic)'
      ], quick:'If you‚Äôre visiting a Greek parish, say ‚ÄúDivine Liturgy.‚Äù' }
    ];

    const cultureDinnerDeck = (() => {
      const vibes = ['Gentle','Lively','Spicy'];
      return vibes.flatMap(v => cultureCards.map(c => ({
        topic:'Culture', vibe:v, kids:'No',
        q:`${c.title} ‚Äî ${c.q}`,
        ans:c.quick,
        bridge:'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow:'What‚Äôs the story behind it in your family?',
        deep:`<div><strong>Top 7:</strong><ol style="padding-left:1.25rem;margin-top:0.5rem;line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      })));
    })();

    const deescalations = [
      'Let‚Äôs pause. I think we‚Äôre both trying to honor Christ. Can we slow down and restate gently?'
    ];

    const unityPrayers = [
      'Lord Jesus Christ, make us one in truth and love. Heal our pride, deepen our repentance, and teach us to listen. Amen.'
    ];

    /* ---------------------------
       Renderers
    --------------------------- */
    function renderConversations() {
      const grid = document.getElementById('conversationsGrid');
      const search = (document.getElementById('convSearch')?.value || '').toLowerCase();
      const topic = document.getElementById('convTopic')?.value || 'All';

      const filtered = conversations.filter(c => {
        const matchTopic = topic === 'All' || c.topic === topic;
        const hay = (c.title + ' ' + c.topic + ' ' + (c.tags||[]).join(' ') + ' ' + c.context).toLowerCase();
        return matchTopic && (!search || hay.includes(search));
      });

      const count = document.getElementById('convCount');
      if (count) count.textContent = `${filtered.length} conversation${filtered.length===1?'':'s'}`;

      if (!filtered.length) {
        grid.innerHTML = emptyState('No conversations match your search.');
        return;
      }

      grid.innerHTML = filtered.map(c => `
        <div class="card" onclick="openModal(event,'conv-${c.id}')">
          <h3 class="card-h3">${escapeHtml(c.title)}</h3>
          <div style="margin-top:0.5rem;">
            <span class="badge badge-topic">${escapeHtml(c.topic)}</span>
          </div>
          <p class="card-text">${escapeHtml(c.context)}</p>
        </div>
      `).join('');
    }

    function renderCommandments() {
      const container = document.getElementById('commandmentsGrid');
      container.innerHTML = commandments.map(cmd => `
        <div class="card" onclick="openModal(event,'cmd-${cmd.num}')">
          <h3 class="card-h3">${cmd.num} Commandment</h3>
          <p class="card-text">${escapeHtml(cmd.catholic)}</p>
        </div>
      `).join('');
    }

    function renderRituals() {
      const container = document.getElementById('ritualsGrid');
      container.innerHTML = rituals.map(r => `
        <div class="card" onclick="openModal(event,'rit-${r.id}')">
          <h3 class="card-h3">${r.icon} ${escapeHtml(r.name)}</h3>
          <p class="card-text"><strong>Catholic:</strong> ${escapeHtml(r.catholic)}</p>
        </div>
      `).join('');
    }

    function renderPractices() {
      const grid = document.getElementById('practicesGrid');
      grid.innerHTML = practices.map(p => `
        <div class="card" onclick="openModal(event,'prac-${p.id}')">
          <h3 class="card-h3">${escapeHtml(p.title)}</h3>
          <p class="card-subtitle">Category: ${escapeHtml(p.category)}</p>
          <p class="card-text">${escapeHtml(p.content)}</p>
        </div>
      `).join('');
    }

    function renderSaints() {
      const grid = document.getElementById('saintsGrid');
      const search = (document.getElementById('saintSearch')?.value || '').toLowerCase();
      const trad = document.getElementById('tradFilter')?.value || 'All';

      const filtered = saints.filter(s => {
        const hay = ((s.name||'')+' '+(s.role||'')+' '+(s.patronage||'')+' '+(s.story||'')).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        const matchTrad = trad === 'All' || s.tradition === trad;
        return matchSearch && matchTrad;
      });

      const count = document.getElementById('saintsCount');
      if (count) count.textContent = `${filtered.length} saint${filtered.length===1?'':'s'}`;

      const chipWrap = document.getElementById('saintChips');
      if (chipWrap && !chipWrap.__built) {
        const chips = ['Cancer','Breast cancer','Anxiety','Sleep','Grief','Mothers','Students','Work','Protection','Healing'];
        chipWrap.innerHTML = chips.map(t => `<button class="pill" style="cursor:pointer;" onclick="setSaintSearch('${t.replace(/'/g,"\\'")}')">${t}</button>`).join('');
        chipWrap.__built = true;
      }

      if (!filtered.length) {
        grid.innerHTML = emptyState('No saints match that search.');
        return;
      }

      grid.innerHTML = filtered.map(s => {
        const badgeClass = s.tradition === 'Both' ? 'badge-both' : s.tradition === 'Orthodox' ? 'badge-orthodox' : 'badge-catholic';
        const helps = (s.patronage||'').split(',').map(x=>x.trim()).filter(Boolean).slice(0,4).join(', ') || '‚Äî';
        return `
          <div class="card" onclick="openModal(event,'saint-${s.id}')">
            <h3 class="card-h3">${escapeHtml(s.name)}</h3>
            <span class="badge ${badgeClass}">${escapeHtml(s.tradition)}</span>
            <p class="card-subtitle"><strong>Helps with:</strong> ${escapeHtml(helps)}</p>
            <p class="card-subtitle">Role: ${escapeHtml(s.role||'‚Äî')}</p>
            <p class="card-subtitle">Feast: ${escapeHtml(s.feast||'‚Äî')}</p>
            <p class="card-text">${escapeHtml((s.story||'').slice(0,140))}...</p>
          </div>
        `;
      }).join('');
    }

    function renderCulture() {
      const grid = document.getElementById('cultureGrid');
      grid.innerHTML = cultureCards.map(c => `
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">${escapeHtml(c.title)}</h3>
          <p class="card-text"><strong>Question:</strong> ${escapeHtml(c.q)}</p>
          <details class="shared-box" style="margin-top:0.75rem;">
            <summary style="cursor:pointer; color:#e2e8f0; font-weight:800;">Reveal Top 7</summary>
            <ol style="padding-left:1.25rem; margin-top:0.6rem; color:#cbd5e1; line-height:1.7;">
              ${c.top7.map(x => `<li>${escapeHtml(x)}</li>`).join('')}
            </ol>
            ${c.quick ? `<div class="fun-fact" style="margin-top:0.75rem;"><div class="fun-fact-title">Quick answer</div><p style="color:#bfdbfe; margin-top:0.35rem;">${escapeHtml(c.quick)}</p></div>` : ''}
          </details>
        </div>
      `).join('');
    }

    function renderFoundations() {
      const grid = document.getElementById('foundationsGrid');
      grid.innerHTML = foundations.map(f => `
        <div class="card" onclick="openModal(event,'found-${f.id}')">
          <h3 class="card-h3">${escapeHtml(f.icon)} ${escapeHtml(f.title)}</h3>
          <p class="card-text">${escapeHtml(f.description)}</p>
        </div>
      `).join('');
    }

    function renderTheology() {
      const grid = document.getElementById('theologyGrid');
      grid.innerHTML = theologyTopics.map(t => `
        <div class="card" onclick="openModal(event,'theo-${t.id}')">
          <h3 class="card-h3">${escapeHtml(t.title)}</h3>
          <p class="card-text">${escapeHtml(t.question)}</p>
        </div>
      `).join('');
    }

    function renderHistory() {
      const grid = document.getElementById('historyGrid');
      grid.innerHTML = historyMoments.map(h => `
        <div class="card" onclick="openModal(event,'hist-${h.id}')">
          <h3 class="card-h3">${escapeHtml(h.title)}</h3>
          <p class="card-subtitle">${escapeHtml(h.year)}</p>
          <p class="card-text">${escapeHtml(h.story)}</p>
        </div>
      `).join('');
    }

    function renderPrayers() {
      const grid = document.getElementById('prayersGrid');
      grid.innerHTML = prayers.map(p => `
        <div class="card" onclick="openModal(event,'prayer-${p.id}')">
          <h3 class="card-h3">${escapeHtml(p.title)}</h3>
          <p class="card-text">${escapeHtml(p.text)}</p>
        </div>
      `).join('');
    }

    /* ---------------------------
       Modal
    --------------------------- */
    function openModal(event, id) {
      if (event) event.stopPropagation();
      const modal = document.getElementById('modal');
      const content = document.getElementById('modalContent');

      if (id.startsWith('conv-')) {
        const convId = parseInt(id.split('-')[1], 10);
        const c = conversations.find(x => x.id === convId);
        content.innerHTML = `
          <h2>${escapeHtml(c.title)}</h2>
          <div class="context-box"><div class="context-label">Setting</div>
            <p style="margin-top:0.5rem;color:#cbd5e1;">${escapeHtml(c.context)}</p>
          </div>
          ${c.exchange.map(ex => `<div class="speech"><strong>${escapeHtml(ex.speaker)}:</strong> ${escapeHtml(ex.speech)}</div>`).join('')}
        `;
      } else if (id.startsWith('cmd-')) {
        const num = id.split('-')[1];
        const cmd = commandments.find(x => x.num === num);
        content.innerHTML = `
          <h2>The ${escapeHtml(cmd.num)} Commandment</h2>
          <p style="font-style:italic;color:#cbd5e1;">${escapeHtml(cmd.catholic)}</p>
          <h3>Why</h3><p>${escapeHtml(cmd.why)}</p>
          <h3>Deeper</h3><p>${escapeHtml(cmd.deeper)}</p>
          <div class="kid-friendly"><div class="kid-friendly-title">üßí For Kids</div><p style="margin-top:0.5rem;">${escapeHtml(cmd.kidExplanation)}</p></div>
        `;
      } else if (id.startsWith('rit-')) {
        const rid = parseInt(id.split('-')[1],10);
        const r = rituals.find(x => x.id === rid);
        content.innerHTML = `
          <h2>${escapeHtml(r.icon)} ${escapeHtml(r.name)}</h2>
          <h3>Catholic</h3><p>${escapeHtml(r.catholic)}</p>
          <h3>Orthodox</h3><p>${escapeHtml(r.orthodox)}</p>
          <h3>Meaning</h3><p>${escapeHtml(r.meaning)}</p>
        `;
      } else if (id.startsWith('prac-')) {
        const pid = parseInt(id.split('-')[1],10);
        const p = practices.find(x => x.id === pid);
        content.innerHTML = `<h2>${escapeHtml(p.title)}</h2><p>${escapeHtml(p.content)}</p>`;
      } else if (id.startsWith('saint-')) {
        const sid = parseInt(id.split('-')[1],10);
        const s = saints.find(x => x.id === sid);
        content.innerHTML = `
          <h2>${escapeHtml(s.name)}</h2>
          <p><strong>Tradition:</strong> ${escapeHtml(s.tradition)}</p>
          <p><strong>Helps with:</strong> ${escapeHtml(s.patronage||'‚Äî')}</p>
          <p><strong>Role:</strong> ${escapeHtml(s.role||'‚Äî')}</p>
          <p><strong>Feast:</strong> ${escapeHtml(s.feast||'‚Äî')}</p>
          <div class="story-box"><div class="story-title">üìñ Story</div><p style="margin-top:0.5rem;">${escapeHtml(s.story||'')}</p></div>
          <div class="kid-friendly"><div class="kid-friendly-title">üßí For Kids</div><p style="margin-top:0.5rem;">${escapeHtml(s.kidFriendly||'‚Äî')}</p></div>
          <div class="fun-fact"><div class="fun-fact-title">‚ú® Note</div><p style="margin-top:0.5rem;">${escapeHtml(s.interestingFact||'‚Äî')}</p></div>
        `;
      } else if (id.startsWith('found-')) {
        const fid = parseInt(id.split('-')[1],10);
        const f = foundations.find(x => x.id === fid);
        content.innerHTML = `<h2>${escapeHtml(f.icon)} ${escapeHtml(f.title)}</h2><p>${escapeHtml(f.deepDive)}</p>`;
      } else if (id.startsWith('theo-')) {
        const tid = parseInt(id.split('-')[1],10);
        const t = theologyTopics.find(x => x.id === tid);
        content.innerHTML = `
          <h2>${escapeHtml(t.title)}</h2>
          <h3>Question</h3><p>${escapeHtml(t.question)}</p>
          <h3>Catholic</h3><p>${escapeHtml(t.catholicView)}</p>
          <h3>Orthodox</h3><p>${escapeHtml(t.orthodoxView)}</p>
          <div class="shared-box"><div class="shared-label">What we share</div><p style="margin-top:0.35rem;">${escapeHtml(t.sharedTruth)}</p></div>
        `;
      } else if (id.startsWith('hist-')) {
        const hid = parseInt(id.split('-')[1],10);
        const h = historyMoments.find(x => x.id === hid);
        content.innerHTML = `<h2>${escapeHtml(h.title)}</h2><p><strong>${escapeHtml(h.year)}</strong></p><p>${escapeHtml(h.story)}</p>`;
      } else if (id.startsWith('prayer-')) {
        const pid = parseInt(id.split('-')[1],10);
        const p = prayers.find(x => x.id === pid);
        content.innerHTML = `<h2>${escapeHtml(p.title)}</h2><div class="story-box"><p style="font-style:italic;margin-top:0.5rem;">${escapeHtml(p.text)}</p></div>`;
      } else {
        content.innerHTML = `<h2>Details</h2><p>Open a card to see details.</p>`;
      }

      modal.classList.add('active');
    }

    function closeModal(e) {
      if (!e || e.target.id === 'modal') document.getElementById('modal').classList.remove('active');
    }
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    /* ---------------------------
       Saints tools
    --------------------------- */
    function setSaintSearch(term){
      const input = document.getElementById('saintSearch');
      if (input) input.value = term;
      renderSaints();
    }

    function getFilteredSaints(){
      const input = document.getElementById('saintSearch');
      const search = ((input && input.value) ? input.value : '').toLowerCase();
      const tradEl = document.getElementById('tradFilter');
      const trad = (tradEl && tradEl.value) ? tradEl.value : 'All';
      return saints.filter(s => {
        const hay = ((s.name||'')+' '+(s.role||'')+' '+(s.patronage||'')+' '+(s.story||'')).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        const matchTrad = trad === 'All' || s.tradition === trad;
        return matchSearch && matchTrad;
      });
    }

    function randomSaint(){
      playClick(); haptic();
      const pool = getFilteredSaints();
      if (!pool.length) return;
      const s = pool[Math.floor(Math.random()*pool.length)];
      openModal(null, `saint-${s.id}`);
    }

    /* ---------------------------
       Conversation deal button
    --------------------------- */
    function getFilteredConversations(){
      const searchEl = document.getElementById('convSearch');
      const search = ((searchEl && searchEl.value) ? searchEl.value : '').toLowerCase();
      const topicEl = document.getElementById('convTopic');
      const topic = (topicEl && topicEl.value) ? topicEl.value : 'All';
      return conversations.filter(c => {
        const matchTopic = topic === 'All' || c.topic === topic;
        const hay = (c.title + ' ' + c.topic + ' ' + (c.tags||[]).join(' ') + ' ' + c.context).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        return matchTopic && matchSearch;
      });
    }

    function dealRandomConversation(){
      playClick(); haptic();
      const pool = getFilteredConversations();
      if (!pool.length) return;
      const c = pool[Math.floor(Math.random()*pool.length)];
      openModal(null, `conv-${c.id}`);
    }

    /* ---------------------------
       Pray Now button
    --------------------------- */
    function prayNow(){
      playClick(); haptic();
      if (!prayers || !prayers.length) return;
      const p = prayers[Math.floor(Math.random()*prayers.length)];
      openModal(null, `prayer-${p.id}`);
    }

    /* ---------------------------
       Dinner deck logic
    --------------------------- */
    function getDeepDive(card) {
      const topic = card.topic || 'Any';
      const common = {
        Authority: {
          why: 'Authority questions often hide a deeper fear: ‚ÄúWill truth be protected without power becoming abuse?‚Äù',
          mis: 'Misunderstanding: thinking the other side is only power-hungry or anti-unity.',
          hist: 'History anchor: 1st-millennium East/West were in communion with real diversity.',
          gentle: 'Try: ‚ÄúWhat safeguards protect humility and truth?‚Äù'
        }
      };
      const d = common[topic] || {
        why: 'Truth with love ‚Äî clarity without contempt.',
        mis: 'Misunderstanding: assuming disagreement means the other person is not faithful.',
        hist: 'History anchor: Christians have disagreed since the early centuries; saints model patience.',
        gentle: 'Try: ‚ÄúHelp me understand what you mean by that word.‚Äù'
      };
      return `
        <div><strong>Why this matters:</strong> ${escapeHtml(d.why)}</div>
        <div style="margin-top:0.4rem;"><strong>Common misunderstanding:</strong> ${escapeHtml(d.mis)}</div>
        <div style="margin-top:0.4rem;"><strong>History anchor:</strong> ${escapeHtml(d.hist)}</div>
        <div style="margin-top:0.4rem;"><strong>Try saying it like this:</strong> ${escapeHtml(d.gentle)}</div>
      `;
    }

    function getDinnerPool() {
      const topic = document.getElementById('dTopic')?.value || 'Any';
      const vibe  = document.getElementById('dVibe')?.value || 'Gentle';
      const deck = (topic === 'Culture') ? cultureDinnerDeck : dinnerDeck;
      return deck.filter(card => {
        const matchTopic = (topic === 'Any') || (topic === 'Culture') || (card.topic === topic);
        const matchVibe  = card.vibe === vibe;
        return matchTopic && matchVibe;
      });
    }

    function updateDinnerStats() {
      const pool = getDinnerPool();
      const el = document.getElementById('dStats');
      if (!el) return;
      const topic = document.getElementById('dTopic')?.value || 'Any';
      const vibe  = document.getElementById('dVibe')?.value || 'Gentle';
      const kids  = document.getElementById('dKids')?.value || 'No';
      el.textContent = `Deck available: ${pool.length} card${pool.length===1?'':'s'} ‚Ä¢ Topic: ${topic} ‚Ä¢ Vibe: ${vibe} ‚Ä¢ Kids: ${kids==='Yes'?'Yes':'No'}`;
    }

    const dinnerHistory = [];
    let dinnerIndex = -1;

    function renderDinnerCard(card) {
      const flip = document.getElementById('flipCard');
      const frontKicker = document.getElementById('frontKicker');
      const frontQ = document.getElementById('frontQ');
      const frontMeta = document.getElementById('frontMeta');
      const backBody = document.getElementById('backBody');
      const counter = document.getElementById('cardCounter');

      if (!card || !flip || !frontKicker || !frontQ || !frontMeta || !backBody) return;

      flip.dataset.topic = card.topic || '';

      if (counter) {
        const total = dinnerHistory.length;
        const pos = dinnerIndex >= 0 ? (dinnerIndex + 1) : 0;
        counter.textContent = `Card ${pos} / ${total}`;
      }

      flip.classList.remove('flipped');

      frontKicker.textContent = `${card.topic} ‚Ä¢ ${card.vibe}`;
      frontQ.innerHTML = `<strong>Question:</strong> ${escapeHtml(card.q)}`;

      const kidsPill = card.kids === 'Yes'
        ? '<span class="pill">üßí Kids-friendly</span>'
        : '<span class="pill" style="border-color:rgba(248,113,113,0.35);">üîû Adults-only</span>';

      frontMeta.innerHTML = `
        <span class="pill">üè∑Ô∏è ${escapeHtml(card.topic)}</span>
        <span class="pill">‚ú® ${escapeHtml(card.vibe)}</span>
        ${kidsPill}
      `;

      const deepOn = !!document.getElementById('deepDiveToggle')?.checked;
      const deepHtml = deepOn ? (card.deep || getDeepDive(card)) : '';

      backBody.innerHTML = `
        <div style="margin-top:0.25rem;"><strong>Answer / Why it matters:</strong> ${escapeHtml(card.ans || '')}</div>
        <div class="shared-box" style="margin-top:0.85rem;">
          <div class="shared-label">Bridge Phrase</div>
          <div style="margin-top:0.25rem;">${escapeHtml(card.bridge || '')}</div>
        </div>
        <div class="fun-fact" style="margin-top:0.85rem;">
          <div class="fun-fact-title">Follow-up</div>
          <div style="margin-top:0.25rem;">${escapeHtml(card.follow || '')}</div>
        </div>
        ${deepOn ? `<div class="shared-box" style="margin-top:0.85rem;"><div class="shared-label">Deep Dive</div><div style="margin-top:0.25rem;">${deepHtml}</div></div>` : ''}
        ${(!deepOn) ? `<div class="hintline" style="margin-top:0.75rem;">Tip: turn on <strong>Deep Dive</strong> to see deeper notes and Top 7 lists.</div>` : ''}
      `;
    }

    function pushCardToHistory(card){
      if (dinnerIndex < dinnerHistory.length - 1) dinnerHistory.splice(dinnerIndex + 1);
      dinnerHistory.push(card);
      dinnerIndex = dinnerHistory.length - 1;
    }

    function drawDinnerCard() {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');

      const pool = getDinnerPool();
      if (!pool.length) return;

      const card = pool[Math.floor(Math.random()*pool.length)];
      pushCardToHistory(card);
      renderDinnerCard(card);
    }

    function nextDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');

      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerIndex += 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      } else {
        drawDinnerCard();
      }
    }

    function prevDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');

      if (dinnerIndex > 0) {
        dinnerIndex -= 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      }
    }

    function flipDinnerCard(force) {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');

      const flip = document.getElementById('flipCard');
      if (!flip) return;

      const want = (force === true) ? true : (force === false) ? false : !flip.classList.contains('flipped');
      if (want) flip.classList.add('flipped'); else flip.classList.remove('flipped');
    }

    function rapidFireCulture() {
      playClick(); haptic();
      if (!cultureCards.length) return;

      const c = cultureCards[Math.floor(Math.random()*cultureCards.length)];
      const card = {
        topic:'Culture',
        vibe:'Top 7',
        kids:'No',
        q:`${c.title} ‚Äî ${c.q}`,
        ans:c.quick || 'Quick cue: follow the room; reverence beats perfection.',
        bridge:'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow:'What‚Äôs the story behind it in your family?',
        deep:`<div><strong>Top 7:</strong><ol style="padding-left:1.25rem;margin-top:0.5rem;line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      };

      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');

      pushCardToHistory(card);
      renderDinnerCard(card);

      setTimeout(()=>flipDinnerCard(true), 80); // auto flip
    }

    function deescalate(){
      playClick(); haptic();
      const msg = deescalations[Math.floor(Math.random()*deescalations.length)];
      const card = {
        topic:'De-escalate',
        vibe:'Gentle',
        kids:'No',
        q: msg,
        ans:'Tone is the answer here. Slow down, restate gently, and protect love.',
        bridge:'‚ÄúI think we‚Äôre both trying to honor Christ. Can we slow down?‚Äù',
        follow:'Ask: ‚ÄúWhat‚Äôs the most important thing you want me to understand about your faith?‚Äù'
      };
      pushCardToHistory(card);
      renderDinnerCard(card);
      setTimeout(()=>flipDinnerCard(true), 80);
    }

    function endWithPrayer(){
      playClick(); haptic();
      const p = unityPrayers[Math.floor(Math.random()*unityPrayers.length)];
      const card = {
        topic:'Prayer',
        vibe:'Gentle',
        kids:'Yes',
        q:'End with prayer together?',
        ans:p,
        bridge:'‚ÄúThank you for sharing honestly.‚Äù',
        follow:'Optional: each person names one thing they appreciated about the other‚Äôs faith.'
      };
      pushCardToHistory(card);
      renderDinnerCard(card);
      setTimeout(()=>flipDinnerCard(true), 80);
    }

    // Swipe support (left = next, right = back)
    (function bindDinnerSwipe(){
      const el = document.getElementById('gameCard');
      if (!el) return;
      let sx = 0, sy = 0;
      el.addEventListener('touchstart', (e)=>{
        const t = e.touches && e.touches[0];
        if (!t) return;
        sx = t.clientX; sy = t.clientY;
      }, {passive:true});
      el.addEventListener('touchend', (e)=>{
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;
        const dx = t.clientX - sx;
        const dy = t.clientY - sy;
        if (Math.abs(dx) < 45 || Math.abs(dx) < Math.abs(dy)) return;
        if (dx < 0) nextDinnerCard(); else prevDinnerCard();
      }, {passive:true});
    })();

    /* ---------------------------
       Boot
    --------------------------- */
    renderConversations();
    renderCommandments();
    renderRituals();
    renderPractices();
    renderSaints();
    renderCulture();
    renderFoundations();
    renderTheology();
    renderHistory();
    renderPrayers();
    updateDinnerStats();

    // Expose
    Object.assign(window, {
      switchTab,
      renderConversations,
      renderCommandments,
      renderRituals,
      renderPractices,
      renderSaints,
      renderCulture,
      renderFoundations,
      renderTheology,
      renderHistory,
      renderPrayers,
      openModal,
      closeModal,
      setSaintSearch,
      randomSaint,
      dealRandomConversation,
      prayNow,
      updateDinnerStats,
      drawDinnerCard,
      flipDinnerCard,
      prevDinnerCard,
      nextDinnerCard,
      rapidFireCulture,
      deescalate,
      endWithPrayer
    });
  </script>
</body>
</html>
