<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dinner Table Conversations ‚Ä¢ Orthodox & Catholic</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root{
      --gold:#f59e0b;
      --gold-2:#d97706;
      --navy:#0f172a;
      --slate:#1e293b;
      --slate-2:#111827;
      --text:#e2e8f0;
      --muted:#cbd5e1;
      --border:rgba(180,83,9,0.35);
      --border-soft:rgba(148,163,184,0.18);
      --shadow:0 18px 45px rgba(0,0,0,0.34);
      --shadow-soft:0 10px 25px rgba(0,0,0,0.22);
      --r:16px;
      --r2:22px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0a0e27 100%);
      color: var(--text);
      min-height: 100vh;
    }

    /* Type scale (C2): consistent and premium */
    .page-title{color:#fcd34d;font-weight:900;letter-spacing:-0.01em;line-height:1.1;
      font-size:clamp(1.55rem, 2.4vw, 2.05rem); margin:0 0 0.85rem 0;}
    .section-note{color:var(--muted);font-size:0.98rem;line-height:1.65;}

    .header {
      background: linear-gradient(to right, #0f172a, #1e293b);
      border-bottom: 2px solid #b45309;
      padding: 1.25rem 1.5rem;
      position: static; /* default: mobile-friendly */
      top: auto;
      z-index: 40;
    }

    /* Desktop sticky header only */
    @media (min-width: 769px) {
      .header {
        position: sticky;
        top: 0;
      }
    }
    .header h1 { font-size: 2rem; color: #fcd34d; margin-bottom: 0.25rem; font-weight: bold; }
    .header p { color: #cbd5e1; font-size: 0.9rem; }

    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding: 0.75rem 0 0.5rem;
      margin-top: 0.5rem;
      flex-wrap: nowrap; /* prevent menu from taking over screen */
      position: relative;
      z-index: 1000;
    }

    .nav-tab { position: relative; z-index: 1001; pointer-events: auto; }
    .nav-tab {
      padding: 0.5rem 1rem;
      background: #334155;
      color: #cbd5e1;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .nav-tab:hover { background: #475569; }
    .nav-tab.active { background: #b45309; color: #0f172a; }

    .container { max-width: 1200px; margin: 0 auto; padding: 1.25rem; }

    .content-section { display: none; }
    .content-section.active { display: block; animation: fadeIn 0.25s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(3px); } to { opacity: 1; transform: translateY(0); } }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.1rem; margin-bottom: 2rem; }

    .card {
      background: linear-gradient(180deg, rgba(30,41,59,0.92), rgba(17,24,39,0.92));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.05rem 1.1rem;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    /* Make cards feel more ‚Äúcard-like‚Äù */
    .card::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.16);
      pointer-events:none;
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-120px -120px auto auto;
      width:260px;height:260px;
      background: radial-gradient(circle at 30% 30%, rgba(245,158,11,0.16), transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
    }

    /* Dinner Tool ‚Äî Card Deck UX */
    .deck-wrap{display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-start;}
    .deck-visual{position:relative;width:170px;height:120px;flex:0 0 auto;}
    .deck-card{position:absolute;inset:0;border-radius:18px;background:#0f172a;border:1px solid rgba(148,163,184,0.25);box-shadow:0 12px 30px rgba(0,0,0,0.35);}
    .deck-card.one{transform:rotate(-8deg) translateX(-6px);opacity:0.9;}
    .deck-card.two{transform:rotate(4deg) translateX(10px) translateY(2px);opacity:0.95;}
    .deck-card.three{transform:rotate(-1deg) translateY(6px);}

    .game-stage{flex:1;min-width:280px;display:grid;grid-template-columns:1fr 240px;gap:0.85rem;align-items:start;}
    .game-card{grid-column:1;}
    .game-actions{grid-column:2;margin-top:0;flex-direction:column;align-items:stretch;}
    .game-actions .btn{width:100%;justify-content:center;}
    .hintline{margin-top:0.35rem;}

    @media (max-width: 768px){
      .game-stage{grid-template-columns:1fr;}
      .game-actions{grid-column:1;flex-direction:row;flex-wrap:wrap;}
      .game-actions .btn{width:auto;}
    }
    .game-card{perspective:1200px;-webkit-perspective:1200px;perspective-origin:50% 50%;-webkit-perspective-origin:50% 50%;}
    .flip{position:relative;width:100%;min-height:260px;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;transition:transform 0.5s ease;transform:translateZ(0);-webkit-transform:translateZ(0);}
    .flip.flipped{transform:rotateY(180deg);-webkit-transform:rotateY(180deg);} 

    /* Micro-animations */
    @keyframes dealPop { 0%{transform:translateY(10px) scale(0.98); opacity:0.6;} 60%{transform:translateY(-2px) scale(1.01); opacity:1;} 100%{transform:translateY(0) scale(1);} }
    .deal-animate { animation: dealPop 260ms ease-out; }

    @keyframes softPulse { 0%{transform:scale(1);} 40%{transform:scale(1.01);} 100%{transform:scale(1);} }
    .pulse-animate { animation: softPulse 320ms ease-out; }
    .face{position:absolute;inset:0;
      background:radial-gradient(1200px 420px at 20% 0%, rgba(59,130,246,0.18), transparent 55%),
                 radial-gradient(900px 360px at 90% 30%, rgba(245,158,11,0.16), transparent 55%),
                 #0f172a;
      border:1px solid rgba(148,163,184,0.25);
      border-radius:24px;
      padding:1.1rem 1.1rem 1rem;
      backface-visibility:hidden;-webkit-backface-visibility:hidden; -webkit-backface-visibility:hidden;-webkit-backface-visibility:hidden;
      box-shadow:0 22px 55px rgba(0,0,0,0.42);
      position:relative;
      overflow:hidden;
    }
    .face::before{content:"";position:absolute;inset:12px;border-radius:18px;border:1px solid rgba(148,163,184,0.16);pointer-events:none;}
    .face::after{content:"";position:absolute;left:-40px;top:-60px;width:220px;height:220px;background:radial-gradient(circle at 30% 30%, rgba(56,189,248,0.14), transparent 60%);pointer-events:none;}
    .face.back{transform:rotateY(180deg) translateZ(1px);-webkit-transform:rotateY(180deg) translateZ(1px);overflow:auto;}
    .face .kicker{color:#f59e0b;font-weight:800;font-size:0.9rem;letter-spacing:0.02em;}
    .face .q{margin-top:0.5rem;font-size:1.15rem;line-height:1.45;color:#e2e8f0;}
    .face .meta{margin-top:0.75rem;display:flex;gap:0.5rem;flex-wrap:wrap;}
    .pill{display:inline-flex;align-items:center;gap:0.35rem;padding:0.2rem 0.6rem;border-radius:999px;background:#111827;border:1px solid rgba(148,163,184,0.22);color:#cbd5e1;font-size:0.78rem;font-weight:700;}

    .game-actions{margin-top:0.85rem;display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;}
    .game-actions .btn{padding:0.85rem 1.05rem;border-radius:0.9rem;font-size:1rem;}
    .game-actions .btn.secondary{padding:0.6rem 0.8rem;border-radius:0.75rem;font-size:0.92rem;}
    .hintline{color:#94a3b8;font-size:0.85rem;margin-top:0.5rem;}

    @media (max-width: 768px) {
      .deck-wrap{gap:0.85rem;}
      .deck-visual{width:140px;height:104px;}
      .face{padding:0.95rem;}
      .face .q{font-size:1.05rem;}
    }

    .card:hover { border-color: rgba(245,158,11,0.55); transform: translateY(-2px); box-shadow: 0 18px 45px rgba(0,0,0,0.38); }

    .card-text { color: #cbd5e1; font-size: 0.96rem; margin-top: 0.65rem; line-height: 1.65; }
    .card-h3{color:var(--gold); font-weight:900; letter-spacing:-0.01em; font-size:1.05rem;}
    .card-subtitle{color:rgba(245,158,11,0.82); font-size:0.86rem; margin-top:0.45rem;}
    .card-subtitle { color: #b45309; font-size: 0.85rem; margin-top: 0.5rem; }

    .search-box, .filter-select {
      padding: 0.75rem 1rem;
      background: #0f172a;
      border: 1px solid rgba(180,83,9,0.38);
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
      border-radius: 0.5rem;
      color: #fcd34d;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .search-box::placeholder { color: #92400e; }
    .search-box:focus, .filter-select:focus { outline: none; border-color: rgba(245,158,11,0.7); background: #111827; }

    .filter-select { display: inline-block; width: auto; margin-right: 0.75rem; }
    .filter-select option { background: #0f172a; color: #fcd34d; }

    .speaker-icon { display: inline-block; width: 30px; height: 30px; border-radius: 50%; text-align: center; line-height: 30px; margin-right: 0.5rem; font-size: 1.35rem; }
    .catholic { background: #92400e; }
    .orthodox { background: #1e40af; }

    .speech { color: #cbd5e1; line-height: 1.7; font-style: italic; background: #0f172a; padding: 1rem; border-left: 3px solid #d97706; margin: 0.75rem 0; border-radius: 0.25rem; }

    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: bold; margin-right: 0.5rem; margin-bottom: 0.5rem; }
    .badge-catholic { background: #92400e; color: #fef3c7; }
    .badge-orthodox { background: #1e40af; color: #bfdbfe; }
    .badge-both { background: #6b21a8; color: #e9d5ff; }
    .badge-topic { background: #0b3b60; color: #bfdbfe; }

    .footer { border-top: 2px solid #b45309; padding: 1.5rem; text-align: center; color: #b45309; font-size: 0.9rem; margin-top: 2rem; }

    .context-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-bottom: 1.25rem; border-radius: 0.25rem; }
    .context-label { color: #86efac; font-weight: bold; font-size: 0.9rem; }

    .shared-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-top: 1rem; border-radius: 0.25rem; }
    .shared-label { color: #86efac; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem; }

    .ritual-card { background: linear-gradient(180deg, rgba(30,41,59,0.92), rgba(17,24,39,0.92)); border: 1px solid var(--border); border-radius: var(--r); padding: 1rem; margin-bottom: 0.85rem; cursor: pointer; transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease; box-shadow: var(--shadow-soft);}
    .ritual-card:hover { border-color: rgba(245,158,11,0.55); transform: translateY(-1px); box-shadow: 0 18px 45px rgba(0,0,0,0.38);}
    .ritual-name { color: #fcd34d; font-weight: bold; font-size: 1rem; }
    .ritual-desc { color: #cbd5e1; margin-top: 0.5rem; font-size: 0.9rem; line-height: 1.55; }

    .comparison-container { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin: 1rem 0; }
    .comparison-box { background: #1e293b; border: 1px solid #b45309; border-radius: 0.5rem; padding: 1rem; }
    .comparison-title { color: #f59e0b; font-weight: bold; margin-bottom: 0.75rem; }
    .comparison-content { color: #cbd5e1; font-size: 0.95rem; line-height: 1.6; }

    .proto-note { background: #064e3b; border-left: 4px solid #10b981; padding: 0.75rem; margin-bottom: 1rem; border-radius: 0.25rem; color: #86efac; font-size: 0.85rem; }

    .fun-fact { background: #1e40af; border-left: 4px solid #60a5fa; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #bfdbfe; }
    .fun-fact-title { font-weight: bold; margin-bottom: 0.5rem; }

    .kid-friendly { background: #92400e; border-left: 4px solid #fbbf24; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #fef3c7; }
    .kid-friendly-title { font-weight: bold; margin-bottom: 0.5rem; }

    .story-box { background: #0a0e27; border-left: 4px solid #10b981; padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; }
    .story-title { color: #86efac; font-weight: bold; margin-bottom: 0.5rem; }

    /* Modal */
    .modal-overlay {
      display: none;
      pointer-events: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 50;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: 1.25rem;
    }
    .modal-overlay.active { display: flex; pointer-events: auto; }
    .modal {
      background: #0f172a;
      border: 1px solid rgba(245,158,11,0.5);
      border-radius: var(--r2);
      padding: 1.75rem;
      max-width: 960px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      margin: auto;
    }
    .modal-close { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; color: #b45309; font-size: 1.6rem; cursor: pointer; }
    .modal-close:hover { color: #d97706; }
    .modal h2 { color: #fcd34d; margin-bottom: 0.75rem; font-size: 1.55rem; font-weight: 900; }
    .modal h3 { color: #f59e0b; margin-top: 1.1rem; margin-bottom: 0.6rem; font-size: 1.12rem; font-weight: 800; }
    .modal h4 { color: #d97706; margin-top: 0.9rem; margin-bottom: 0.4rem; font-size: 1rem; font-weight: 700; }
    .modal p { color: #cbd5e1; margin-bottom: 0.75rem; line-height: 1.7; }
    .modal-label { color: #f59e0b; font-weight: 700; margin-top: 0.75rem; margin-bottom: 0.25rem; }

    .btn {
      background: #b45309;
      color: #0f172a;
      border: none;
      padding: 0.65rem 1rem;
      border-radius: 0.65rem;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .btn:hover { background: #d97706; transform: translateY(-1px); }
    .btn:active { transform: translateY(0px) scale(0.98); }
    .btn.secondary:active { transform: translateY(0px) scale(0.985); }
    .btn.secondary { background: #334155; color: #e2e8f0; font-weight: 700; border:1px solid rgba(148,163,184,0.18);}
    .btn.secondary:hover { background: #475569; }

    .tiny { font-size: 0.85rem; color: #cbd5e1; opacity: 0.95; }

    @media (max-width: 768px) {
      /* Mobile (C2): compact, consistent spacing */
      .header { position: static; padding: 0.9rem 1rem; }
      .header h1 { font-size: 1.35rem; }
      .header p { display: none; }

      /* Keep nav in a single horizontal row to avoid the menu taking over the screen */
      .nav-tabs { flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 0.5rem; }
      .nav-tab { flex: 0 0 auto; }

      .comparison-container { grid-template-columns: 1fr; }
      .container { padding: 1rem; }
      .grid { grid-template-columns: 1fr; }
      .page-title{margin-bottom:0.75rem;}
      .card{padding:0.95rem;}
      .search-box,.filter-select{font-size:0.98rem;}
      .btn{padding:0.7rem 0.9rem;}
      .btn.secondary{padding:0.55rem 0.75rem;}
    }

  
    /* iOS/Safari flip robustness */
    .face.front{transform:translateZ(1px);-webkit-transform:translateZ(1px);} 

    /* Fail-safe: if 3D flip renders blank in some mobile webviews, use a simple swap */
    @media (max-width: 768px){
      .flip{transform:none !important;-webkit-transform:none !important;}
      .flip.flipped{transform:none !important;-webkit-transform:none !important;}
      .face{position:relative;inset:auto;}
      .face.back{display:none;}
      .flip.flipped .face.front{display:none;}
      .flip.flipped .face.back{display:block;}
    } 

    /* Culture card skin */
    #flipCard[data-topic="Culture"] .face{
      background:radial-gradient(1100px 420px at 15% 0%, rgba(168,85,247,0.18), transparent 55%),
                 radial-gradient(900px 360px at 90% 35%, rgba(34,211,238,0.14), transparent 60%),
                 #0b1020;
      border-color: rgba(168,85,247,0.45);
    }
    #flipCard[data-topic="Culture"] .kicker{color:#c4b5fd;}
    #flipCard[data-topic="Culture"] .pill{border-color:rgba(196,181,253,0.25);}

$1
</head>
<body>
  <div class="header">
    <h1>üçΩÔ∏è Dinner Table Conversations</h1>
    <p>Orthodox & Catholic Christians in deep dialogue over shared meals ‚Äî respectful, lively, and real.</p>

    <div class="nav-tabs" role="tablist" aria-label="Navigation">
      <button class="nav-tab active" onclick="switchTab(event, 'home')">Home</button>
      <button class="nav-tab" onclick="switchTab(event, 'dinner')">Dinner Tool</button>
      <button class="nav-tab" onclick="switchTab(event, 'conversations')">Conversations</button>
      <button class="nav-tab" onclick="switchTab(event, 'commandments')">10 Commandments</button>
      <button class="nav-tab" onclick="switchTab(event, 'rituals')">Rituals & Signs</button>
      <button class="nav-tab" onclick="switchTab(event, 'practices')">Church Practices</button>
      <button class="nav-tab" onclick="switchTab(event, 'saints')">Saints</button>
      <button class="nav-tab" onclick="switchTab(event, 'culture')">Culture Cues</button>
      <button class="nav-tab" onclick="switchTab(event, 'foundations')">Core Differences</button>
      <button class="nav-tab" onclick="switchTab(event, 'theology')">Theology Deep Dives</button>
      <button class="nav-tab" onclick="switchTab(event, 'history')">History</button>
      <button class="nav-tab" onclick="switchTab(event, 'prayers')">Prayers</button>
    </div>
  </div>

  <div class="container">
    <!-- HOME TAB -->
    <section id="home" class="content-section active" role="tabpanel">
      <h2 class="page-title">Welcome to the Table</h2>
      <div class="context-box">
        <div class="context-label">üìñ About This App</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">This app helps Christians have better dinner conversations‚Äîcurious, warm, and truthful. Explore what divides Orthodox and Catholic traditions, what unites them, and why practices matter. Use the <strong>Dinner Tool</strong> to get conversation prompts, keep the tone charitable, and end the meal with a prayer of unity.</p>
      </div>

      <div class="grid">
        <div class="card" onclick="switchTab(null,'dinner');" role="button" aria-label="Open Dinner Tool">
          <h3 class="card-h3">üé≤ Dinner Tool</h3>
          <p class="card-text">Generate lively questions, pick a vibe (gentle or spicy), and keep conversations respectful.</p>
          <p class="card-subtitle">New: prompt decks, house rules, ‚Äúbridge phrases,‚Äù and Deep Dive mode.</p>
        </div>
        <div class="card" onclick="switchTab(null,'conversations');" role="button" aria-label="Open Conversations">
          <h3 class="card-h3">üó£Ô∏è Real Conversations</h3>
          <p class="card-text">Read dialogue scenes you can borrow at the table. Each is short, relatable, and actually useful.</p>
          <p class="card-subtitle">Tap any card to open the full scene.</p>
        </div>
        <div class="card" onclick="switchTab(null,'rituals');" role="button" aria-label="Open Rituals">
          <h3 class="card-h3">‚úùÔ∏è Rituals & Signs</h3>
          <p class="card-text">The sign of the cross, icons, incense, holy water‚Äîwhat each means, and why it differs.</p>
        </div>
        <div class="card" onclick="switchTab(null,'saints');" role="button" aria-label="Open Saints">
          <h3 class="card-h3">‚ú® Saints Who Inspire</h3>
          <p class="card-text">Stories with a kid-friendly version, plus a fun fact for the grown-ups.</p>
        </div>
      </div>

      <div class="proto-note">Tip: Start with a shared truth, ask a real question, and don‚Äôt try to ‚Äúwin.‚Äù The goal is love + clarity.</div>
    </section>

    <!-- DINNER TOOL TAB -->
    <section id="dinner" class="content-section" role="tabpanel">
      <h2 class="page-title">üé≤ Dinner Conversation Tool</h2>

      <div class="context-box">
        <div class="context-label">üç∑ How to Use This</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">Choose a <strong>topic</strong>, a <strong>vibe</strong>, and whether kids are present. Press <strong>Deal a Card</strong> to get a question + a ‚Äúbridge phrase‚Äù that keeps it charitable. If things get tense, hit <strong>De-escalate</strong>. Use <strong>Deep Dive mode</strong> when you want the ‚Äúlevel 2‚Äù meaning.</p>
      </div>

      <details style="margin-bottom:1rem;" class="shared-box">
        <summary style="cursor:pointer; color:#e2e8f0; font-weight:800;">üóìÔ∏è 1st Millennium ‚Üí Schism ‚Üí Modern Healing (quick timeline)</summary>
        <div style="color:#cbd5e1; margin-top:0.5rem; line-height:1.65;">
          <ul style="padding-left:1.25rem; list-style:disc;">
            <li><strong>1st‚Äì8th c.</strong> Shared core faith (Creed, sacraments, apostolic succession) with diverse liturgies and customs.</li>
            <li><strong>9th‚Äì11th c.</strong> Tensions rise (language, politics, jurisdiction, missions, Creed wording debates).</li>
            <li><strong>1054</strong> Mutual excommunications (a symbol of a long, gradual rupture rather than a single ‚Äúinstant split‚Äù).</li>
            <li><strong>1204</strong> Fourth Crusade sack of Constantinople (deep wound; trust collapses).</li>
            <li><strong>1274 / 1439</strong> Reunion attempts (Lyons, Florence) with mixed reception and heavy political pressure.</li>
            <li><strong>1965</strong> Excommunications lifted by Pope Paul VI & Patriarch Athenagoras (charity re-opened the door).</li>
            <li><strong>Today</strong> Dialogue continues (primacy/synodality, authority processes, shared witness).</li>
          </ul>
          <p style="margin-top:0.75rem;"><strong>Table rule:</strong> We don‚Äôt reenact old wounds ‚Äî we practice charity now.</p>
        </div>
      </details>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="dTopic" class="filter-select" onchange="updateDinnerStats()">
          <option value="Any">Any Topic</option>
          <option value="Authority">Authority</option>
          <option value="Mary">Mary</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Lent">Lent</option>
          <option value="Prayer">Prayer</option>
          <option value="Icons">Icons</option>
          <option value="History">History</option>
          <option value="DailyLife">Daily Life</option>
          <option value="Culture">Culture (quick cues)</option>
          <option value="Deep Theology">Deep Theology (Level 2)</option>
        </select>

        <select id="dVibe" class="filter-select" onchange="updateDinnerStats()">
          <option value="Gentle">Gentle (curious)</option>
          <option value="Lively">Lively (honest)</option>
          <option value="Spicy">Spicy (respectful debate)</option>
        </select>

        <select id="dKids" class="filter-select" onchange="updateDinnerStats()">
          <option value="No">Adults only</option>
          <option value="Yes">Kids present</option>
        </select>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="deepDiveToggle" type="checkbox" style="width:16px; height:16px; accent-color:#38bdf8;" />
          Deep Dive mode
        </label>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="soundToggle" type="checkbox" style="width:16px; height:16px; accent-color:#f59e0b;" />
          Sound
        </label>
      </div>

      <div class="tiny" id="dStats"></div>

      <div class="card" style="cursor:default;" aria-live="polite">
        <h3 class="card-h3">üé¥ Dinner Card Deck</h3>

        <div class="deck-wrap" style="margin-top:0.85rem;">
          <div class="deck-visual" aria-hidden="true">
            <div class="deck-card one"></div>
            <div class="deck-card two"></div>
            <div class="deck-card three"></div>
          </div>

          <div class="game-stage">
            <div class="game-card" id="gameCard">
              <div class="flip" id="flipCard">
                <div class="face front">
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:0.75rem;">
                    <div class="kicker" id="frontKicker">Ready</div>
                    <div class="pill" id="cardCounter" title="Card position" style="opacity:0.95;">Card 0 / 0</div>
                  </div>
                  <div class="q" id="frontQ">Tap <strong>Draw</strong> to deal a card.</div>
                  <div class="meta" id="frontMeta"></div>
                  <div class="hintline">Swipe left for next ‚Ä¢ Swipe right for previous ‚Ä¢ Tap Flip for answer</div>
                </div>
                <div class="face back">
                  <div class="kicker" id="backKicker">Answer</div>
                  <div id="backBody" style="color:#cbd5e1; line-height:1.7;"></div>
                </div>
              </div>
            </div>

            <div class="game-actions">
              <button class="btn" onclick="drawDinnerCard()">üÉè Draw</button>
              <button class="btn secondary" onclick="flipDinnerCard()">üîÑ Flip</button>
              <button class="btn secondary" onclick="prevDinnerCard()">‚¨ÖÔ∏è Back</button>
              <button class="btn secondary" onclick="nextDinnerCard()">‚û°Ô∏è Next</button>
              <button class="btn secondary" onclick="(window.rapidFireCulture ? window.rapidFireCulture() : alert('Rapid Fire not loaded ‚Äî refresh once.'))">‚ö° Rapid Fire (Top 7)</button>
            </div>
          </div>
        </div>
      </div>

      <div class="grid" style="margin-top:1.25rem;">
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">House Rules</h3>
          <ul class="card-text" style="margin-top:0.75rem; list-style:disc; padding-left:1.25rem;">
            <li>Assume goodwill. Ask before you argue.</li>
            <li>Speak in ‚ÄúI‚Äù statements. No labels.</li>
            <li>Steelman the other side: repeat it fairly first.</li>
            <li>One claim at a time. Don‚Äôt stack 12 issues.</li>
            <li>End with what you share: Jesus is Lord.</li>
          </ul>
        </div>
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">Quick Rescues</h3>
          <div class="card-text" style="margin-top:0.75rem;">
            <p><strong>When it gets hot:</strong> ‚ÄúI think we‚Äôre both protecting something sacred. Can we slow down?‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When someone feels attacked:</strong> ‚ÄúThat came out sharper than I meant. Let me restate it.‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When stuck:</strong> ‚ÄúWhat do we both agree is true about Christ here?‚Äù</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CONVERSATIONS TAB -->
    <section id="conversations" class="content-section" role="tabpanel">
      <h2 class="page-title">Dinner Table Conversations</h2>
      <input type="text" id="convSearch" class="search-box" placeholder="Search conversations by title, topic, or keyword..." onkeyup="renderConversations()">
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="convTopic" class="filter-select" onchange="renderConversations()">
          <option value="All">All Topics</option>
          <option value="Sign of the Cross">Sign of the Cross</option>
          <option value="Holy Water Blessing">Holy Water</option>
          <option value="Religious Art">Icons/Statues</option>
          <option value="Mass Obligation">Attendance</option>
          <option value="Saints and Nature">Saints & Nature</option>
          <option value="Filioque">Filioque</option>
          <option value="Purgatory">Purgatory</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Divorce">Marriage/Divorce</option>
        </select>
        <span class="tiny" id="convCount"></span>
        <button class="btn secondary" style="margin-left:auto;" onclick="dealRandomConversation()">üé≤ Deal a Conversation</button>
      </div>
      <div id="conversationsGrid" class="grid"></div>
    </section>

    <!-- COMMANDMENTS TAB -->
    <section id="commandments" class="content-section" role="tabpanel">
      <h2 class="page-title">The Ten Commandments</h2>
      <div class="context-box">
        <div class="context-label">üìú Mount Sinai & Freedom</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">These commandments weren‚Äôt random rules. They were a covenant‚Äîhow to live free after slavery. Christians receive them as the enduring moral law, fulfilled in Christ.</p>
      </div>
      <div id="commandmentsGrid"></div>
    </section>

    <!-- RITUALS TAB -->
    <section id="rituals" class="content-section" role="tabpanel">
      <h2 class="page-title">Rituals & Signs</h2>
      <div class="proto-note">Visible gestures reveal deep theology. Every object and movement teaches something.</div>
      <div id="ritualsGrid"></div>
    </section>

    <!-- PRACTICES TAB -->
    <section id="practices" class="content-section" role="tabpanel">
      <h2 class="page-title">Church Practices</h2>
      <p style="color:#cbd5e1; margin-bottom:1rem;">Practices aren‚Äôt arbitrary. They express what each church believes worship does to the human person.</p>
      <div id="practicesGrid" class="grid"></div>
    </section>

    <!-- SAINTS TAB -->
    <section id="saints" class="content-section" role="tabpanel">
      <h2 class="page-title">Saints</h2>
      <div class="proto-note">Saints are real humans who struggled, repented, and grew into holiness. Their stories are fuel for the rest of us.</div>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center;">
        <label style="color:#fcd34d; font-weight:700;">Filter:</label>
        <select id="tradFilter" class="filter-select" onchange="renderSaints()">
          <option value="All">All Traditions</option>
          <option value="Both">Both Orthodox & Catholic</option>
          <option value="Catholic">Catholic Saints</option>
          <option value="Orthodox">Orthodox Saints</option>
        </select>
        <input type="text" id="saintSearch" class="search-box" style="margin-bottom:0; flex:1; min-width:260px;" placeholder="Search saints by name, role, patronage (what they help with), story‚Ä¶" onkeyup="renderSaints()">
      </div>
      <div class="tiny" id="saintsCount" style="margin-top:0.75rem;"></div>
      <div style="margin-top:0.6rem; display:flex; flex-wrap:wrap; gap:0.5rem; align-items:center;">
        <div id="saintChips" style="display:flex; flex-wrap:wrap; gap:0.5rem;"></div>
        <button class="btn secondary" style="margin-left:auto;" onclick="randomSaint()">üé≤ Random Saint</button>
      </div>
      <div id="saintsGrid" class="grid" style="margin-top:0.75rem;"></div>
    </section>

    <!-- CULTURE TAB -->
    <section id="culture" class="content-section" role="tabpanel">
      <h2 class="page-title">Culture Cues</h2>
      <div class="context-box">
        <div class="context-label">üè† Little things that matter</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">These are the ‚Äúsmall habits‚Äù that signal reverence and belonging: words people use (Mass vs Liturgy), when people cross themselves, how visiting works, coffee hour culture, fasting etiquette, and more. Tap a card to see the <strong>Top 7</strong> (Family Feud style).</p>
      </div>
      <div id="cultureGrid" class="grid"></div>
      <div class="shared-box">
        <div class="shared-label">Dinner tip</div>
        <p style="color:#cbd5e1; margin-top:0.25rem;">Ask: ‚ÄúWhat‚Äôs a small habit in your tradition that makes you feel God is near?‚Äù Then listen for the story behind it.</p>
      </div>
    </section>

    <!-- FOUNDATIONS TAB -->
    <section id="foundations" class="content-section" role="tabpanel">
      <h2 class="page-title">Core Differences</h2>
      <p style="color:#cbd5e1; margin-bottom:1rem;">Strip away politics. These are the theological/ecclesial differences shaping everything else.</p>
      <div id="foundationsGrid" class="grid"></div>
    </section>

    <!-- THEOLOGY TAB -->
    <section id="theology" class="content-section" role="tabpanel">
      <h2 class="page-title">Theology Deep Dives</h2>
      <p style="color:#cbd5e1; margin-bottom:1rem;">Big questions. Clear summaries. Shared truths highlighted.</p>
      <div id="theologyGrid" class="grid"></div>
    </section>

    <!-- HISTORY TAB -->
    <section id="history" class="content-section" role="tabpanel">
      <h2 class="page-title">History Moments</h2>
      <div id="historyGrid" class="grid"></div>
    </section>

    <!-- PRAYERS TAB -->
    <section id="prayers" class="content-section" role="tabpanel">
      <h2 class="page-title">Prayers We Share</h2>
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <button class="btn" onclick="prayNow()">üôè Pray Now</button>
        <span class="tiny">(opens a prayer card)</span>
      </div>
      <div id="prayersGrid" class="grid"></div>
    </section>
  </div>

  <div class="footer">Dinner Table Conversations ‚Ä¢ Ecumenical Learning Through Honest Dialogue ‚Ä¢ 2026</div>

  <!-- MODAL -->
  <div id="modal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    "use strict";

    // Safety: make tabs clickable even if a later script error occurs.
    // This minimal switchTab does not depend on other functions.
    window.switchTab = function(event, tab) {
      try {
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
        const target = document.getElementById(tab);
        if (target) target.classList.add('active');
        if (event && event.target) event.target.classList.add('active');
      } catch (e) {
        // no-op
      }
    };

    // Fallback: if inline onclicks are blocked or a function isn't found, handle nav clicks here.
    document.addEventListener('click', function(e){
      const btn = e.target && e.target.closest ? e.target.closest('.nav-tab') : null;
      if (!btn) return;
      const label = (btn.textContent || '').trim().toLowerCase();
      const map = {
        'home':'home',
        'dinner tool':'dinner',
        'conversations':'conversations',
        '10 commandments':'commandments',
        'rituals & signs':'rituals',
        'church practices':'practices',
        'saints':'saints',
        'culture cues':'culture',
        'core differences':'foundations',
        'theology deep dives':'theology',
        'history':'history',
        'prayers':'prayers'
      };
      const tab = map[label];
      if (!tab) return;
      window.switchTab({target: btn}, tab);
    }, {passive:true});

    // ============================
    // DATA
    // ============================

    // NOTE: A DOM element with id="saints" can sometimes create a global named `saints` in some environments.
    // We explicitly define `saints` as data (array) and expose handlers to `window` so inline onclick works reliably.

    // IMPORTANT: No unescaped raw newlines inside string literals.
    const saintsPacked = [[1,"Saint Aelred of Rievaulx","Both","Mystic ‚Ä¢ Medieval","January 12","Friendship, Spiritual companionship, Loneliness, Community, Monks, Those seeking deep relationships","Aelred was a Cistercian monk known for his writings on friendship. In 'On Spiritual Friendship,' he wrote that friendship is one of the greatest goods‚Äîa path to encountering Christ.","Aelred followed Jesus as a mystic. Aelred was a Cistercian monk known for his writings on friendship.","Integrated spiritual theology with relational depth."],[2,"Saint Alphonsa of the Immaculate Conception","Catholic","Healer ‚Ä¢ Modern","July 28","Pneumonia, Chest infections, Respiratory illness, Indian Catholics","Alphonsa was an Indian nun of the Syro-Malabar Church. She suffered from respiratory illnesses. Despite chronic pneumonia, she dedicated herself to religious life.","Alphonsa followed Jesus as a healer. Alphonsa was an Indian nun of the Syro-Malabar Church.","First female saint of Indian origin canonized by the Church."],[3,"Saint Alponsus Liguori","Catholic","Teacher ‚Ä¢ Medieval","August 1","Moral theology, Bishops, Confessors, Scrupulous people, Moral decision-making, Teachers, Compassion in confession","Alponsus was a bishop and theologian who developed compassionate approaches to moral theology and confession. He rejected harsh scrupulosity. He founded the Redemptorists. He became a Doctor of the Church.","Alponsus followed Jesus as a teacher. Alponsus was a bishop and theologian who developed compassionate approaches to moral theology and confession.","Revolutionized moral theology through emphasis on pastoral compassion."],[4,"Saint Ambrose of Milan","Catholic","Teacher ‚Ä¢ Early","December 7","Bishops, Learning, Bees, Beekeepers, Against poisoning","Ambrose was elected Bishop of Milan while still unbaptized. He became one of the greatest theologians of the early Church. He defended orthodoxy, challenged emperors, and converted Saint Augustine. He is one of the four Latin Doctors of the Church.","Ambrose followed Jesus as a teacher. Ambrose was elected Bishop of Milan while still unbaptized.","One of the four Latin Doctors of the Church. Defended orthodoxy and challenged secular authority."],[5,"Saint Andrew the Apostle","Both","Apostle ‚Ä¢ Early","November 30","Single women, Fishermen, Scotland, Against persecution, Missionaries, Women seeking husbands","Andrew was one of Jesus' first apostles. His most famous act was bringing his brother Peter to Jesus. In Catholic tradition, he became the patron saint of single women seeking marriage.","Andrew followed Jesus as a apostle. Andrew was one of Jesus' first apostles.","Shows the power of bringing others into relationship with Christ."],[6,"Saint Angela Merici","Catholic","Teacher ‚Ä¢ Medieval","January 27","Teachers, Educators, Parents, Girls, Youth, Women religious","Angela founded the Ursulines to educate young girls. She emphasized spiritual formation. Her teaching transformed education for women.","Angela followed Jesus as a teacher. Angela founded the Ursulines to educate young girls.","Pioneered formal education for girls within Christian communities."],[7,"Saint Anthony the Great","Both","Monk ‚Ä¢ Early","January 17","Monks, Hermits, Skin diseases, Butchers, Gravediggers","Anthony was an Egyptian hermit called the father of monasticism. He sold everything and went into the desert. His spiritual struggles became legendary. His life inspired countless monastics.","Anthony followed Jesus as a monk. Anthony was an Egyptian hermit called the father of monasticism.","Father of monasticism; his life shaped Christian ascetic tradition."],[8,"Saint Athanasius","Both","Teacher ‚Ä¢ Early","May 2","Theologians, Defenders of the Trinity","Athanasius defended the divinity of Christ against Arianism. He was exiled multiple times but stayed faithful. He wrote 'On the Incarnation' and helped secure the Nicene faith.","Athanasius followed Jesus as a teacher. Athanasius defended the divinity of Christ against Arianism.","Key defender of Nicene orthodoxy; major influence on Trinitarian doctrine."],[9,"Saint Augustine of Hippo","Catholic","Teacher ‚Ä¢ Early","August 28","Theologians, Philosophers, Augustine orders","Augustine lived a restless life until converting through the prayers of his mother Monica and the witness of Ambrose. His writings shaped Western Christianity. His 'Confessions' remain a classic.","Augustine followed Jesus as a teacher. Augustine lived a restless life until converting through the prayers of his mother Monica and the witness of Ambrose.","One of the most influential theologians in Western Christian history."],[10,"Saint Basil the Great","Both","Teacher ‚Ä¢ Early","January 2","Hospitals, Social justice, Monasticism","Basil was a Cappadocian Father who defended the Trinity and reformed monastic life. He founded hospitals and cared for the poor. His liturgy is used in Orthodoxy.","Basil followed Jesus as a teacher. Basil was a Cappadocian Father who defended the Trinity and reformed monastic life.","Helped define Trinitarian theology and pioneered Christian social care."],[11,"Saint Benedict of Nursia","Both","Monk ‚Ä¢ Early","July 11","Europe, Students, Monks","Benedict founded Western monasticism through his Rule. He emphasized stability, prayer, and work. His communities preserved learning through the Middle Ages.","Benedict followed Jesus as a monk. Benedict founded Western monasticism through his Rule.","His Rule became the backbone of Western monastic life and culture."],[12,"Saint Bonaventure","Catholic","Mystic ‚Ä¢ Medieval","July 15","Theologians, Scholars","Bonaventure was a Franciscan theologian and Doctor of the Church. He united intellectual rigor and mysticism. His writings shaped medieval spirituality.","Bonaventure followed Jesus as a mystic. Bonaventure was a Franciscan theologian and Doctor of the Church.","Known as the 'Seraphic Doctor' for his mystical theology."],[13,"Saint Cecilia","Both","Martyr ‚Ä¢ Early","November 22","Musicians, Singers, Poets, Composers, Instrument makers, Orchestras, Choirs","Cecilia was a noble Christian woman who took a vow of virginity. Her pagan husband Valerian was converted by her faith. She was arrested and executed. Legend says she heard heavenly music on her wedding night.","Cecilia followed Jesus as a martyr. Cecilia was a noble Christian woman who took a vow of virginity.","Represents virgin martyrs and the sanctity of the body in Christian faith."],[14,"Saint Catherine of Siena","Catholic","Mystic ‚Ä¢ Medieval","April 29","Italy, Nurses, Fire prevention","Catherine was a Dominican tertiary who had visions and deep mystical experiences. She advised popes and helped bring the papacy back from Avignon to Rome. She is a Doctor of the Church.","Catherine followed Jesus as a mystic. Catherine was a Dominican tertiary who had visions and deep mystical experiences.","Influenced papal history; one of the great female Doctors of the Church."],[15,"Saint Cyril of Alexandria","Both","Teacher ‚Ä¢ Early","June 27","Theologians, Defenders of Mary as Theotokos","Cyril defended the title Theotokos at the Council of Ephesus and protected Christological orthodoxy. His theology shaped how Christians confess Christ as fully God and fully man.","Cyril followed Jesus as a teacher. Cyril defended the title Theotokos at the Council of Ephesus and protected Christological orthodoxy.","Key figure in the Council of Ephesus and Christological doctrine."],[16,"Saint Dominic","Catholic","Missionary ‚Ä¢ Medieval","August 8","Preachers, Astronomers, Against false witness","Dominic founded the Dominican Order dedicated to preaching and teaching. He emphasized truth, prayer, and compassionate evangelization.","Dominic followed Jesus as a missionary. Dominic founded the Dominican Order dedicated to preaching and teaching.","Founder of one of the Church‚Äôs major teaching orders."],[17,"Saint Ephrem the Syrian","Both","Teacher ‚Ä¢ Early","June 9","Poets, Theologians, Spiritual songwriters","Ephrem wrote hymns and poems defending orthodox faith. His poetic theology shaped Eastern Christianity. He is a Doctor of the Church.","Ephrem followed Jesus as a teacher. Ephrem wrote hymns and poems defending orthodox faith.","A major theological poet; called the 'Harp of the Spirit.'"],[18,"Saint Francis of Assisi","Catholic","Missionary ‚Ä¢ Medieval","October 4","Animals, Peace, Environment","Francis renounced wealth, embraced poverty, and preached Christ‚Äôs love to all creation. He is known for joy, simplicity, and radical imitation of Christ.","Francis followed Jesus as a missionary. Francis renounced wealth, embraced poverty, and preached Christ‚Äôs love to all creation.","Founder of the Franciscans; iconic witness to poverty and peace."],[19,"Saint Gregory the Great","Catholic","Teacher ‚Ä¢ Early","September 3","Popes, Musicians, Scholars","Gregory was a pope who reformed liturgy, cared for the poor, and strengthened missionary work. Gregorian chant bears his name.","Gregory followed Jesus as a teacher. Gregory was a pope who reformed liturgy, cared for the poor, and strengthened missionary work.","His leadership shaped Western worship and pastoral practice."],[20,"Saint Gregory of Nyssa","Both","Teacher ‚Ä¢ Early","March 9","Mystics, Theologians","Gregory of Nyssa was a Cappadocian Father known for mystical theology and deep reflections on the Trinity and spiritual growth.","Gregory followed Jesus as a teacher. Gregory of Nyssa was a Cappadocian Father known for mystical theology and deep reflections on the Trinity and spiritual growth.","Major contributor to Trinitarian theology and mystical tradition."],[21,"Saint Ignatius of Antioch","Both","Martyr ‚Ä¢ Early","October 17","Bishops, Theologians","Ignatius was bishop of Antioch and wrote letters on the way to martyrdom in Rome. He emphasized unity with the bishop and the Eucharist as central to the Church.","Ignatius followed Jesus as a martyr. Ignatius was bishop of Antioch and wrote letters on the way to martyrdom in Rome.","Early witness to Eucharistic realism and church order."],[22,"Saint Irenaeus","Both","Teacher ‚Ä¢ Early","June 28","Theologians, Against heresy","Irenaeus fought Gnosticism and emphasized the unity of Scripture and apostolic tradition. He wrote 'Against Heresies' and taught that Christ recapitulates humanity.","Irenaeus followed Jesus as a teacher. Irenaeus fought Gnosticism and emphasized the unity of Scripture and apostolic tradition.","Key early theologian linking apostles to later Church."],[23,"Saint John Chrysostom","Both","Teacher ‚Ä¢ Early","November 13","Preachers, Rhetoricians","John 'Golden Mouth' preached powerfully about repentance, mercy, and caring for the poor. His liturgy is central in Orthodox worship.","John followed Jesus as a teacher. John 'Golden Mouth' preached powerfully about repentance, mercy, and caring for the poor.","His Divine Liturgy is the most commonly celebrated in Orthodoxy."],[24,"Saint John Paul II","Catholic","Teacher ‚Ä¢ Modern","October 22","Youth, Families, Human dignity","John Paul II emphasized human dignity, forgiveness, and prayer. He supported ecumenical dialogue and encouraged youth to holiness.","John followed Jesus as a teacher. John Paul II emphasized human dignity, forgiveness, and prayer.","Popularized World Youth Day; significant ecumenical outreach."],[25,"Saint Justin Martyr","Both","Martyr ‚Ä¢ Early","June 1","Philosophers, Apologists","Justin was a philosopher who converted to Christianity and defended the faith to Roman authorities. He described early Christian worship and died as a martyr.","Justin followed Jesus as a martyr. Justin was a philosopher who converted to Christianity and defended the faith to Roman authorities.","One of the earliest apologists describing the Mass/Liturgy."],[26,"Saint Macrina the Younger","Both","Teacher ‚Ä¢ Early","July 19","Women, Monastics","Macrina was a sister of Basil the Great and Gregory of Nyssa. She shaped monastic communities and influenced theological thought through her holiness.","Macrina followed Jesus as a teacher. Macrina was a sister of Basil the Great and Gregory of Nyssa.","Influenced Cappadocian Fathers; model of female monastic leadership."],[27,"Saint Monica","Both","Mystic ‚Ä¢ Early","August 27","Mothers, Mothers of difficult children, Widows, Patience, Perseverance in prayer, Difficult children, Suffering mothers, Pray for wayward children","Monica was Augustine's mother. She prayed constantly for his conversion for 12 years. She pursued him across lands, never giving up faith. Her prayers were answered and Augustine became a greatest theologian and saint.","Monica followed Jesus as a mystic. Monica was Augustine's mother.","Shows the power of mother's persevering prayer. Demonstrates grace of conversion."],[28,"Saint Nicholas of Myra","Both","Bishop ‚Ä¢ Early","December 6","Children, Sailors, Gift-givers","Nicholas was known for secret generosity to the poor and courageous faith under persecution. He inspired the later Santa tradition.","Nicholas followed Jesus as a bishop. Nicholas was known for secret generosity to the poor and courageous faith under persecution.","Widely venerated across East and West; source of Santa legends."],[29,"Saint Paul","Both","Apostle ‚Ä¢ Early","June 29","Missionaries, Tentmakers, Conversion, Courage, Writers","Paul persecuted Christians until Christ confronted him on the road to Damascus. He became the great missionary apostle and wrote many New Testament letters.","Paul followed Jesus as a apostle. Paul persecuted Christians until Christ confronted him on the road to Damascus.","His letters shaped Christian theology and mission."],[30,"Saint Peter","Both","Apostle ‚Ä¢ Early","June 29","Fishermen, Popes, Rome","Peter was a fisherman named Simon. Jesus renamed him ‚ÄúRock‚Äù and entrusted him with strengthening the brethren. Peter denied Jesus three times, repented, and became a bold preacher. Tradition holds he was martyred in Rome.","Peter messed up‚Äîbut he said sorry and Jesus still loved him. God helps us start over.","Peter and Paul are celebrated together on June 29 in many traditions."],[31,"Saint Polycarp of Smyrna","Both","Martyr ‚Ä¢ Early","February 23","Hearing, Ear diseases, Healing, Protection against heresy, Courage, Strength, Suffering","Polycarp was a student of Saint John the Apostle who became bishop of Smyrna. At age 86, he was arrested during Roman persecution. He refused to curse Christ. They tried burning him but fire wouldn't consume him, so he was executed by sword.","Polycarp followed Jesus as a martyr. Polycarp was a student of Saint John the Apostle who became bishop of Smyrna.","One of the earliest documented martyrdoms and links to apostolic tradition."],[32,"Saint Teresa of √Åvila","Catholic","Mystic ‚Ä¢ Medieval","October 15","Spiritual directors, Writers, Mystics","Teresa reformed the Carmelite order and wrote classics of mystical prayer. She emphasized interior prayer and friendship with Christ.","Teresa followed Jesus as a mystic. Teresa reformed the Carmelite order and wrote classics of mystical prayer.","Doctor of the Church; major figure in Christian mysticism."],[33,"Saint Th√©r√®se of Lisieux","Catholic","Mystic ‚Ä¢ Modern","October 1","Missionaries, Spiritual depth, Childhood spirituality, Ordinary holiness, Depression, Finding meaning in small things","Th√©r√®se wanted to be a missionary but got tuberculosis and entered a Carmelite convent. She did ordinary things with great love‚Äîthe 'Little Way.' She died at 24 and was canonized in 1925.","Th√©r√®se followed Jesus as a mystic. Th√©r√®se wanted to be a missionary but got tuberculosis and entered a Carmelite convent.","Revolutionized understanding of holiness through ordinary life and small acts."],[34,"Saint Valentine","Both","Martyr ‚Ä¢ Early","February 14","Love, Affection, Young people, Engaged couples, Marriage, Lovers","Saint Valentine's historical identity is unclear. His feast day became associated with love, affection, and courtship. Medieval traditions made him the patron of lovers.","Valentine followed Jesus as a martyr. Saint Valentine's historical identity is unclear.","Shows how uncertain historical figures can embody spiritual truths."],[35,"Saint Vincent de Paul","Catholic","Missionary ‚Ä¢ Medieval","September 27","Charity, Hospitals, The poor, Those seeking charity work, Hospitals, Charitable organizations, Hospices, Sick, Those facing poverty","Vincent was a French priest dedicated to serving the poor. He founded the Vincentians and Daughters of Charity. He worked with prisoners, enslaved people, poor children, and the sick. He revolutionized charitable work.","Vincent followed Jesus as a missionary. Vincent was a French priest dedicated to serving the poor.","Revolutionized charitable work and religious service to the poor."],[36,"Saint Walburga","Both","Healer ‚Ä¢ Medieval","February 25","Women, Healing, Against plague, Strength, Against magic, Leprosy, Skin diseases, Famine, Hunger","Walburga was a nun and missionary. She worked in Germany healing the sick and converting pagans. She became Abbess. After her death, healing oil flowed from her reliquary.","Walburga followed Jesus as a healer. Walburga was a nun and missionary.","Shows healing power continuing after death through saint's intercession."],[37,"Saint Mary, Mother of God (Theotokos)","Both","Mother of Jesus","Aug 15 (Assumption/Dormition)","All Christians","Mary freely said yes to God‚Äôs plan. She carried Christ, raised Him, stood at the Cross, and prayed with the early Church. East and West honor her as Theotokos‚Äî‚ÄúGod-bearer.‚Äù","Mary trusted God even when she didn‚Äôt understand everything. Saying ‚Äúyes‚Äù to God is brave.","Orthodox speak of Dormition; Catholics speak of Assumption‚Äîboth honor her glorification."],[38,"Saint Seraphim of Sarov","Orthodox","Monk, Mystic","January 2","Spiritual direction, joy in Christ","Seraphim lived years in prayer and ascetic struggle. He welcomed visitors with radiant joy, greeting them: ‚ÄúChrist is risen, my joy!‚Äù and taught that the goal of life is acquiring the Holy Spirit.","Seraphim called people ‚Äúmy joy.‚Äù You can spread joy by being kind and praying.","One of the most beloved Russian saints."],[39,"Saint Maria of Paris","Orthodox","Nun, Martyr of Charity","July 20","Mercy and service, Social justice, Refugees, Compassion","A Russian Orthodox nun who served the poor and sheltered Jews during WWII. She was arrested and died in a concentration camp, remembered for courageous love.","Maria helped people in danger‚Äîeven when it was risky. Love can be brave.","Honored as a modern saint of active compassion."],[40,"Saint Francis Xavier","Catholic","Missionary ‚Ä¢ Medieval","December 3","Missionaries, Travelers","Francis Xavier was a Jesuit missionary who traveled to Asia, preaching and baptizing many. He is known for zeal and missionary courage.","Francis followed Jesus as a missionary. Francis Xavier was a Jesuit missionary who traveled to Asia, preaching and baptizing many.","One of the greatest Catholic missionaries; co-founder of the Jesuits."],[41,"Saint Teresa of Calcutta","Catholic","Missionary ‚Ä¢ Modern","September 5","The poor, The dying, Missionaries, Service, Compassion, Simple living, Humble service, Faithfulness to calling","Mother Teresa founded the Missionaries of Charity. She served the poorest of the poor in Calcutta. She became a global symbol of compassionate service.","Teresa followed Jesus as a missionary. Mother Teresa founded the Missionaries of Charity.","Canonized in 2016; iconic witness to charity."],[42,"Saint John of Damascus","Both","Teacher ‚Ä¢ Early","December 4","Theologians, Defenders of icons","John defended icons during the iconoclastic controversy and wrote theological works that shaped Eastern Christianity.","John followed Jesus as a teacher. John defended icons during the iconoclastic controversy and wrote theological works that shaped Eastern Christianity.","Major defender of icons and systematic theologian."],[43,"Saint Maximus the Confessor","Both","Martyr ‚Ä¢ Early","January 21","Theologians, Defenders of Christ‚Äôs two wills","Maximus defended the doctrine that Christ has two wills (divine and human). He suffered exile and mutilation for refusing heresy.","Maximus followed Jesus as a martyr. Maximus defended the doctrine that Christ has two wills (divine and human).","Key defender of dyothelitism; profound mystical theology."],[44,"Saint Mary of Egypt","Both","Penitent ‚Ä¢ Early","April 1","Penitents, Repentance","Mary lived a sinful life, repented radically, and spent decades in the desert as a hermit. She is a model of repentance.","Mary followed Jesus as a penitent. Mary lived a sinful life, repented radically, and spent decades in the desert as a hermit.","A powerful witness that repentance can transform a life completely."],[45,"Saint Nektarios of Aegina","Orthodox","Healer ‚Ä¢ Modern","November 9","Cancer, Healing, Miraculous healings","Nektarios endured slander and hardship, yet remained humble and faithful. He is associated with many healings, especially of cancer.","Nektarios prayed and stayed humble. People ask his prayers for healing.","A modern Orthodox saint known for miracles and humility."],[46,"Saint Paisios of Mount Athos","Orthodox","Healer ‚Ä¢ Modern","July 12","Serious illness, Spiritual direction","Paisios was a modern Athonite monk beloved for compassion and spiritual counsel. Many report healings and answered prayers through his intercession.","Paisios loved people and prayed. You can love people too.","Beloved modern Athonite monk."],[47,"Saint Gregory Palamas","Orthodox","Teacher ‚Ä¢ Medieval","November 14","Theologians, Mystics","Gregory Palamas defended hesychasm and taught about God‚Äôs energies and the possibility of real communion with God.","Gregory taught that God is near. You can talk to God.","Central figure in Orthodox mystical theology."],[48,"Saint Symeon the New Theologian","Orthodox","Mystic ‚Ä¢ Medieval","March 12","Mystics, Spiritual renewal","Symeon emphasized personal experience of the Holy Spirit and inner transformation. His teachings shaped Orthodox spirituality.","Symeon prayed deeply and loved God. You can pray too.","One of the three Orthodox saints titled ‚ÄúTheologian.‚Äù"],[49,"Saint Mary Magdalene","Both","Disciple ‚Ä¢ Early","July 22","Conversion, Redemption, Healing shame, Witnesses of Resurrection","Mary Magdalene was a disciple who witnessed the Resurrection and was sent to announce it. She is honored as a faithful follower of Christ.","Mary was brave and shared good news. You can share kindness too.","Called ‚ÄúApostle to the Apostles‚Äù in some traditions."],[50,"Saint Joseph","Both","Guardian ‚Ä¢ Early","March 19","Fathers, Workers, Family protection","Joseph protected Mary and Jesus, modeling quiet faithfulness.","Joseph cared for Jesus and Mary. You can be faithful in small, quiet ways too.","Patron of the universal Church; model of humble work."],[51,"Saint Agatha of Sicily","Both","Martyr ‚Ä¢ Early","February 5","Breast cancer, Breast disease, Women‚Äôs health, Abuse survivors, Nurses","Agatha was an early Christian martyr remembered for courage under persecution and refusal to renounce Christ. She is widely invoked for breast disease and women‚Äôs health.","Agatha was brave and stayed faithful. We ask her prayers for healing and courage.","A major patron saint for breast disease and breast cancer in popular devotion."],[52,"Saint Peregrine Laziosi","Catholic","Healer ‚Ä¢ Medieval","May 4","Cancer, Serious illness, Chronic illness, Caregivers","Peregrine was a Servite priest associated in popular devotion with healing from cancer. Many people ask his prayers when facing serious illness.","Peregrine helps people feel hope when they are sick. Pray and ask God for strength.","Often called a patron saint for those with cancer."],[53,"Servant of God Dorothy Day","Catholic","Witness ‚Ä¢ Modern","November 29","Despair, Suicidal thoughts, Hope, Community, Social justice","Dorothy Day was a Catholic writer and activist who founded the Catholic Worker Movement. Many people look to her for hope in despair and for courage to live a faithful life of mercy.","Dorothy helped poor people and loved Jesus. You can do one kind thing today.","Known for the Catholic Worker Movement and radical works of mercy."],[54,"Saint Carlo Acutis","Catholic","Witness ‚Ä¢ Modern","October 12","Internet, Technology, Digital ethics, Youth, Leukemia","Carlo was a modern teenager known for joyful faith and for using the internet to share Eucharistic miracles and devotion. He is often invoked for help with technology habits and youth holiness.","Carlo loved Jesus and used computers for good. Use your screen time with love.","Sometimes called a patron for internet and digital life."],[55,"Saint Josephine Bakhita","Catholic","Witness ‚Ä¢ Modern","February 8","Human trafficking, Slavery survivors, Trauma healing, Freedom","Bakhita survived slavery and became a religious sister. She is honored for forgiveness, dignity, and healing from trauma.","Bakhita shows God can heal deep wounds. Be kind and brave.","A major patron for survivors of trafficking and slavery."],[56,"Saint John Maximovitch","Orthodox","Bishop ‚Ä¢ Modern","July 2","Refugees, Immigrants, Orphans, Diaspora","John (Maximovitch) was a modern Orthodox bishop known for holiness and compassion, especially toward refugees and the vulnerable.","John cared for people far from home. God cares for you too.","Often invoked for refugees and immigrants."],[57,"Saint Pier Giorgio Frassati","Catholic","Witness ‚Ä¢ Modern","July 4","Youth, Social justice, Service, Courage","Pier Giorgio was a young layman known for joy, mountain hikes, and serving the poor. He is often invoked by young people and those drawn to active charity.","Pier Giorgio helped the poor and loved adventure. Love God and serve people.","A beloved patron for youth and students."],[58,"Saint Anthony of Padua","Catholic","Teacher ‚Ä¢ Medieval","June 13","Lost things, Finding lost loves, Help in need, Students","Anthony was a Franciscan preacher known for Scripture teaching and for being asked for help when things are lost or when people need guidance.","Anthony helps when you lose things. Ask for help and stay calm.","Commonly invoked when something is lost."],[59,"Saint Bartolo Longo","Catholic","Witness ‚Ä¢ Modern","October 5","Leaving occultism, Spiritual liberation, Rosary devotion","Bartolo Longo converted from occult practices and became a major promoter of the Rosary and works of mercy.","Bartolo shows you can start over and choose God.","Associated with Rosary devotion and conversion from the occult."],[60,"Saint Benedict Joseph Labre","Catholic","Witness ‚Ä¢ Early","April 16","Severe mental illness, Homelessness, Social isolation, Loneliness","Benedict Joseph Labre lived as a pilgrim and endured hardship and social isolation. Many people look to him for compassion toward those struggling with mental illness and loneliness.","Benedict reminds us to love people who feel alone.","Often associated with care for the homeless and those with mental illness."],[61,"Saint Ezekiel Moreno","Catholic","Bishop ‚Ä¢ Modern","August 19","Cancer acceptance, Terminal illness, Courage","Ezekiel Moreno is invoked by some for strength and peace when facing terminal illness.","Ezekiel teaches courage and trust in God.","Associated in devotion with accepting serious illness."],[62,"Saint Gemma Galgani","Catholic","Mystic ‚Ä¢ Modern","April 11","Back pain, Spinal pain, Chronic pain","Gemma endured suffering with deep prayer and is invoked by some for help with chronic pain.","Gemma teaches prayer in pain.","Associated with chronic pain in popular devotion."],[63,"Saint Josemaria Escriva","Catholic","Teacher ‚Ä¢ Modern","June 26","Work holiness, Daily life, Diabetes (devotional association)","Josemaria taught holiness in ordinary life and work. Some people invoke him for help living faith in daily routines.","Josemaria teaches you can love God in ordinary work.","Founder of Opus Dei."],[64,"Saint Felicity","Both","Martyr ‚Ä¢ Early","March 7","Mothers, Childbirth, Courage, Difficult seasons","Felicity is honored as an early Christian martyr and is often associated in devotion with mothers and courage in difficult seasons.","Felicity was brave and loved Jesus.","Known as an early martyr remembered for courage."],[65,"Saint Paraskeva","Orthodox","Martyr ‚Ä¢ Early","October 14","Women‚Äôs health, Fertility, Protection","Paraskeva is venerated in the Orthodox Church and is invoked by many for women‚Äôs health needs.","Paraskeva teaches faithful courage.","A widely venerated Orthodox saint in many countries."]];

    // Convert packed rows into objects expected by the UI
    const saintsRaw = saintsPacked.map(row => ({
      id: row[0],
      name: row[1],
      tradition: row[2],
      role: row[3],
      feast: row[4],
      patronage: row[5],
      story: row[6],
      kidFriendly: row[7],
      interestingFact: row[8],
    }));

    // Dedupe by (name + tradition). Keep the richer record.
    const saintsMap = new Map();
    for (const s of saintsRaw) {
      const key = `${(s.name||'').trim().toLowerCase()}|${(s.tradition||'').trim()}`;
      const existing = saintsMap.get(key);
      if (!existing) {
        saintsMap.set(key, s);
        continue;
      }
      const score = (x) => ((x.story||'').length + (x.patronage||'').length + (x.interestingFact||'').length);
      if (score(s) > score(existing)) saintsMap.set(key, s);
    }

    const saints = Array.from(saintsMap.values())
      .sort((a,b) => (a.name||'').localeCompare(b.name||''))
      .map((s, idx) => ({ ...s, id: idx + 1 }));

    const rituals = [
      {
        id: 1,
        name: 'The Sign of the Cross',
        icon: '‚úùÔ∏è',
        catholic: 'Made left to right (forehead, chest, left shoulder, right shoulder), praying: ‚ÄúIn the name of the Father, and of the Son, and of the Holy Spirit.‚Äù',
        orthodox: 'Made right to left (forehead, chest, right shoulder, left shoulder), with three fingers together for the Trinity and two fingers folded for Christ‚Äôs two natures.',
        meaning: 'Both mark the body with Christ‚Äôs redemption and confess the Trinity. Orthodoxy often emphasizes the gesture as embodied theology (Trinity + Incarnation).',
        history: 'The direction differs by custom across East/West. Both are ancient, both meaningful, neither ‚Äúinvalid.‚Äù'
      },
      {
        id: 2,
        name: 'Holy Water: Font vs. Theophany Blessing',
        icon: 'üíß',
        catholic: 'Often at the entrance as a reminder of baptism; used to bless oneself and homes as a sacramental.',
        orthodox: 'Blessed prominently at Theophany (Christ‚Äôs Baptism). Often taken home and used devotionally; some traditions drink it reverently.',
        meaning: 'Both see creation sanctified by God. Orthodoxy strongly highlights the Spirit sanctifying matter through blessing prayers.',
        history: 'Different liturgical emphases shaped different common habits.'
      },
      {
        id: 3,
        name: 'Icons vs. Statues',
        icon: 'üñºÔ∏è',
        catholic: 'Icons and statues are both used; statues are common in the West as devotional art.',
        orthodox: 'Icons are central‚Äîkissed, incensed, carried in procession. Statues are rare in liturgical space.',
        meaning: 'Icons are ‚Äúwindows to heaven,‚Äù tied to the Incarnation: because Christ took flesh, He can be depicted. Veneration passes to the person depicted.',
        history: 'The 8th‚Äì9th century icon controversy in the East clarified icon theology and practice.'
      },
      {
        id: 4,
        name: 'The Altar: Visible vs. Iconostasis',
        icon: '‚õ™',
        catholic: 'The altar is visible; emphasis on gathered participation around the Eucharistic celebration.',
        orthodox: 'The altar is behind the iconostasis; emphasis on mystery and the Holy of Holies imagery.',
        meaning: 'Both understand the Eucharist as sacred. The difference is how sacred space is expressed architecturally.',
        history: 'Eastern temple imagery developed as iconostasis became more elaborate.'
      },
      {
        id: 5,
        name: 'Incense',
        icon: 'üí®',
        catholic: 'Used especially in solemn Masses: honoring altar, Gospel, gifts, people; prayers rising to heaven.',
        orthodox: 'Used constantly and comprehensively: altar, icons, clergy, people; worship engages every sense.',
        meaning: 'Both connect incense to prayer and holiness. Orthodoxy uses it as a structural element of worship.',
        history: 'Both draw from temple worship patterns and early Christian practice.'
      },
      {
        id: 6,
        name: 'Ash Wednesday vs. Forgiveness Sunday',
        icon: 'ü•£',
        catholic: 'Ashes mark repentance and mortality at the beginning of Lent.',
        orthodox: 'Lent begins with Forgiveness Sunday: asking each other‚Äôs forgiveness before fasting.',
        meaning: 'Catholic: repentance marked publicly. Orthodox: repentance begins relationally‚Äîreconciliation.',
        history: 'Different devotional developments in West/East.'
      },
      {
        id: 7,
        name: 'Prayer Rope vs. Rosary',
        icon: 'üßµ',
        catholic: 'Rosary: meditative prayer with decades, typically focused on Gospel mysteries.',
        orthodox: 'Prayer rope (komboskini): repetitive Jesus Prayer (‚ÄúLord Jesus Christ, Son of God, have mercy on me, a sinner.‚Äù).',
        meaning: 'Both train the heart through repetition and contemplation‚Äîdifferent forms, similar purpose.',
        history: 'Both developed from early monastic practices of counted prayer.'
      },
      {
        id: 8,
        name: 'Leavened vs. Unleavened Bread',
        icon: 'üçû',
        catholic: 'Latin Rite typically uses unleavened bread in the Eucharist; Eastern Catholic rites often use leavened.',
        orthodox: 'Uses leavened bread, symbolizing the risen Christ and the living Church.',
        meaning: 'Both affirm real presence. The bread type becomes a symbol of different theological emphases (Passover vs. Resurrection symbolism).',
        history: 'Divergent liturgical customs hardened into identity markers over time.'
      }
    ];

    const conversations = [
      {
        id: 1,
        title: 'Why Do You Make the Cross Backwards?',
        topic: 'Sign of the Cross',
        tags: ['Gesture', 'Trinity', 'Tradition'],
        speakers: ['Father Dimitri (Orthodox)', 'Mrs. Catherine (Catholic)'],
        context: 'At a church service, Catherine notices Father Dimitri crosses himself right to left.',
        exchange: [
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúFather, I noticed you cross yourself the opposite way from how I do it. I go left to right. Is that‚Ä¶ wrong?‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúNot wrong at all. Different traditions. We cross right to left‚Äîboth confess the same Trinity.‚Äù' },
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúIs there a reason, or is it just custom?‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúSome say it‚Äôs like crossing from Christ‚Äôs perspective‚ÄîHis right hand blesses. But the heart matters most.‚Äù' },
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo if I‚Äôm visiting your parish, should I cross your way?‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúYou may, out of hospitality‚Äîbut God isn‚Äôt grading the direction. Pray with reverence.‚Äù' }
        ]
      },
      {
        id: 2,
        title: 'Holy Water: Why Do You Take It Home?',
        topic: 'Holy Water Blessing',
        tags: ['Sacramentals', 'Theophany', 'Healing'],
        speakers: ['Father John (Orthodox)', 'Father Michael (Catholic)'],
        context: 'Two priests visit each other‚Äôs churches after a joint prayer service.',
        exchange: [
          { speaker: 'Father Michael', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúJohn, I see your people taking home bottles of holy water. We bless holy water too, but it‚Äôs less central.‚Äù' },
          { speaker: 'Father John', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúAt Theophany we bless water with special prayers. People use it in homes, and some drink it reverently.‚Äù' },
          { speaker: 'Father Michael', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúWe‚Äôre careful about superstition. But I wonder if we‚Äôve grown shy about matter being truly blessed.‚Äù' },
          { speaker: 'Father John', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúExactly‚ÄîIncarnation means God works through created things. Not magic‚Äîgrace.‚Äù' }
        ]
      },
      {
        id: 3,
        title: 'Icons vs. Statues: Are We Worshiping Images?',
        topic: 'Religious Art',
        tags: ['Icons', 'Veneration', 'Idolatry'],
        speakers: ['Sister Mary (Catholic)', 'Sister Thekla (Orthodox)'],
        context: 'Two sisters walk through each other‚Äôs churches.',
        exchange: [
          { speaker: 'Sister Mary', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúWe have statues everywhere. You have icons everywhere. Do you worry people worship images?‚Äù' },
          { speaker: 'Sister Thekla', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúWe worship God alone. We venerate icons. Honor passes to the person depicted.‚Äù' },
          { speaker: 'Sister Mary', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo kissing an icon is like kissing a photo of someone you love?‚Äù' },
          { speaker: 'Sister Thekla', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúYes‚Äîwith the added truth that Christ truly sanctified matter by becoming flesh.‚Äù' }
        ]
      },
      {
        id: 4,
        title: 'Sunday Worship: Rule or Relationship?',
        topic: 'Mass Obligation',
        tags: ['Sunday', 'Discipline', 'Conscience'],
        speakers: ['Father Dimitri (Orthodox)', 'Mrs. Catherine (Catholic)'],
        context: 'At Sunday dinner, the family compares how each tradition speaks about obligation.',
        exchange: [
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúFor Catholics, Sunday Mass is a precept. It‚Äôs not optional‚Äîunless there‚Äôs a serious reason.‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúWe emphasize the heart: worship as healing. But discipline matters too‚Äîjust expressed differently.‚Äù' },
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo we both want faithfulness‚Ä¶ we just talk about it with different language.‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúExactly. The question is: does the rule lead you to love Christ more?‚Äù' }
        ]
      },
      {
        id: 5,
        title: 'Filioque: Why One Word Matters',
        topic: 'Filioque',
        tags: ['Creed', 'Trinity', 'History'],
        speakers: ['Nikos (Orthodox)', 'Anna (Catholic)'],
        context: 'At dinner, someone notices the Creed wording differs: ‚Äúproceeds from the Father‚Äù vs ‚Äúfrom the Father and the Son.‚Äù',
        exchange: [
          { speaker: 'Anna', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúWe say the Spirit proceeds from the Father and the Son. Do you think that‚Äôs heresy?‚Äù' },
          { speaker: 'Nikos', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúOur concern is twofold: theology and process. The Father is the single source. And the Creed wasn‚Äôt meant to be changed unilaterally.‚Äù' },
          { speaker: 'Anna', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúCatholics mean ‚Äòthrough the Son‚Äô‚Äînot that the Son replaces the Father as source.‚Äù' },
          { speaker: 'Nikos', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúThen we‚Äôre closer than people think. But words shape prayer. Let‚Äôs be careful.‚Äù' }
        ]
      },
      {
        id: 6,
        title: 'Purgatory: Healing After Death?',
        topic: 'Purgatory',
        tags: ['Afterlife', 'Mercy', 'Prayer for the Dead'],
        speakers: ['Maria (Catholic)', 'Yannis (Orthodox)'],
        context: 'Someone asks why Catholics talk about purgatory and Orthodox often don‚Äôt use that exact term.',
        exchange: [
          { speaker: 'Maria', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúPurgatory is God finishing His healing. Not a second chance‚Äîpurification for those headed to heaven.‚Äù' },
          { speaker: 'Yannis', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúWe pray for the departed too. We just resist tight definitions‚Äîmystery. But we agree God is merciful.‚Äù' },
          { speaker: 'Maria', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo the shared point is: prayer for the dead matters.‚Äù' },
          { speaker: 'Yannis', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúYes. And repentance is urgent now.‚Äù' }
        ]
      },
      {
        id: 7,
        title: 'The Eucharist: How Can It Be Bread and God?',
        topic: 'Eucharist',
        tags: ['Real Presence', 'Mystery', 'Worship'],
        speakers: ['Father Michael (Catholic)', 'Father Alexei (Orthodox)'],
        context: 'A teen asks: ‚ÄúHow can it be real?‚Äù',
        exchange: [
          { speaker: 'Teen', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo‚Ä¶ do you literally believe it becomes Jesus?‚Äù' },
          { speaker: 'Father Michael', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúYes. We say the substance changes‚Äîtransubstantiation‚Äîwhile appearances remain.‚Äù' },
          { speaker: 'Father Alexei', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúWe say: Christ is truly present. And we guard the mystery‚Äîbecause God‚Äôs work exceeds our categories.‚Äù' },
          { speaker: 'Teen', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúSo you agree it‚Äôs real. You just explain it differently.‚Äù' },
          { speaker: 'Father Alexei', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúExactly. Don‚Äôt reduce a mystery to a diagram.‚Äù' }
        ]
      },
      {
        id: 8,
        title: 'Marriage, Divorce, and Mercy',
        topic: 'Divorce',
        tags: ['Marriage', 'Pastoral Care', 'Discipline'],
        speakers: ['Elena (Orthodox)', 'James (Catholic)'],
        context: 'Someone brings up a painful family divorce and asks why practices differ.',
        exchange: [
          { speaker: 'James', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúCatholics treat marriage as indissoluble. Annulment means it wasn‚Äôt a true sacramental marriage to begin with.‚Äù' },
          { speaker: 'Elena', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúWe also honor lifelong marriage, but we can allow remarriage in some cases as a concession‚Äîmedicine for brokenness.‚Äù' },
          { speaker: 'James', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúDifferent pastoral tools‚Ä¶ same desire: to protect love and truth.‚Äù' },
          { speaker: 'Elena', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúAnd to avoid crushing people already wounded.‚Äù' }
        ]
      }
    ];

    const commandments = [
      {
        num: '1st',
        catholic: '‚ÄúThou shalt have no other gods before Me.‚Äù',
        origin: 'Given at Mount Sinai as the foundation of covenant freedom.',
        why: 'Protects the human heart from worshiping created things as ultimate.',
        deeper: 'Idols aren‚Äôt only statues‚Äîanything that becomes ultimate: money, approval, control.',
        kidExplanation: 'If something becomes more important than God and love‚Äîlike a phone or a game‚Äîthat thing starts to boss your heart around.'
      },
      {
        num: '2nd',
        catholic: '‚ÄúThou shalt not make idols or bow down to them.‚Äù',
        origin: 'Guardrails for worship‚ÄîGod can‚Äôt be reduced to a thing.',
        why: 'We honor holy images without worshiping them (veneration vs worship).',
        deeper: 'Honor shown to an image can pass to the one depicted‚Äîespecially in icon theology.',
        kidExplanation: 'A picture of grandma isn‚Äôt grandma. You love grandma, not the photo. Icons point your love to the real person.'
      },
      {
        num: '3rd',
        catholic: '‚ÄúThou shalt not take the name of the Lord thy God in vain.‚Äù',
        origin: 'Reverence for God‚Äôs name in speech and oath.',
        why: 'Words shape the soul. God‚Äôs name isn‚Äôt a toy or a curse word.',
        deeper: 'This includes using God‚Äôs name to justify cruelty or lies.',
        kidExplanation: 'Don‚Äôt use God‚Äôs name like a swear word. And don‚Äôt say ‚ÄúGod told me‚Äù to boss people.'
      },
      {
        num: '4th',
        catholic: '‚ÄúRemember the Sabbath day, to keep it holy.‚Äù',
        origin: 'A weekly rhythm of rest and worship.',
        why: 'Humans are not machines. Rest is holy: it says God provides.',
        deeper: 'Sunday worship forms the heart: gratitude, humility, and joy.',
        kidExplanation: 'One day a week you rest, go to church, and love your family. God made you to breathe.'
      },
      {
        num: '5th',
        catholic: '‚ÄúHonor thy father and mother.‚Äù',
        origin: 'Family as the first school of love and authority.',
        why: 'Protects the vulnerable and builds a stable community.',
        deeper: 'Honor means dignity and care, even when relationships are complex.',
        kidExplanation: 'Treat your parents with respect. And when they‚Äôre older, help them‚Äîlike they helped you.'
      },
      {
        num: '6th',
        catholic: '‚ÄúThou shalt not murder.‚Äù',
        origin: 'Life bears God‚Äôs image.',
        why: 'Protects the sacredness of human life.',
        deeper: 'Christ deepens it: hatred and contempt are seeds of violence.',
        kidExplanation: 'Don‚Äôt hurt people. And don‚Äôt let hate grow in your heart.'
      },
      {
        num: '7th',
        catholic: '‚ÄúThou shalt not commit adultery.‚Äù',
        origin: 'Protects marriage as covenant.',
        why: 'Faithfulness guards trust and dignity.',
        deeper: 'Love is not just feelings‚Äîlove is promises kept.',
        kidExplanation: 'Marriage is a forever promise. Breaking it hurts everyone.'
      },
      {
        num: '8th',
        catholic: '‚ÄúThou shalt not steal.‚Äù',
        origin: 'Protects justice and the fruit of labor.',
        why: 'Without trust, society collapses.',
        deeper: 'The opposite of stealing is generosity.',
        kidExplanation: 'Don‚Äôt take what isn‚Äôt yours‚Äînot toys, not money, not credit.'
      },
      {
        num: '9th',
        catholic: '‚ÄúThou shalt not bear false witness.‚Äù',
        origin: 'Truth-telling undergirds justice.',
        why: 'Lies dissolve trust.',
        deeper: 'Gossip and slander are also forms of false witness.',
        kidExplanation: 'Don‚Äôt lie. Don‚Äôt spread stories about people. Truth builds trust.'
      },
      {
        num: '10th',
        catholic: '‚ÄúThou shalt not covet.‚Äù',
        origin: 'Targets the heart, not only actions.',
        why: 'Jealous desire gives birth to many sins.',
        deeper: 'Gratitude is the medicine for coveting.',
        kidExplanation: 'Be happy for what you have. Be happy for your friends too.'
      }
    ];

    const practices = [
      {
        id: 1,
        title: 'Catholic Sunday Mass Obligation',
        category: 'Practice',
        content: 'Catholics treat Sunday worship as a binding precept because Sunday is the day of Resurrection. The precept protects the soul from drift and keeps the community gathered around the Eucharist.'
      },
      {
        id: 2,
        title: 'Orthodox Divine Liturgy: Heaven on Earth',
        category: 'Practice',
        content: 'Orthodox worship is often longer and highly sensory‚Äîicons, chant, incense, bowing‚Äîbecause worship is participation in the heavenly liturgy. The goal is transformation, not efficiency.'
      },
      {
        id: 3,
        title: 'Confession: Booth vs. Icon',
        category: 'Practice',
        content: 'Catholics often confess privately with a screen; Orthodox commonly confess before an icon with the priest nearby. Both seek repentance, healing, and absolution. The form highlights different pastoral instincts.'
      },
      {
        id: 4,
        title: 'Orthodox Fasting: Spiritual Training',
        category: 'Practice',
        content: 'Fasting is spiritual training‚Äîteaching the body to obey the spirit. It is not punishment; it is medicine. It pairs with prayer and almsgiving.'
      },
      {
        id: 5,
        title: 'Catholic Stations of the Cross',
        category: 'Practice',
        content: 'A devotional walk through Christ‚Äôs Passion, especially in Lent. It teaches compassion and repentance by entering the story physically and imaginatively.'
      },
      {
        id: 6,
        title: 'Orthodox Pascha: The Feast of Feasts',
        category: 'Practice',
        content: 'Pascha is celebrated with the proclamation ‚ÄúChrist is risen!‚Äù The service begins in darkness and erupts into light‚Äîsymbolizing Christ‚Äôs victory over death.'
      },
      {
        id: 7,
        title: 'Prayer for the Departed',
        category: 'Practice',
        content: 'Both traditions pray for the dead. Catholics connect this to purification; Orthodox emphasize mystery and mercy. Either way, the living and departed remain united in love.'
      }
    ];

    const foundations = [
      {
        id: 1,
        title: 'Authority: Pope vs. Councils',
        icon: 'üëë',
        description: 'How binding decisions about faith are made.',
        deepDive: 'CATHOLIC: The Pope, as successor of Peter, can teach infallibly under specific conditions. This emphasizes visible unity and decisive clarity.\n\nORTHODOX: Councils of bishops discern together. No single bishop has universal jurisdiction. This emphasizes conciliar wisdom and guarding against unilateral change.\n\nDINNER TIP: Ask: ‚ÄúWhat kind of unity did the early Church practice, and what changed later?‚Äù'
      },
      {
        id: 2,
        title: 'Salvation: Justification vs. Theosis',
        icon: '‚ú®',
        description: 'What does it mean to be saved?',
        deepDive: 'CATHOLIC: Emphasizes justification and sanctification‚Äîbeing made righteous by grace and cooperating with it.\n\nORTHODOX: Emphasizes theosis‚Äîunion with God, becoming by grace what God is by nature (without becoming God by nature).\n\nDINNER TIP: Ask: ‚ÄúWhen you picture salvation, do you picture a courtroom, a hospital, or a family?‚Äù'
      },
      {
        id: 3,
        title: 'Original Sin: Guilt vs. Ancestral Sin',
        icon: 'üåø',
        description: 'How we describe humanity‚Äôs fallen condition.',
        deepDive: 'CATHOLIC: Often frames original sin with inherited deprivation and a need for healing; Western theology sometimes uses legal language.\n\nORTHODOX: Often speaks of ancestral sin‚Äîinheritance of corruption and death rather than inherited personal guilt.\n\nDINNER TIP: Ask: ‚ÄúDo you think sin is mainly guilt to be forgiven, or sickness to be healed‚Äîor both?‚Äù'
      },
      {
        id: 4,
        title: 'The Holy Spirit: Filioque & the Creed',
        icon: 'üïäÔ∏è',
        description: 'Why one phrase in the Creed became a dividing line.',
        deepDive: 'CATHOLIC: Teaches the Spirit proceeds from the Father and the Son (often explained as ‚Äúfrom the Father through the Son‚Äù), emphasizing communion between Father and Son.\n\nORTHODOX: Teaches the Spirit proceeds from the Father alone as source, emphasizing the Father as single font of divinity and objecting to unilateral Creed changes.\n\nDINNER TIP: Ask: ‚ÄúIs the bigger issue the theology, or the authority to change the Creed?‚Äù'
      }
    ];

    const theologyTopics = [
      {
        id: 1,
        title: 'Mary: Immaculate Conception vs. Different Frameworks',
        question: 'Catholics define Mary‚Äôs Immaculate Conception; Orthodox honor Mary deeply but do not frame it the same way. Why?',
        catholicView: 'Mary was preserved from original sin from conception by Christ‚Äôs merits‚Äîpreparing her uniquely as Theotokos.',
        orthodoxView: 'Mary is all-holy and uniquely honored, but Orthodoxy uses a different understanding of ancestral sin and avoids late dogmatic definitions; emphasis is on Mary‚Äôs free cooperation with grace.',
        sharedTruth: 'Both honor Mary as Theotokos and the most exalted saint; both affirm her purity and unique role in salvation history.'
      },
      {
        id: 2,
        title: 'The Eucharist: Transubstantiation vs. Guarded Mystery',
        question: 'Catholics define transubstantiation; Orthodox affirm the Real Presence but often avoid scholastic definitions. Why?',
        catholicView: 'A precise term protects the truth that Christ is truly present‚Äîsubstance changes though appearances remain.',
        orthodoxView: 'Christ is truly present, but the ‚Äúhow‚Äù is mystery; the Holy Spirit‚Äôs epiclesis is emphasized and excessive definition is avoided.',
        sharedTruth: 'Both affirm the Eucharist is the central sacrament and truly Christ‚ÄîBody and Blood, not a mere symbol.'
      },
      {
        id: 3,
        title: 'Purgatory: Defined State vs. Prayerful Mystery',
        question: 'Catholics speak clearly about purgatory; Orthodox pray for the departed without the same definitions. What is going on?',
        catholicView: 'Purgatory is purification for the saved‚ÄîGod finishing His healing work so the soul can enter heaven fully purified.',
        orthodoxView: 'The departed are in God‚Äôs mercy; we pray for them, but we avoid a detailed mapped ‚Äúsystem,‚Äù leaving much to mystery.',
        sharedTruth: 'Both pray for the dead and trust God‚Äôs mercy and justice; both reject a ‚Äúsecond chance‚Äù for unrepentant hardening.'
      },
      {
        id: 4,
        title: 'Authority: Universal Jurisdiction vs. Primacy of Honor',
        question: 'Did the early Church understand Rome‚Äôs primacy as jurisdiction, or honor? And can that change?',
        catholicView: 'Peter‚Äôs ministry continues through the pope with a real authority to safeguard unity and doctrine.',
        orthodoxView: 'Rome had primacy of honor in the first millennium, but not universal jurisdiction; unity is conciliar.',
        sharedTruth: 'Both believe bishops succeed the apostles and that unity matters profoundly.'
      }
    ];

    const historyMoments = [
      {
        id: 1,
        title: 'One Church, Many Cultures (33‚Äì1054)',
        year: '33‚Äì1054',
        story: 'For centuries, East and West were in communion while developing different languages, liturgies, and customs. Unity existed amid diversity‚Äîuntil political, cultural, and theological tensions accumulated.'
      },
      {
        id: 2,
        title: 'The Great Schism (1054)',
        year: '1054',
        story: 'Mutual excommunications symbolized a deeper rupture already underway. The split unfolded over time through misunderstandings, competing claims, and shifting power.'
      },
      {
        id: 3,
        title: 'Healing Steps: 1965 Lifting of Excommunications',
        year: '1965',
        story: 'Pope Paul VI and Patriarch Athenagoras lifted the 1054 excommunications. It did not restore full communion, but it reopened the door for dialogue and charity.'
      },
      {
        id: 4,
        title: 'Vatican II and Eastern Christians (1962‚Äì1965)',
        year: '1962‚Äì1965',
        story: 'Vatican II emphasized ecumenical dialogue and affirmed the validity of Eastern sacraments and apostolic succession‚Äîan important step in modern relations.'
      }
    ];

    const prayers = [
      {
        id: 1,
        title: "The Lord's Prayer",
        text: 'Our Father, who art in heaven, hallowed be Thy name; Thy kingdom come; Thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen.'
      },
      {
        id: 2,
        title: 'Hail Mary',
        text: 'Hail, Mary, full of grace, the Lord is with thee; blessed art thou amongst women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen.'
      },
      {
        id: 3,
        title: 'Prayer for Church Unity',
        text: 'Lord Jesus Christ, Thou didst pray that all might be one. Heal our wounds, soften our pride, and make us lovers of truth and charity. Teach us to listen, to repent, and to seek communion without compromise of conscience. Bring us together in Thy love, that the world may believe. Amen.'
      },
      {
        id: 4,
        title: 'Nicene Creed (Common Core)',
        text: 'I believe in one God, the Father almighty, maker of heaven and earth... I believe in the Holy Spirit, the Lord, the giver of life, who proceeds from the Father... I believe in one holy catholic and apostolic Church. I acknowledge one baptism for the forgiveness of sins... Amen.'
      },
      {
        id: 5,
        title: 'Jesus Prayer (Shared in Spirit)',
        text: 'Lord Jesus Christ, Son of God, have mercy on me, a sinner.'
      }
    ];

    const dinnerDeck = [
      // Authority
      { topic:'Authority', vibe:'Gentle', kids:'No', q:'When you hear ‚ÄúChurch authority,‚Äù what do you hope it protects‚Äîand what do you fear it can harm?', ans:'A healthy view of authority protects the Gospel, unity, and pastoral care‚Äîwithout crushing conscience or becoming control. Both traditions agree authority is meant to serve holiness, not ego. Ask what safeguards keep leaders humble and faithful.', bridge:'I‚Äôm not trying to win‚Äî I want to understand what you‚Äôre protecting.', follow:'Where do you see the Holy Spirit guiding the Church most clearly‚Äîcouncils, bishops, pope, saints, the faithful?' },
      { topic:'Authority', vibe:'Lively', kids:'No', q:'What would ‚Äúunity‚Äù look like that doesn‚Äôt erase legitimate diversity‚Äîhow would we know it‚Äôs real?', ans:'Unity isn‚Äôt sameness. In the first centuries, East/West shared core faith (Creed, sacraments, apostolic succession) while keeping different liturgies and customs. Real unity looks like shared Eucharistic communion + shared confession of faith, with room for local expressions.', bridge:'Can we name one thing we both think unity must include?', follow:'If the early Church managed diversity, what practical steps did they use that we could imitate?' },
      { topic:'Authority', vibe:'Spicy', kids:'No', q:'If you had to steelman the other side: what is the strongest reason for a pope / for councils as supreme authority?', ans:'Steelman version: Pro-pope: a visible center can protect worldwide unity and settle disputes. Pro-council: shared discernment prevents unilateral changes and keeps apostolic balance. The point isn‚Äôt ‚Äúgotcha‚Äù‚Äîit‚Äôs naming the best goods each side is trying to protect.', bridge:'Let me repeat your best argument back to you‚Äîtell me if I got it right.', follow:'What would convince you your view needs revision‚Äîhistorically or theologically?' },

      // Mary
      { topic:'Mary', vibe:'Gentle', kids:'Yes', q:'What do you love most about Mary‚Äîand what do you think Mary teaches families today?', ans:'Mary models trust, courage, and steady love. For families: say ‚Äúyes‚Äù to God in small daily ways; keep Christ at the center; stand by others in suffering; pray with hope. Both traditions honor Mary as Theotokos (God-bearer).', bridge:'We both love Mary; let‚Äôs start with what she shows us about Jesus.', follow:'How do you explain ‚ÄúMother of God‚Äù to a child without confusing them?' },
      { topic:'Mary', vibe:'Lively', kids:'No', q:'Do you think Mary‚Äôs greatness is mainly ‚ÄúGod did it for her,‚Äù or ‚Äúshe cooperated perfectly‚Äù? Or both?', ans:'Both. Grace comes first‚ÄîGod initiates. Mary‚Äôs ‚ÄúLet it be to me‚Äù shows real human freedom cooperating with grace. Catholics may emphasize unique prevenient grace; Orthodox emphasize Mary‚Äôs free synergy and holiness within a different sin framework.', bridge:'I‚Äôm curious about emphasis, not trying to judge.', follow:'What Marian feast day feels most meaningful to you, and why?' },
      { topic:'Mary', vibe:'Spicy', kids:'No', q:'Is the disagreement about the Immaculate Conception really about Mary‚Äîor about different understandings of original/ancestral sin?', ans:'Often it‚Äôs the framework. Catholics define original sin in a way that leads to the Immaculate Conception as fitting preparation. Orthodox often speak of ancestral sin (corruption/death) and are cautious about later dogmatic definitions‚Äîwhile still calling Mary all-holy and uniquely graced. Shared core: Mary is Theotokos and supremely holy.', bridge:'Could we separate the ‚ÄúMary question‚Äù from the ‚Äúsin framework‚Äù question for a minute?', follow:'If you re-framed the other side‚Äôs view in the most charitable way, how would you say it?' },

      // Eucharist
      { topic:'Eucharist', vibe:'Gentle', kids:'Yes', q:'When you receive Communion, what do you quietly ask Jesus for in your heart?', ans:'A ‚Äúgood answer‚Äù is personal: forgiveness, strength, peace, healing, love for family, freedom from sin, deeper faith. The point is to connect doctrine to devotion: Communion is encounter, not just a concept.', bridge:'Let‚Äôs speak from experience before definitions.', follow:'What is one thing you wish kids understood about Communion?' },
      { topic:'Eucharist', vibe:'Lively', kids:'No', q:'Do you think explaining the Eucharist helps faith‚Äîor can it make people too confident they ‚Äúget‚Äù it?', ans:'Both risks exist. Clear language can protect truth (Christ is truly present). But over-confidence can flatten mystery. A healthy middle: use definitions to guard the ‚Äúwhat‚Äù while staying humble about the ‚Äúhow.‚Äù', bridge:'We can honor mystery and still seek clarity.', follow:'What role does the Holy Spirit play in the Eucharist in your tradition‚Äôs prayers?' },
      { topic:'Eucharist', vibe:'Spicy', kids:'No', q:'If both of us believe in the Real Presence, why do people still use it as a dividing line‚Äîwhat is beneath that?', ans:'Often it is not the Real Presence itself, but authority/discipline and communion boundaries (who may receive, under what conditions), plus different liturgical language and pastoral practice. The beneath layer is identity and trust: ‚ÄúWho defines doctrine? Who belongs?‚Äù', bridge:'I‚Äôm not asking to argue‚Äî I‚Äôm asking what the symbol is carrying emotionally.', follow:'What would mutual reverence look like in a mixed family situation (weddings, funerals, visits)?' },

      // Lent
      { topic:'Lent', vibe:'Gentle', kids:'Yes', q:'What is one Lenten practice that actually makes you kinder‚Äînot just ‚Äúmore strict‚Äù?', ans:'Best answers focus on fruit: less gossip, more patience, giving money/time to others, sincere apology, prayer for enemies, family service. If fasting makes you harsh, you‚Äôre missing the point‚Äîfasting should make room for love.', bridge:'Let‚Äôs focus on fruit: love, humility, patience.', follow:'If kids are present, how do you teach fasting without shame?' },
      { topic:'Lent', vibe:'Lively', kids:'No', q:'Do you prefer a ‚Äúvisible‚Äù start to Lent (ashes) or a ‚Äúrelational‚Äù start (forgiveness)? Why?', ans:'Ashes emphasize mortality and repentance; Forgiveness Sunday emphasizes reconciliation and humility. Both are biblical: repent and be reconciled. The why reveals a person‚Äôs spiritual doorway‚Äîsome need a wake-up; others need relational healing first.', bridge:'Both are about repentance‚Äîdifferent doorways.', follow:'What is your best story of reconciliation during Lent?' },
      { topic:'Lent', vibe:'Spicy', kids:'No', q:'Is strict fasting spiritually helpful for most people‚Äîor can it become pride? Where is the healthy line?', ans:'Fasting is medicine, not a medal. Helpful when paired with prayer + almsgiving + humility; harmful when it becomes comparison or self-righteousness. The healthy line: your fasting should increase love and repentance; if it increases ego or judgment, simplify and seek counsel.', bridge:'Let‚Äôs be honest without accusing: pride is a human problem, not a tradition problem.', follow:'How do you know your fasting is becoming love, not self-righteousness?' },

      // Prayer
      { topic:'Prayer', vibe:'Gentle', kids:'Yes', q:'If you could teach kids one mini-prayer for the whole day, what would it be?', ans:'Simple and repeatable is best: ‚ÄúJesus, help me love.‚Äù or ‚ÄúLord, have mercy.‚Äù or ‚ÄúThank you, God.‚Äù The goal is a prayer that trains attention and kindness all day‚Äîespecially when emotions spike.', bridge:'No debate‚Äîjust share what works in real life.', follow:'Would you teach a child the Jesus Prayer, the Our Father, or both?' },
      { topic:'Prayer', vibe:'Lively', kids:'No', q:'When you ask saints to pray for you, what do you believe is happening‚Äîhow would you explain it to a Protestant friend?', ans:'Think ‚Äúfamily asking family.‚Äù Christians believe the saints are alive in Christ and part of the communion of saints. Asking their prayers doesn‚Äôt replace Jesus‚Äîit‚Äôs like asking a godly friend to pray, with Jesus as the only Savior and mediator in the ultimate sense.', bridge:'I‚Äôm trying to understand the inner logic.', follow:'What is the best metaphor: ‚Äúfamily asking family,‚Äù ‚Äúcloud of witnesses,‚Äù or something else?' },
      { topic:'Prayer', vibe:'Spicy', kids:'No', q:'Why do some Christians feel saint-intercession threatens Jesus‚Äô role‚Äîwhat misunderstanding is driving that fear?', ans:'Often the fear is confusion between worship and veneration, or thinking prayer-to-saints is bypassing Christ. A calm answer: all grace comes from God; we ask saints to intercede in Christ, not as independent powers.', bridge:'Let‚Äôs identify the fear first, then respond calmly.', follow:'What is the strongest biblical or historical argument you have heard on each side?' },

      // Icons
      { topic:'Icons', vibe:'Gentle', kids:'Yes', q:'Do you have a favorite holy image at home? What makes it comforting?', ans:'Holy images help attention: they remind you who God is and who you‚Äôre becoming. Comfort often comes from a face of Christ, the Theotokos, or a saint who ‚Äúgets your life.‚Äù The key is relationship‚Äîimages point beyond themselves.', bridge:'We‚Äôre talking about love, not magic.', follow:'How do you teach kids the difference between honoring an image and worshiping it?' },
      { topic:'Icons', vibe:'Lively', kids:'No', q:'Do you think beauty can evangelize? How has art or music helped your faith?', ans:'Yes‚Äîbeauty can soften resistance and open the heart to God. In both traditions, sacred art and music are ‚Äútheology in color and sound.‚Äù A good answer includes a concrete example.', bridge:'Beauty is a shared language.', follow:'What is your favorite hymn/chant and why?' },
      { topic:'Icons', vibe:'Spicy', kids:'No', q:'Is the real icon debate about images‚Äîor about the Incarnation and whether matter can carry grace?', ans:'At the core, it is Incarnation theology: if the Word became flesh, matter can be sanctified and depicted without idolatry‚Äîworship goes to God alone, honor can be shown to images as pointers.', bridge:'Can we shift from objects to Incarnation theology?', follow:'If Christ took flesh, what does that imply about the spiritual meaning of the material world?' },

      // History
      { topic:'History', vibe:'Gentle', kids:'No', q:'What is one historical event you wish Christians knew better before arguing online?', ans:'Common answers: the early ecumenical councils, the gradual nature of the East‚ÄìWest split, the icon controversy, political pressures, and the 1965 lifting of excommunications. The point: history is complex‚Äîhumility beats hot takes.', bridge:'Let‚Äôs replace internet heat with historical humility.', follow:'Which do you think mattered more: politics, language, or theology?' },
      { topic:'History', vibe:'Lively', kids:'No', q:'If the first millennium was one Church, what would it take to return to that kind of communion?', ans:'Likely: patient dialogue, mutual repentance, clarity on primacy/conciliarity, agreement on Creed wording and authority processes, and practical steps of shared witness. It is not ‚Äúone side submits‚Äù‚Äîit is healing trust while guarding conscience.', bridge:'We can dream responsibly without pretending it is easy.', follow:'What would need to change on each side‚Äîrealistically?' },
      { topic:'History', vibe:'Spicy', kids:'No', q:'If a tradition admits, ‚ÄúWe handled this badly,‚Äù does that weaken it‚Äîor strengthen its credibility?', ans:'It usually strengthens credibility. Repentance is a Christian superpower: truth-telling builds trust and makes unity possible. The key is distinguishing doctrine from failures of leaders and culture.', bridge:'Repentance is always strength.', follow:'What is one grievance you think the other side should hear without defensiveness?' },

      // Daily life
      { topic:'DailyLife', vibe:'Gentle', kids:'Yes', q:'What is one habit that helps you forgive faster at home?', ans:'Practical habits: pause and breathe before speaking, pray ‚ÄúLord have mercy,‚Äù name your own fault first, apologize quickly, and do one small act of service. Forgiveness is not pretending‚Äî it is choosing love while seeking healing.', bridge:'We‚Äôre building a Christian household more than winning a debate.', follow:'What do you do when you are too tired to pray?' },
      { topic:'DailyLife', vibe:'Lively', kids:'No', q:'How do you talk to family members who are ‚Äúdone with church‚Äù but still believe in God?', ans:'Lead with listening and respect. Share your story without lecturing. Invite gently, serve consistently, and avoid shaming. Many return through beauty, friendship, and authentic repentance more than arguments.', bridge:'Let‚Äôs be compassionate and practical.', follow:'What has worked: invitations, listening, service, silence, sharing your story?' },
      { topic:'DailyLife', vibe:'Spicy', kids:'No', q:'Do you think most Christian conflict is really about theology‚Äîor about pride and identity?', ans:'Often it is both: real theological differences exist, but pride/tribal identity turns differences into contempt. Truth without love becomes weapon; love without truth becomes vague.', bridge:'We can critique ourselves first.', follow:'What would humility look like in the next 10 minutes at this table?' },

      // Deep Theology (Level 2)
      { topic:'Deep Theology', vibe:'Gentle', kids:'No', q:'When people argue about the Filioque, what do you think they‚Äôre trying to protect about God?', ans:'Usually: protecting the Father as the single source (Orthodox emphasis) and/or protecting the Son‚Äôs full divinity and intimacy with the Spirit (Western emphasis). Many fights are as much about authority/process as theology.', bridge:'Let‚Äôs name the good each side is guarding before we critique anything.', follow:'If we say ‚Äúthe Spirit proceeds from the Father, and is manifested/sent through the Son,‚Äù does that lower the temperature?', deep:'<div><strong>Deep dive:</strong> Two layers often get mixed: (1) language (Greek/Latin nuance) and (2) legitimacy of changing Creed wording without a council. A safe table move is to ask: ‚ÄúWhat authority process would make additions legitimate?‚Äù</div>' },
      { topic:'Deep Theology', vibe:'Lively', kids:'No', q:'What kind of primacy could exist that serves unity without becoming domination?', ans:'A primacy that is pastoral, bounded, accountable, and exercised in communion with other bishops. The debate is often scope + safeguards, not whether any primacy exists at all.', bridge:'Can we talk safeguards before power?', follow:'What accountability would you require for a global first among equals?', deep:'<div><strong>Deep dive:</strong> A productive framing is ‚Äúprimacy and synodality together.‚Äù Ask: ‚ÄúWhat would first‚Äëmillennium patterns look like today with modern global realities?‚Äù</div>' },
      { topic:'Deep Theology', vibe:'Spicy', kids:'No', q:'If a council is crucial, how does the Church recognize a council as truly ecumenical‚Äîwho decides?', ans:'Many Christians look for continuity with apostolic faith, broad reception by the Church over time, holiness of witness, and spiritual fruit. The recognition question is about how the Church knows truth, not just what it teaches.', bridge:'Let‚Äôs slow down: this is about discernment, not slogans.', follow:'Do you think truth is recognized instantly, or tested over time by the Church‚Äôs life?', deep:'<div><strong>Deep dive:</strong> This is an epistemology question: authority, reception, and the Holy Spirit‚Äôs guidance. It‚Äôs deeper than any single doctrine‚Äîand it is a great place to practice humility.</div>' }
    ];

    const deescalations = [
      'Let‚Äôs pause. I think we‚Äôre both trying to honor Christ. Can we slow down and restate gently?'
    ];

    // ============================
    // Culture Cues (Family Feud style)
    // ============================

    const cultureCards = [
      {
        title: 'Mass vs Divine Liturgy',
        q: 'Top 7 words you‚Äôll hear (and what they usually mean).',
        top7: [
          '‚ÄúMass‚Äù (Catholic, esp. Latin Rite) ‚Äî the Eucharistic service',
          '‚ÄúDivine Liturgy‚Äù (Orthodox) ‚Äî the Eucharistic service (heaven on earth framing)',
          '‚ÄúLiturgy‚Äù ‚Äî shorthand for Divine Liturgy in Orthodoxy',
          '‚ÄúVespers‚Äù ‚Äî evening prayer service (Orthodox and some Catholics)',
          '‚ÄúMatins/Orthros‚Äù ‚Äî morning prayer service (Orthodox)',
          '‚ÄúConfession‚Äù ‚Äî sacramental repentance; form differs by tradition',
          '‚ÄúHoly Mysteries‚Äù (Orthodox) / ‚ÄúSacraments‚Äù (Catholic) ‚Äî the Church‚Äôs sacred rites'
        ],
        quick: 'If you‚Äôre visiting a Greek parish, say ‚ÄúDivine Liturgy‚Äù and you‚Äôll sound instantly fluent.'
      },
      {
        title: 'Crossing yourself near a church',
        q: 'Top 7 moments Greeks/Orthodox often make the sign of the Cross.',
        top7: [
          'When passing a church (walking or driving)',
          'Entering the church (often at the door)',
          'Venerating an icon',
          'At Trinitarian phrases (Father/Son/Holy Spirit)',
          'During key Liturgy moments (e.g., Gospel, Great Entrance)',
          'When the priest blesses or says ‚ÄúPeace be with all‚Äù',
          'When praying for the departed or at a memorial'
        ],
        quick: 'It‚Äôs usually a reverence reflex, not a rule‚Äîfollow the room; you won‚Äôt be judged.'
      },
      {
        title: 'Standing, kneeling, and ‚Äúwhat do I do?‚Äù',
        q: 'Top 7 visitor cues so you feel comfortable in either church.',
        top7: [
          'Stand when most people stand; sit when most sit (Orthodox stands more; Catholic has more kneeling)',
          'If unsure, stay still and attentive‚Äîreverence beats perfect choreography',
          'Follow the person in front of you for simple gestures (standing/bowing)',
          'Don‚Äôt go up for Communion unless you‚Äôre sure you should (ask privately later)',
          'Dress modestly; quiet shoes help (Orthodox services can be longer)',
          'Phones off; no photos during worship unless invited',
          'After service, ask a friendly person: ‚ÄúWhat should visitors know here?‚Äù'
        ],
        quick: 'Best line: ‚ÄúI‚Äôm visiting‚Äîwhat‚Äôs the respectful thing to do for Communion?‚Äù'
      },
      {
        title: 'Coffee hour and hospitality',
        q: 'Top 7 culture patterns you‚Äôll notice after service.',
        top7: [
          'Orthodox: coffee hour can be a major community anchor (especially ethnic parishes)',
          'Catholic: donuts/coffee varies by parish; hospitality can be quieter',
          'Orthodox: expect introductions; people may ask your ‚Äúbackground‚Äù (often cultural)',
          'Catholic: often more anonymous‚Äîunless it‚Äôs a close parish community',
          'Orthodox: feast days may include big meals; food is part of joy and identity',
          'Catholic: parish events often revolve around ministries (service groups, school)',
          'In both: if you show warmth + curiosity, you‚Äôll be welcomed'
        ],
        quick: 'If you want community fast, stay 15 minutes after service and talk to one person.'
      },
      {
        title: 'Fasting etiquette (don‚Äôt make it weird)',
        q: 'Top 7 ways to be a good guest when someone is fasting.',
        top7: [
          'Don‚Äôt interrogate; ask ‚ÄúHow are you keeping Lent?‚Äù if they invite it',
          'Avoid food-policing (‚ÄúAre you allowed to eat that?‚Äù)',
          'Offer simple options (fish/veg) without drama',
          'In Orthodoxy, fasting can be more structured; in Catholicism, it varies by person/country',
          'Remember: fasting is meant to grow love, not pride',
          'If you host: label dishes; let people choose quietly',
          'If you‚Äôre fasting: be joyful and normal‚Äîno guilt vibes'
        ],
        quick: 'Fasting is medicine, not a medal‚Äîhospitality > perfection.'
      },
      {
        title: 'Holy Week ‚Äúextra services‚Äù',
        q: 'Top 7 Holy Week differences that surprise visitors.',
        top7: [
          'Orthodox Holy Week includes many services (Bridegroom Matins, Holy Unction in many parishes, etc.)',
          'Greek tradition: Holy Unction is often offered on Holy Wednesday',
          'Orthodox: Pascha begins in darkness and erupts into light (‚ÄúChrist is risen!‚Äù)',
          'Catholic: Triduum (Holy Thursday, Good Friday, Easter Vigil) is the central arc',
          'Orthodox: long services are normal; plan time and comfortable shoes',
          'Catholic: the Easter Vigil is also a powerful ‚Äúdark to light‚Äù moment',
          'Both: Holy Week is meant to be lived, not only watched'
        ],
        quick: 'Ask: ‚ÄúWhat Holy Week service is most meaningful to you, and why?‚Äù'
      },
      {
        title: 'Names for priests and respect language',
        q: 'Top 7 address norms you‚Äôll hear.',
        top7: [
          'Orthodox: ‚ÄúFather + first name‚Äù is common (Father Dimitri)',
          'Greek: you may hear ‚ÄúPappas‚Äù informally in Greek contexts',
          'Catholic: ‚ÄúFather + last name‚Äù is common (Father Smith)',
          'Orthodox: ‚ÄúPresvytera‚Äù (priest‚Äôs wife in Greek tradition) may be addressed with honorific',
          'Catholic: ‚ÄúSister‚Äù for religious sisters; Orthodox: ‚ÄúMother‚Äù for nuns/abbesses',
          'Both: a simple ‚ÄúFather‚Äù is always respectful',
          'When unsure: follow what the parish uses'
        ],
        quick: 'Copy the room‚Äîpeople appreciate respectful effort more than perfect accuracy.'
      }
    ];

    // Culture cards as part of the Dinner Tool deck (so "Deal a Card" can use them)
    const cultureDinnerDeck = (() => {
      const vibes = ['Gentle', 'Lively', 'Spicy'];
      const toCard = (c, vibe) => ({
        topic: 'Culture',
        vibe,
        kids: 'No',
        q: `${c.title} ‚Äî ${c.q}`,
        ans: c.quick || 'Quick cue: follow the room; reverence beats perfection.',
        bridge: 'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow: 'What‚Äôs the story behind it in your family?',
        deep: `<div><strong>Top 7:</strong><ol style="padding-left:1.25rem; margin-top:0.5rem; line-height:1.7;">${c.top7.map(x=>`<li>${x}</li>`).join('')}</ol></div>`
      });
      return vibes.flatMap(v => cultureCards.map(c => toCard(c, v)));
    })();

    const unityPrayers = [
      'Lord Jesus Christ, make us one in truth and love. Heal our pride, deepen our repentance, and teach us to listen. Amen.'
    ];

    // ============================
    // Tab switching + rendering
    // ============================

    function switchTab(event, tab) {
      document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));

      const target = document.getElementById(tab);
      if (target) target.classList.add('active');

      if (event && event.target) {
        event.target.classList.add('active');
      } else {
        const btn = Array.from(document.querySelectorAll('.nav-tab')).find(b => {
          const txt = b.textContent.trim().toLowerCase();
          if (tab === 'dinner') return txt.includes('dinner');
          return txt.includes(tab);
        });
        if (btn) btn.classList.add('active');
      }

      if (tab === 'conversations') renderConversations();
      if (tab === 'commandments') renderCommandments();
      if (tab === 'rituals') renderRituals();
      if (tab === 'practices') renderPractices();
      if (tab === 'saints') renderSaints();
      if (tab === 'culture') renderCulture();
      if (tab === 'foundations') renderFoundations();
      if (tab === 'theology') renderTheology();
      if (tab === 'history') renderHistory();
      if (tab === 'prayers') renderPrayers();
      if (tab === 'dinner') updateDinnerStats();
    }

    function emptyState(message) {
      return `<div style="grid-column:1 / -1; color:#cbd5e1; opacity:0.95; background:#0f172a; border:1px solid #334155; padding:1rem; border-radius:0.75rem;">${message}</div>`;
    }

    // -----------------
    // Micro-interactions (C2)
    // -----------------

    function playClick(){
      const t = document.getElementById('soundToggle');
      const on = !!(t && t.checked);
      if (!on) return;
      try {
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if (!Ctx) return;
        const ctx = new Ctx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 520;
        g.gain.value = 0.05;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(()=>{ o.stop(); if (ctx.close) ctx.close(); }, 55);
      } catch(e) {}
    }

    function haptic(){
      try { if (navigator.vibrate) navigator.vibrate(12); } catch(e) {}
    }

    function animateOnce(el, cls){
      if (!el) return;
      el.classList.remove(cls);
      void el.offsetWidth;
      el.classList.add(cls);
    }


    function renderConversations() {
      const grid = document.getElementById('conversationsGrid');
      const convSearchEl = document.getElementById('convSearch');
      const search = ((convSearchEl && convSearchEl.value) ? convSearchEl.value : '').toLowerCase();
      const convTopicEl = document.getElementById('convTopic');
      const topic = (convTopicEl && convTopicEl.value) ? convTopicEl.value : 'All';
      const filtered = conversations.filter(c => {
        const matchTopic = topic === 'All' || c.topic === topic;
        const hay = (c.title + ' ' + c.topic + ' ' + (c.tags||[]).join(' ') + ' ' + c.context).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        return matchTopic && matchSearch;
      });
      const count = document.getElementById('convCount');
      if (count) count.textContent = `${filtered.length} conversation${filtered.length===1?'':'s'}`;
      if (!filtered.length) {
        grid.innerHTML = emptyState('No conversations match your search. Try a different keyword or topic.');
        return;
      }
      grid.innerHTML = filtered.map(c => `
        <div class="card" onclick="openModal(event, 'conv-${c.id}')" role="button" aria-label="Open conversation">
          <h3 class="card-h3">${c.title}</h3>
          <div style="margin-top:0.5rem;">
            <span class="badge badge-topic">${c.topic}</span>
            ${(c.tags||[]).slice(0,3).map(t=>`<span class="badge" style="background:#334155;color:#e2e8f0;">${t}</span>`).join('')}
          </div>
          <p class="card-subtitle">${c.speakers.join(' & ')}</p>
          <p class="card-text">${c.context}</p>
        </div>
      `).join('');
    }

    function renderCommandments() {
      const container = document.getElementById('commandmentsGrid');
      container.innerHTML = commandments.map(cmd => `
        <div class="ritual-card" onclick="openModal(event, 'cmd-${cmd.num}')" role="button" aria-label="Open commandment">
          <div class="ritual-name">${cmd.num} Commandment</div>
          <div class="ritual-desc">${cmd.catholic}</div>
        </div>
      `).join('');
    }

    function renderRituals() {
      const container = document.getElementById('ritualsGrid');
      container.innerHTML = rituals.map(r => `
        <div class="ritual-card" onclick="openModal(event, 'rit-${r.id}')" role="button" aria-label="Open ritual">
          <div class="ritual-name">${r.icon} ${r.name}</div>
          <div class="ritual-desc"><strong>Catholic:</strong> ${escapeHtml(r.catholic).slice(0, 110)}...</div>
        </div>
      `).join('');
    }

    function renderPractices() {
      const grid = document.getElementById('practicesGrid');
      grid.innerHTML = practices.map(p => `
        <div class="card" onclick="openModal(event, 'prac-${p.id}')" role="button" aria-label="Open practice">
          <h3 class="card-h3">${p.title}</h3>
          <p class="card-subtitle">Category: ${p.category}</p>
          <p class="card-text">${p.content.substring(0, 140)}...</p>
        </div>
      `).join('');
    }

    function renderSaints() {
      // Render quick chips once (small UX win)
      const chipWrap = document.getElementById('saintChips');
      if (chipWrap && !chipWrap.__built) {
        const chips = ['Cancer','Breast cancer','Anxiety','Sleep','Grief','Mothers','Students','Work','Protection','Healing'];
        chipWrap.innerHTML = chips.map(t => `<button class="pill" style="cursor:pointer;" onclick="setSaintSearch('${t.replace(/'/g, "\'")}')">${t}</button>`).join('');
        chipWrap.__built = true;
      }

      const grid = document.getElementById('saintsGrid');
      const saintSearchEl = document.getElementById('saintSearch');
      const search = ((saintSearchEl && saintSearchEl.value) ? saintSearchEl.value : '').toLowerCase();
      const tradFilterEl = document.getElementById('tradFilter');
      const tradFilter = (tradFilterEl && tradFilterEl.value) ? tradFilterEl.value : 'All';

      const filtered = saints.filter(s => {
        const hay = (
          (s.name || '') + ' ' +
          (s.role || '') + ' ' +
          (s.patronage || '') + ' ' +
          (s.story || '') + ' ' +
          (s.interestingFact || '')
        ).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        const matchTrad = tradFilter === 'All' || s.tradition === tradFilter;
        return matchSearch && matchTrad;
      });

      const count = document.getElementById('saintsCount');
      if (count) count.textContent = `${filtered.length} saint${filtered.length===1?'':'s'}`;

      if (!filtered.length) {
        grid.innerHTML = emptyState('No saints match that search/filter. Try ‚ÄúJohn‚Äù, ‚Äúmother‚Äù, or ‚Äúmonk‚Äù.');
        return;
      }

      grid.innerHTML = filtered.map(s => {
        const badgeClass = s.tradition === 'Both' ? 'badge-both' : s.tradition === 'Orthodox' ? 'badge-orthodox' : 'badge-catholic';
        return `
          <div class="card" onclick="openModal(event, 'saint-${s.id}')" role="button" aria-label="Open saint">
            <h3 class="card-h3">${s.name}</h3>
            <span class="badge ${badgeClass}">${s.tradition}</span>
            <p class="card-subtitle"><strong>Helps with:</strong> ${(((s.patronage || '').split(',').map(x=>x.trim()).filter(Boolean).slice(0,4).join(', ')) || '‚Äî')}${((s.patronage||'').split(',').map(x=>x.trim()).filter(Boolean).length > 4) ? '‚Ä¶' : ''}</p>
            <p class="card-subtitle">Role: ${s.role || '‚Äî'}</p>
            <p class="card-subtitle">Feast: ${s.feast || '‚Äî'}</p>
            <p class="card-text">${(s.story || '').substring(0, 130)}...</p>
          </div>
        `;
      }).join('');
    }

    function renderCulture() {
      const grid = document.getElementById('cultureGrid');
      if (!grid) return;

      grid.innerHTML = cultureCards.map(c => `
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">${c.title}</h3>
          <p class="card-text" style="margin-top:0.5rem;"><strong>Question:</strong> ${c.q}</p>
          <details class="shared-box" style="margin-top:0.75rem;">
            <summary style="cursor:pointer; color:#e2e8f0; font-weight:800;">Reveal Top 7</summary>
            <ol style="padding-left:1.25rem; margin-top:0.6rem; color:#cbd5e1; line-height:1.7;">
              ${c.top7.map(x => `<li>${x}</li>`).join('')}
            </ol>
            ${c.quick ? `<div class="fun-fact" style="margin-top:0.75rem;"><div class="fun-fact-title">Quick answer</div><p style="color:#bfdbfe; margin-top:0.35rem;">${c.quick}</p></div>` : ''}
          </details>
        </div>
      `).join('');
    }

function renderFoundations() {
      const grid = document.getElementById('foundationsGrid');
      grid.innerHTML = foundations.map(f => `
        <div class="card" onclick="openModal(event, 'found-${f.id}')" role="button" aria-label="Open foundation">
          <h3 class="card-h3">${f.icon} ${f.title}</h3>
          <p class="card-text">${f.description}</p>
        </div>
      `).join('');
    }

    function renderTheology() {
      const grid = document.getElementById('theologyGrid');
      grid.innerHTML = theologyTopics.map(t => `
        <div class="card" onclick="openModal(event, 'theo-${t.id}')" role="button" aria-label="Open theology">
          <h3 class="card-h3">${t.title}</h3>
          <p class="card-text">${t.question.substring(0, 150)}...</p>
        </div>
      `).join('');
    }

    function renderHistory() {
      const grid = document.getElementById('historyGrid');
      grid.innerHTML = historyMoments.map(h => `
        <div class="card" onclick="openModal(event, 'hist-${h.id}')" role="button" aria-label="Open history">
          <h3 class="card-h3">${h.title}</h3>
          <p class="card-subtitle">${h.year}</p>
          <p class="card-text">${h.story.substring(0, 150)}...</p>
        </div>
      `).join('');
    }

    function renderPrayers() {
      const grid = document.getElementById('prayersGrid');
      grid.innerHTML = prayers.map(p => `
        <div class="card" onclick="openModal(event, 'prayer-${p.id}')" role="button" aria-label="Open prayer">
          <h3 class="card-h3">${p.title}</h3>
          <p class="card-text">${p.text.substring(0, 120)}...</p>
        </div>
      `).join('');
    }

    function openModal(event, id) {
      if (event) event.stopPropagation();
      const modal = document.getElementById('modal');
      const content = document.getElementById('modalContent');

      if (id.startsWith('conv-')) {
        const convId = parseInt(id.split('-')[1], 10);
        const conv = conversations.find(c => c.id === convId);
        let html = `<h2>${conv.title}</h2>`;
        html += `<div class="context-box"><div class="context-label">Setting</div><p style="color:#cbd5e1; margin-top:0.5rem;">${conv.context}</p></div>`;
        html += `<div style="margin-bottom:0.75rem;">`;
        html += `<span class="badge badge-topic">${conv.topic}</span>`;
        html += (conv.tags||[]).map(t=>`<span class="badge" style="background:#334155;color:#e2e8f0;">${t}</span>`).join('');
        html += `</div>`;
        html += conv.exchange.map(ex => {
          const iconClass = ex.role === 'Orthodox' ? 'orthodox' : 'catholic';
          return `
            <div style="margin-bottom:1.25rem;">
              <div style="display:flex; align-items:center; margin-bottom:0.5rem;">
                <span class="speaker-icon ${iconClass}">${ex.icon}</span>
                <div>
                  <div style="color:#fcd34d; font-weight:800;">${ex.speaker}</div>
                  <div style="color:#b45309; font-size:0.85rem;">${ex.role}</div>
                </div>
              </div>
              <div class="speech">${ex.speech}</div>
            </div>
          `;
        }).join('');
        html += `<div class="shared-box"><div class="shared-label">Dinner Tip</div><p style="color:#cbd5e1; margin-top:0.25rem;">Try: ‚ÄúWhat do you mean by that word?‚Äù and ‚ÄúWhat are you protecting?‚Äù</p></div>`;
        content.innerHTML = html;
      }

      else if (id.startsWith('cmd-')) {
        const cmdNum = id.split('-')[1];
        const cmd = commandments.find(c => c.num === cmdNum);
        content.innerHTML = `
          <h2>The ${cmd.num} Commandment</h2>
          <p style="color:#cbd5e1; margin-top:0.5rem; font-style:italic;">${cmd.catholic}</p>
          <div class="fun-fact"><div class="fun-fact-title">üìú Origin</div><p style="color:#bfdbfe; margin-top:0.5rem;">${cmd.origin}</p></div>
          <h3>Why God Gave It</h3><p>${cmd.why}</p>
          <h3>Deeper Meaning</h3><p>${cmd.deeper}</p>
          <div class="kid-friendly"><div class="kid-friendly-title">üßí For Kids</div><p style="color:#fef3c7; margin-top:0.5rem;">${cmd.kidExplanation}</p></div>
        `;
      }

      else if (id.startsWith('rit-')) {
        const ritId = parseInt(id.split('-')[1], 10);
        const ritual = rituals.find(r => r.id === ritId);
        content.innerHTML = `
          <h2>${ritual.icon} ${ritual.name}</h2>
          <div class="comparison-container">
            <div class="comparison-box">
              <div class="comparison-title">‚úùÔ∏è Catholic</div>
              <div class="comparison-content">${ritual.catholic}</div>
            </div>
            <div class="comparison-box">
              <div class="comparison-title">‚ò¶Ô∏è Orthodox</div>
              <div class="comparison-content">${ritual.orthodox}</div>
            </div>
          </div>
          <h3>Spiritual Meaning</h3><p>${ritual.meaning}</p>
          <h3>Historical Context</h3><p>${ritual.history}</p>
          <div class="shared-box"><div class="shared-label">Dinner Tip</div><p style="color:#cbd5e1; margin-top:0.25rem;">Ask: ‚ÄúWhat does this practice teach the heart?‚Äù rather than ‚ÄúWhich is correct?‚Äù</p></div>
        `;
      }

      else if (id.startsWith('prac-')) {
        const pracId = parseInt(id.split('-')[1], 10);
        const prac = practices.find(p => p.id === pracId);
        content.innerHTML = `<h2>${prac.title}</h2><p>${prac.content}</p>`;
      }

      else if (id.startsWith('saint-')) {
        const saintId = parseInt(id.split('-')[1], 10);
        const saint = saints.find(s => s.id === saintId);
        const badgeClass = saint.tradition === 'Both' ? 'badge-both' : saint.tradition === 'Orthodox' ? 'badge-orthodox' : 'badge-catholic';
        content.innerHTML = `
          <h2>${saint.name}</h2>
          <span class="badge ${badgeClass}">${saint.tradition}</span>
          <p class="modal-label">Helps with (Patronage)</p><p>${saint.patronage || '‚Äî'}</p>
          <p class="modal-label">Role</p><p>${saint.role || '‚Äî'}</p>
          <p class="modal-label">Feast Day</p><p>${saint.feast || '‚Äî'}</p>
          <details class="shared-box" style="margin-top:0.75rem;">
            <summary style="cursor:pointer; color:#e2e8f0; font-weight:800;">More (extra notes)</summary>
            <div style="color:#cbd5e1; margin-top:0.5rem; line-height:1.75;">
              <div><strong>Search tip:</strong> You can search saints by what they help with (e.g., ‚Äúhealing‚Äù, ‚Äústudents‚Äù, ‚Äúmothers‚Äù, ‚Äúanxiety‚Äù).</div>
            </div>
          </details>
          <div class="story-box"><div class="story-title">üìñ The Story</div><p style="color:#cbd5e1; margin-top:0.5rem;">${saint.story || ''}</p></div>
          <div class="kid-friendly"><div class="kid-friendly-title">üßí For Kids</div><p style="color:#fef3c7; margin-top:0.5rem;">${saint.kidFriendly || '‚Äî'}</p></div>
          <div class="fun-fact"><div class="fun-fact-title">‚ú® Interesting Fact</div><p style="color:#bfdbfe; margin-top:0.5rem;">${saint.interestingFact || '‚Äî'}</p></div>
        `;
      }

      else if (id.startsWith('found-')) {
        const foundId = parseInt(id.split('-')[1], 10);
        const found = foundations.find(f => f.id === foundId);
        content.innerHTML = `
          <h2>${found.icon} ${found.title}</h2>
          <p><strong>${found.description}</strong></p>
          <div style="white-space:pre-wrap; color:#cbd5e1; line-height:1.8; margin-top:1rem;">${found.deepDive}</div>
        `;
      }

      else if (id.startsWith('theo-')) {
        const theoId = parseInt(id.split('-')[1], 10);
        const theo = theologyTopics.find(t => t.id === theoId);
        content.innerHTML = `
          <h2>${theo.title}</h2>
          <p class="modal-label">The Question</p><p>${theo.question}</p>
          <h3>Catholic View</h3><p>${theo.catholicView}</p>
          <h3>Orthodox View</h3><p>${theo.orthodoxView}</p>
          <div class="shared-box"><div class="shared-label">‚úùÔ∏è What We Share</div><p style="color:#cbd5e1; margin-top:0.25rem;">${theo.sharedTruth}</p></div>
        `;
      }

      else if (id.startsWith('hist-')) {
        const histId = parseInt(id.split('-')[1], 10);
        const hist = historyMoments.find(h => h.id === histId);
        content.innerHTML = `
          <h2>${hist.title}</h2>
          <p class="modal-label">${hist.year}</p>
          <div style="background:#0f172a; padding:1rem; border-radius:0.5rem; margin-top:0.75rem; border-left:3px solid #d97706;">
            <p style="color:#cbd5e1; line-height:1.7;">${hist.story}</p>
          </div>
        `;
      }

      else if (id.startsWith('prayer-')) {
        const prayerId = parseInt(id.split('-')[1], 10);
        const prayer = prayers.find(p => p.id === prayerId);
        content.innerHTML = `
          <h2>${prayer.title}</h2>
          <div style="background:#0f172a; padding:1rem; border-radius:0.5rem; margin-top:0.75rem; border-left:3px solid #d97706;">
            <p style="color:#cbd5e1; line-height:1.85; font-style:italic;">${prayer.text}</p>
          </div>
        `;
      }

      else {
        content.innerHTML = `<h2>Details</h2><p>Open a card to see details.</p>`;
      }

      modal.classList.add('active');
    }

    function closeModal(e) {
      if (!e || e.target.id === 'modal') {
        document.getElementById('modal').classList.remove('active');
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    // ============================
    // Dinner tool logic
    // ============================

    function getDeepDive(card) {
      const topic = card.topic || 'Any';
      const common = {
        Authority: {
          why: 'Authority questions usually hide a deeper fear: ‚ÄúWill truth be protected without power becoming abuse?‚Äù',
          mis: 'Common misunderstanding: thinking the other side is either ‚Äúpower-hungry‚Äù or ‚Äúanti-unity.‚Äù Most people are protecting something sacred.',
          hist: 'History anchor: 1st-millennium East/West were in communion with real regional diversity. Modern debates often focus on how primacy + synodality should work.',
          gentle: 'Gentle phrasing: ‚ÄúWhat safeguards do you think best protect humility and truth?‚Äù'
        }
      };
      const d = common[topic] || {
        why: 'The goal is truth with love ‚Äî clarity without contempt.',
        mis: 'Common misunderstanding: assuming disagreement means the other person is not faithful.',
        hist: 'History anchor: Christians have disagreed since the early centuries; the saints model patience and humility.',
        gentle: 'Gentle phrasing: ‚ÄúHelp me understand what you mean by that word.‚Äù'
      };
      return `
        <div><strong>Why this matters:</strong> ${d.why}</div>
        <div style="margin-top:0.4rem;"><strong>Common misunderstanding:</strong> ${d.mis}</div>
        <div style="margin-top:0.4rem;"><strong>History anchor:</strong> ${d.hist}</div>
        <div style="margin-top:0.4rem;"><strong>Try saying it like this:</strong> ${d.gentle}</div>
      `;
    }

    function getDinnerPool() {
      const dTopicEl = document.getElementById('dTopic');
      const topic = (dTopicEl && dTopicEl.value) ? dTopicEl.value : 'Any';
      const dVibeEl = document.getElementById('dVibe');
      const vibe = (dVibeEl && dVibeEl.value) ? dVibeEl.value : 'Gentle';

      // Culture can be dealt via the Dinner Tool by using the culture-specific deck
      const deck = (topic === 'Culture') ? cultureDinnerDeck : dinnerDeck;

      return deck.filter(card => {
        const matchTopic = (topic === 'Any') || (topic === 'Culture') || (card.topic === topic);
        const matchVibe = card.vibe === vibe;
        return matchTopic && matchVibe;
      });
    }

    function updateDinnerStats() {
      const pool = getDinnerPool();
      const el = document.getElementById('dStats');
      if (!el) return;

      const dTopicEl = document.getElementById('dTopic');
      const topic = (dTopicEl && dTopicEl.value) ? dTopicEl.value : 'Any';
      const dVibeEl = document.getElementById('dVibe');
      const vibe = (dVibeEl && dVibeEl.value) ? dVibeEl.value : 'Gentle';
      const dKidsEl = document.getElementById('dKids');
      const kids = (dKidsEl && dKidsEl.value) ? dKidsEl.value : 'No';

      el.textContent = `Deck available: ${pool.length} card${pool.length===1?'':'s'} ‚Ä¢ Topic: ${topic} ‚Ä¢ Vibe: ${vibe} ‚Ä¢ Kids: ${kids==='Yes'?'Yes (mixed deck)':'No'}`;
    }

    function toggleAnswer(show) {
      // Back-compat: map to flip.
      if (show) {
        flipDinnerCard(true);
      } else {
        flipDinnerCard(false);
      }
    }

    // ============================
    // Dinner deck UX state
    // ============================
    const dinnerHistory = [];
    let dinnerIndex = -1;

    function renderDinnerCard(card) {
      const flip = document.getElementById('flipCard');
      const frontKicker = document.getElementById('frontKicker');
      const frontQ = document.getElementById('frontQ');
      const frontMeta = document.getElementById('frontMeta');
      const backBody = document.getElementById('backBody');
      const counter = document.getElementById('cardCounter');

      if (!card || !flip || !frontKicker || !frontQ || !frontMeta || !backBody) return;

      // Tag for theming (e.g., Culture cards)
      try { flip.setAttribute('data-topic', card.topic || ''); } catch(e) {}

      // Update counter (Card X / Y)
      if (counter) {
        const total = dinnerHistory.length;
        const pos = dinnerIndex >= 0 ? (dinnerIndex + 1) : 0;
        counter.textContent = `Card ${pos} / ${total}`;
      }

      // Always start on front
      flip.classList.remove('flipped');

      frontKicker.textContent = `${card.topic} ‚Ä¢ ${card.vibe}`;
      frontQ.innerHTML = `<strong>Question:</strong> ${card.q}`;

      const kidsPill = card.kids === 'Yes'
        ? '<span class="pill">üßí Kids-friendly</span>'
        : '<span class="pill" style="border-color:rgba(248,113,113,0.35);">üîû Adults-only</span>';
      frontMeta.innerHTML = `
        <span class="pill">üè∑Ô∏è ${card.topic}</span>
        <span class="pill">‚ú® ${card.vibe}</span>
        ${kidsPill}
      `;

      const deepToggle = document.getElementById('deepDiveToggle');
      const deepOn = !!(deepToggle && deepToggle.checked);
      const deepHtml = deepOn ? (card.deep || getDeepDive(card)) : '';

      backBody.innerHTML = `
        <div style="margin-top:0.25rem;"><strong>Answer / Why it matters:</strong> ${escapeHtml(card.ans || '')}</div>
        <div class="shared-box" style="margin-top:0.85rem;">
          <div class="shared-label">Bridge Phrase</div>
          <div style="color:#cbd5e1; margin-top:0.25rem;">${escapeHtml(card.bridge || '')}</div>
        </div>
        <div class="fun-fact" style="margin-top:0.85rem;">
          <div class="fun-fact-title">Follow-up</div>
          <div style="color:#bfdbfe; margin-top:0.25rem;">${escapeHtml(card.follow || '')}</div>
        </div>
        ${deepOn ? `<div class="shared-box" style="margin-top:0.85rem;"><div class="shared-label">Deep Dive</div><div style="color:#cbd5e1; margin-top:0.25rem;">${deepHtml}</div></div>` : ''}
        ${(!deepOn) ? `<div class="hintline" style="margin-top:0.75rem;">Tip: turn on <strong>Deep Dive mode</strong> to see the ‚ÄúTop 7‚Äù and deeper notes.</div>` : ''}
      `;
    }

    function drawDinnerCard() {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');
      const pool = getDinnerPool();
      if (!pool.length) {
        const frontQ = document.getElementById('frontQ');
        if (frontQ) frontQ.textContent = 'No cards match your settings. Try switching vibe or topic.';
        const counter = document.getElementById('cardCounter');
        if (counter) counter.textContent = 'Card 0 / 0';
        return;
      }
      const card = pool[Math.floor(Math.random() * pool.length)];
      // If we went back in history, drop forward stack
      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerHistory.splice(dinnerIndex + 1);
      }
      dinnerHistory.push(card);
      dinnerIndex = dinnerHistory.length - 1;
      renderDinnerCard(card);
    }

    function nextDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');
      // If we have forward history, go forward; else draw new.
      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerIndex += 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      } else {
        drawDinnerCard();
      }
    }

    function prevDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');
      if (dinnerIndex > 0) {
        dinnerIndex -= 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      }
    }

    function flipDinnerCard(force) {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');

      const flip = document.getElementById('flipCard');
      if (!flip) return;

      const want = (force === true) ? true : (force === false) ? false : !flip.classList.contains('flipped');
      if (want) flip.classList.add('flipped');
      else flip.classList.remove('flipped');

      // Mobile fail-safe: ensure correct face is shown even if 3D is flaky
      const front = flip.querySelector('.face.front');
      const back = flip.querySelector('.face.back');
      if (front && back && window.matchMedia && window.matchMedia('(max-width: 768px)').matches) {
        front.style.display = want ? 'none' : 'block';
        back.style.display = want ? 'block' : 'none';
      }
    }

    function dealDinnerCard() {
      // Back-compat: existing "Deal a Card" buttons call this.
      drawDinnerCard();
    }

    function deescalate() {
      const cardEl = document.getElementById('dCard');
      const bridgeBox = document.getElementById('dBridge');
      const followBox = document.getElementById('dFollow');
      const ansBox = document.getElementById('dAnswer');
      const bridgeText = document.getElementById('dBridgeText');
      const followText = document.getElementById('dFollowText');
      const ansText = document.getElementById('dAnswerText');
      const showBtn = document.getElementById('showAnswerBtn');
      const hideBtn = document.getElementById('hideAnswerBtn');
      const deepBox = document.getElementById('dDeep');

      const msg = deescalations[Math.floor(Math.random() * deescalations.length)];
      cardEl.innerHTML = `<div style="font-size:1.05rem;"><strong>De-escalation line:</strong> ${msg}</div>`;
      bridgeText.textContent = 'Let‚Äôs slow down and choose charity over speed.';
      bridgeBox.style.display = 'block';
      followText.textContent = 'Ask: ‚ÄúWhat‚Äôs the most important thing you want me to understand about your faith?‚Äù';
      followBox.style.display = 'block';
      ansText.textContent = 'The ‚Äúanswer‚Äù here is tone.';
      ansBox.style.display = 'none';
      if (deepBox) deepBox.style.display = 'none';
      showBtn.style.display = 'inline-flex';
      hideBtn.style.display = 'none';
    }

    function endWithPrayer() {
      const cardEl = document.getElementById('dCard');
      const bridgeBox = document.getElementById('dBridge');
      const followBox = document.getElementById('dFollow');
      const ansBox = document.getElementById('dAnswer');
      const bridgeText = document.getElementById('dBridgeText');
      const followText = document.getElementById('dFollowText');
      const ansText = document.getElementById('dAnswerText');
      const showBtn = document.getElementById('showAnswerBtn');
      const hideBtn = document.getElementById('hideAnswerBtn');
      const deepBox = document.getElementById('dDeep');

      const p = unityPrayers[Math.floor(Math.random() * unityPrayers.length)];
      cardEl.innerHTML = `<div style="font-size:1.05rem;"><strong>Prayer:</strong> <em>${p}</em></div>`;
      bridgeText.textContent = 'Thank you for sharing honestly. Peace be with you.';
      bridgeBox.style.display = 'block';
      followText.textContent = 'Optional: each person names one thing they appreciated about someone else‚Äôs faith.';
      followBox.style.display = 'block';
      ansText.textContent = 'Ending in prayer recenters the table on Christ‚Äîso love stays bigger than disagreement.';
      ansBox.style.display = 'none';
      if (deepBox) deepBox.style.display = 'none';
      showBtn.style.display = 'inline-flex';
      hideBtn.style.display = 'none';
    }

    function rapidFireCulture() {
      playClick(); haptic();
      if (!Array.isArray(cultureCards) || cultureCards.length === 0) {
        alert('No Culture cards loaded yet.');
        return;
      }

      const c = cultureCards[Math.floor(Math.random() * cultureCards.length)];
      const card = {
        topic: 'Culture',
        vibe: 'Top 7',
        kids: 'No',
        q: `${c.title} ‚Äî ${c.q}`,
        ans: c.quick || 'Quick cue: follow the room; reverence beats perfection.',
        bridge: 'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow: 'What‚Äôs the story behind it in your family?',
        deep: `<div><strong>Top 7:</strong><ol style="padding-left:1.25rem; margin-top:0.5rem; line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      };

      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerHistory.splice(dinnerIndex + 1);
      }
      dinnerHistory.push(card);
      dinnerIndex = dinnerHistory.length - 1;

      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');
      renderDinnerCard(card);

      // Auto-flip so Top 7 is instantly visible
      setTimeout(() => flipDinnerCard(true), 80);
    }

      const c = cultureCards[Math.floor(Math.random() * cultureCards.length)];
      const card = {
        topic: 'Culture',
        vibe: 'Top 7',
        kids: 'No',
        q: `${c.title} ‚Äî ${c.q}`,
        ans: c.quick || 'Quick cue: follow the room; reverence beats perfection.',
        bridge: 'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow: 'What‚Äôs the story behind it in your family?',
        deep: `<div><strong>Top 7:</strong><ol style="padding-left:1.25rem; margin-top:0.5rem; line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      };

      // Push into history and render like a dealt card
      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerHistory.splice(dinnerIndex + 1);
      }
      dinnerHistory.push(card);
      dinnerIndex = dinnerHistory.length - 1;

      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');
      renderDinnerCard(card);
    }

    function escapeHtml(str) {
      // Safari iOS 12 and some embedded webviews don't support String.prototype.replaceAll.
      // Use global regex replaces for broad compatibility.
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function runSelfTests() {
      try {
        console.groupCollapsed('Dinner Table Conversations ‚Ä¢ Self-tests');

        console.assert(typeof switchTab === 'function', 'switchTab should be defined');
        console.assert(Array.isArray(saints), 'saints should be an array');
        console.assert(Array.isArray(dinnerDeck), 'dinnerDeck should be an array');
        console.assert(dinnerDeck.length > 0, 'dinnerDeck should not be empty');
        console.assert(saints.length > 0, 'saints should have entries');

        // Ensure key handlers exist on window for inline HTML attributes
        console.assert(typeof window.switchTab === 'function', 'window.switchTab should be callable');
        console.assert(typeof window.dealDinnerCard === 'function', 'window.dealDinnerCard should be callable');
        console.assert(typeof window.renderSaints === 'function', 'window.renderSaints should be callable');

        // Guard against raw newline inside saintsPacked strings (parse breaker)
        const hasRawNewline = saintsPacked.some(row => row.some(v => typeof v === 'string' && (v.includes('\n') || v.includes('\r'))));
        console.assert(!hasRawNewline, 'saintsPacked should not contain raw newline characters inside strings');

        // New: ensure foundations deepDive values are safe strings (no raw newlines)
        const foundationsHaveRawNewline = foundations.some(f => typeof f.deepDive === 'string' && (f.deepDive.includes('\r')));
        console.assert(!foundationsHaveRawNewline, 'foundations.deepDive should not contain raw carriage returns');

        console.groupEnd();
      } catch (e) {
        console.error('Self-tests threw an error (non-fatal):', e);
      }
    }

    // Expose handlers for inline onclick/onkeyup attributes (robust across environments)
    function setSaintSearch(term){
      const input = document.getElementById('saintSearch');
      if (input) input.value = term;
      renderSaints();
    }

    function getFilteredSaints(){
      const input = document.getElementById('saintSearch');
      const search = ((input && input.value) ? input.value : '').toLowerCase();
      const tradEl = document.getElementById('tradFilter');
      const trad = (tradEl && tradEl.value) ? tradEl.value : 'All';
      return saints.filter(s => {
        const hay = ((s.name||'')+' '+(s.role||'')+' '+(s.patronage||'')+' '+(s.story||'')+' '+(s.interestingFact||'')).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        const matchTrad = trad === 'All' || s.tradition === trad;
        return matchSearch && matchTrad;
      });
    }

    function randomSaint(){
      playClick(); haptic();
      const pool = getFilteredSaints();
      if (!pool.length) return;
      const s = pool[Math.floor(Math.random()*pool.length)];
      openModal(null, `saint-${s.id}`);
    }

    function getFilteredConversations(){
      const searchEl = document.getElementById('convSearch');
      const search = ((searchEl && searchEl.value) ? searchEl.value : '').toLowerCase();
      const topicEl = document.getElementById('convTopic');
      const topic = (topicEl && topicEl.value) ? topicEl.value : 'All';
      return conversations.filter(c => {
        const matchTopic = topic === 'All' || c.topic === topic;
        const hay = (c.title + ' ' + c.topic + ' ' + (c.tags||[]).join(' ') + ' ' + c.context).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        return matchTopic && matchSearch;
      });
    }

    function dealRandomConversation(){
      playClick(); haptic();
      const pool = getFilteredConversations();
      if (!pool.length) return;
      const c = pool[Math.floor(Math.random()*pool.length)];
      openModal(null, `conv-${c.id}`);
    }

    function prayNow(){
      playClick(); haptic();
      if (!prayers || !prayers.length) return;
      const p = prayers[Math.floor(Math.random()*prayers.length)];
      openModal(null, `prayer-${p.id}`);
    }

    Object.assign(window, {
      switchTab,
      renderConversations,
      renderCommandments,
      renderRituals,
      renderPractices,
      renderSaints,
      setSaintSearch,
      randomSaint,
      dealRandomConversation,
      prayNow,
      renderCulture,
      renderFoundations,
      renderTheology,
      renderHistory,
      renderPrayers,
      openModal,
      closeModal,
      updateDinnerStats,
      toggleAnswer,
      dealDinnerCard,
      drawDinnerCard,
      flipDinnerCard,
      prevDinnerCard,
      nextDinnerCard,
      deescalate,
      endWithPrayer,
      rapidFireCulture,
    });
    // Extra safety for inline onclick
    window.rapidFireCulture = rapidFireCulture;

    // Swipe support for mobile (left = next, right = back)
    (function bindDinnerSwipe(){
      const el = document.getElementById('gameCard');
      if (!el) return;
      let sx = 0, sy = 0;
      el.addEventListener('touchstart', (e)=>{
        const t = e.touches && e.touches[0];
        if (!t) return;
        sx = t.clientX; sy = t.clientY;
      }, {passive:true});
      el.addEventListener('touchend', (e)=>{
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;
        const dx = t.clientX - sx;
        const dy = t.clientY - sy;
        if (Math.abs(dx) < 45 || Math.abs(dx) < Math.abs(dy)) return;
        if (dx < 0) nextDinnerCard();
        else prevDinnerCard();
      }, {passive:true});
    })();

    // Ensure Rapid Fire is always globally callable (some mobile webviews can be picky)
    window.rapidFireCulture = rapidFireCulture; // alias for inline onclick safety

    // Initial render
    renderConversations();
    renderCommandments();
    renderRituals();
    renderPractices();
    renderSaints();
    renderCulture();
    renderFoundations();
    renderTheology();
    renderHistory();
    renderPrayers();
    updateDinnerStats();
    runSelfTests();
  </script>
</body>
</html>
