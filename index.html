<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dinner Table Conversations ‚Ä¢ Orthodox & Catholic</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css" rel="stylesheet">

  <style>
    :root{
      --gold:#f59e0b;
      --gold-2:#d97706;
      --navy:#0f172a;
      --slate:#1e293b;
      --slate-2:#111827;
      --text:#e2e8f0;
      --muted:#cbd5e1;
      --border:rgba(180,83,9,0.35);
      --shadow:0 18px 45px rgba(0,0,0,0.34);
      --shadow-soft:0 10px 25px rgba(0,0,0,0.22);
      --r:16px;
      --r2:22px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0a0e27 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .page-title{
      color:#fcd34d;font-weight:900;letter-spacing:-0.01em;line-height:1.1;
      font-size:clamp(1.55rem, 2.4vw, 2.05rem); margin:0 0 0.85rem 0;
    }

    .header {
      background: linear-gradient(to right, #0f172a, #1e293b);
      border-bottom: 2px solid #b45309;
      padding: 1.25rem 1.5rem;
      position: static;
      z-index: 40;
    }
    @media (min-width: 769px) {
      .header { position: sticky; top: 0; }
    }
    .header h1 { font-size: 2rem; color: #fcd34d; margin-bottom: 0.25rem; font-weight: bold; }
    .header p { color: #cbd5e1; font-size: 0.9rem; }

    .nav-tabs {
      display: flex; gap: 0.5rem;
      overflow-x: auto; -webkit-overflow-scrolling: touch;
      padding: 0.75rem 0 0.5rem; margin-top: 0.5rem;
      flex-wrap: nowrap;
      position: relative; z-index: 1000;
    }
    .nav-tab {
      padding: 0.5rem 1rem;
      background: #334155; color: #cbd5e1;
      border: none; border-radius: 0.5rem;
      cursor: pointer; white-space: nowrap;
      transition: all 0.2s;
      font-size: 0.9rem; font-weight: 600;
    }
    .nav-tab:hover { background: #475569; }
    .nav-tab.active { background: #b45309; color: #0f172a; }

    .container { max-width: 1200px; margin: 0 auto; padding: 1.25rem; }

    .content-section { display: none; }
    .content-section.active { display: block; animation: fadeIn 0.25s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(3px); } to { opacity: 1; transform: translateY(0); } }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.1rem; margin-bottom: 2rem; }

    .card {
      background: linear-gradient(180deg, rgba(30,41,59,0.92), rgba(17,24,39,0.92));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.05rem 1.1rem;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.16);
      pointer-events:none;
      z-index:0;
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-120px -120px auto auto;
      width:260px;height:260px;
      background: radial-gradient(circle at 30% 30%, rgba(245,158,11,0.16), transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
      z-index:0;
    }
    .card > *{position:relative; z-index:2;}
    .card:hover { border-color: rgba(245,158,11,0.55); transform: translateY(-2px); box-shadow: 0 18px 45px rgba(0,0,0,0.38); }

    .card-h3{color:var(--gold); font-weight:900; letter-spacing:-0.01em; font-size:1.05rem;}
    .card-text { color: #cbd5e1; font-size: 0.96rem; margin-top: 0.65rem; line-height: 1.65; }
    .card-subtitle{color:rgba(245,158,11,0.82); font-size:0.86rem; margin-top:0.45rem;}

    .search-box, .filter-select {
      padding: 0.75rem 1rem;
      background: #0f172a;
      border: 1px solid rgba(180,83,9,0.38);
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
      border-radius: 0.5rem;
      color: #fcd34d;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    .search-box::placeholder { color: #92400e; }
    .search-box:focus, .filter-select:focus { outline: none; border-color: rgba(245,158,11,0.7); background: #111827; }

    .filter-select { display: inline-block; width: auto; margin-right: 0.75rem; }
    .filter-select option { background: #0f172a; color: #fcd34d; }

    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: bold; margin-right: 0.5rem; margin-bottom: 0.5rem; }
    .badge-catholic { background: #92400e; color: #fef3c7; }
    .badge-orthodox { background: #1e40af; color: #bfdbfe; }
    .badge-both { background: #6b21a8; color: #e9d5ff; }
    .badge-topic { background: #0b3b60; color: #bfdbfe; }

    .pill{
      display:inline-flex; align-items:center; gap:0.35rem;
      padding:0.2rem 0.6rem; border-radius:999px;
      background:#111827; border:1px solid rgba(148,163,184,0.22);
      color:#cbd5e1; font-size:0.78rem; font-weight:700;
    }

    .context-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-bottom: 1.25rem; border-radius: 0.25rem; }
    .context-label { color: #86efac; font-weight: bold; font-size: 0.9rem; }
    .shared-box { background: #064e3b; border-left: 4px solid #10b981; padding: 1rem; margin-top: 1rem; border-radius: 0.25rem; }
    .shared-label { color: #86efac; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem; }

    .speech { color: #cbd5e1; line-height: 1.7; font-style: italic; background: #0f172a; padding: 1rem; border-left: 3px solid #d97706; margin: 0.75rem 0; border-radius: 0.25rem; }
    .speaker-icon { display:inline-block; width:30px; height:30px; border-radius:50%; text-align:center; line-height:30px; margin-right:0.5rem; font-size:1.35rem; }
    .catholic { background:#92400e; }
    .orthodox { background:#1e40af; }

    /* Ritual/Commandment list cards */
    .ritual-card{
      background: linear-gradient(180deg, rgba(30,41,59,0.92), rgba(17,24,39,0.92));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1rem;
      margin-bottom: 0.85rem;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .ritual-card:hover{
      border-color: rgba(245,158,11,0.55);
      transform: translateY(-1px);
      box-shadow: 0 18px 45px rgba(0,0,0,0.38);
    }
    .ritual-name { color:#fcd34d; font-weight:900; font-size:1rem; }
    .ritual-desc { color:#cbd5e1; margin-top:0.5rem; font-size:0.95rem; line-height:1.6; }

    /* Buttons */
    .btn {
      background: #b45309;
      color: #0f172a;
      border: none;
      padding: 0.65rem 1rem;
      border-radius: 0.65rem;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .btn:hover { background: #d97706; transform: translateY(-1px); }
    .btn:active { transform: translateY(0px) scale(0.98); }
    .btn.secondary { background: #334155; color: #e2e8f0; font-weight: 700; border:1px solid rgba(148,163,184,0.18);}
    .btn.secondary:hover { background: #475569; }

    /* Dinner Tool ‚Äî Deck */
    .deck-wrap{display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-start;}
    .deck-visual{position:relative;width:170px;height:120px;flex:0 0 auto;}
    .deck-card{position:absolute;inset:0;border-radius:18px;background:#0f172a;border:1px solid rgba(148,163,184,0.25);box-shadow:0 12px 30px rgba(0,0,0,0.35);}
    .deck-card.one{transform:rotate(-8deg) translateX(-6px);opacity:0.9;}
    .deck-card.two{transform:rotate(4deg) translateX(10px) translateY(2px);opacity:0.95;}
    .deck-card.three{transform:rotate(-1deg) translateY(6px);}

    .game-stage{flex:1;min-width:280px;display:grid;grid-template-columns:1fr 260px;gap:0.85rem;align-items:start;}
    .game-actions{display:flex;flex-direction:column;gap:0.5rem;align-items:stretch;}
    .game-actions .btn{width:100%;}
    .hintline{color:#94a3b8;font-size:0.85rem;margin-top:0.35rem;}

    /* Reliable flip (2D swap, not 3D) */
    .flip{position:relative;width:100%;min-height:280px;}
    .face{
      position:absolute; inset:0;
      border-radius:24px;
      padding:1.05rem 1.05rem 1rem;
      background:
        radial-gradient(1200px 420px at 20% 0%, rgba(59,130,246,0.18), transparent 55%),
        radial-gradient(900px 360px at 90% 30%, rgba(245,158,11,0.16), transparent 55%),
        #0f172a;
      border:1px solid rgba(148,163,184,0.25);
      box-shadow:0 22px 55px rgba(0,0,0,0.42);
      overflow:hidden;
    }
    .face::before{content:"";position:absolute;inset:12px;border-radius:18px;border:1px solid rgba(148,163,184,0.16);pointer-events:none;z-index:0;}
    .face::after{content:"";position:absolute;left:-40px;top:-60px;width:220px;height:220px;background:radial-gradient(circle at 30% 30%, rgba(56,189,248,0.14), transparent 60%);pointer-events:none;z-index:0;}
    .face > *{position:relative;z-index:2;}

    .face.front{opacity:1; transform:translateX(0); transition:opacity .22s ease, transform .22s ease;}
    .face.back{opacity:0; transform:translateX(10px); transition:opacity .22s ease, transform .22s ease; pointer-events:none; overflow:auto;}
    .flip.flipped .face.front{opacity:0; transform:translateX(-10px); pointer-events:none;}
    .flip.flipped .face.back{opacity:1; transform:translateX(0); pointer-events:auto;}

    .face .kicker{color:#f59e0b;font-weight:800;font-size:0.9rem;letter-spacing:0.02em;}
    .face .q{margin-top:0.5rem;font-size:1.12rem;line-height:1.45;color:#e2e8f0;}
    .face .meta{margin-top:0.75rem;display:flex;gap:0.5rem;flex-wrap:wrap;}

    /* Culture card skin (deck only) */
    #flipCard[data-topic="Culture"] .face{
      background:
        radial-gradient(1100px 420px at 15% 0%, rgba(168,85,247,0.18), transparent 55%),
        radial-gradient(900px 360px at 90% 35%, rgba(34,211,238,0.14), transparent 60%),
        #0b1020;
      border-color: rgba(168,85,247,0.45);
    }
    #flipCard[data-topic="Culture"] .kicker{color:#c4b5fd;}
    #flipCard[data-topic="Culture"] .pill{border-color:rgba(196,181,253,0.25);}

    /* Micro-animations */
    @keyframes dealPop { 0%{transform:translateY(10px) scale(0.98); opacity:0.6;} 60%{transform:translateY(-2px) scale(1.01); opacity:1;} 100%{transform:translateY(0) scale(1);} }
    .deal-animate { animation: dealPop 260ms ease-out; }
    @keyframes softPulse { 0%{transform:scale(1);} 40%{transform:scale(1.01);} 100%{transform:scale(1);} }
    .pulse-animate { animation: softPulse 320ms ease-out; }

    /* Modal */
    .modal-overlay {
      display: none;
      pointer-events: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 50;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: 1.25rem;
    }
    .modal-overlay.active { display: flex; pointer-events: auto; }
    .modal {
      background: #0f172a;
      border: 1px solid rgba(245,158,11,0.5);
      border-radius: var(--r2);
      padding: 1.75rem;
      max-width: 960px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      margin: auto;
      box-shadow: var(--shadow);
    }
    .modal-close { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; color: #b45309; font-size: 1.6rem; cursor: pointer; }
    .modal-close:hover { color: #d97706; }
    .modal h2 { color: #fcd34d; margin-bottom: 0.75rem; font-size: 1.55rem; font-weight: 900; }
    .modal h3 { color: #f59e0b; margin-top: 1.1rem; margin-bottom: 0.6rem; font-size: 1.12rem; font-weight: 800; }
    .modal p { color: #cbd5e1; margin-bottom: 0.75rem; line-height: 1.7; }
    .modal-label { color: #f59e0b; font-weight: 700; margin-top: 0.75rem; margin-bottom: 0.25rem; }

    .footer { border-top: 2px solid #b45309; padding: 1.5rem; text-align: center; color: #b45309; font-size: 0.9rem; margin-top: 2rem; }

    @media (max-width: 768px) {
      .header { padding: 0.9rem 1rem; }
      .header h1 { font-size: 1.35rem; }
      .header p { display:none; }
      .container { padding: 1rem; }
      .grid { grid-template-columns: 1fr; }
      .game-stage{grid-template-columns:1fr;}
      .game-actions{flex-direction:row;flex-wrap:wrap;}
      .game-actions .btn{width:auto;}
      .deck-visual{width:140px;height:104px;}
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>üçΩÔ∏è Dinner Table Conversations</h1>
    <p>Orthodox & Catholic Christians in deep dialogue over shared meals ‚Äî respectful, lively, and real.</p>

    <div class="nav-tabs" role="tablist" aria-label="Navigation">
      <button class="nav-tab active" onclick="switchTab(event, 'home')">Home</button>
      <button class="nav-tab" onclick="switchTab(event, 'dinner')">Dinner Tool</button>
      <button class="nav-tab" onclick="switchTab(event, 'conversations')">Conversations</button>
      <button class="nav-tab" onclick="switchTab(event, 'commandments')">10 Commandments</button>
      <button class="nav-tab" onclick="switchTab(event, 'rituals')">Rituals & Signs</button>
      <button class="nav-tab" onclick="switchTab(event, 'practices')">Church Practices</button>
      <button class="nav-tab" onclick="switchTab(event, 'saints')">Saints</button>
      <button class="nav-tab" onclick="switchTab(event, 'culture')">Culture Cues</button>
      <button class="nav-tab" onclick="switchTab(event, 'foundations')">Core Differences</button>
      <button class="nav-tab" onclick="switchTab(event, 'theology')">Theology Deep Dives</button>
      <button class="nav-tab" onclick="switchTab(event, 'history')">History</button>
      <button class="nav-tab" onclick="switchTab(event, 'prayers')">Prayers</button>
    </div>
  </div>

  <div class="container">

    <!-- HOME -->
    <section id="home" class="content-section active" role="tabpanel">
      <h2 class="page-title">Welcome to the Table</h2>
      <div class="context-box">
        <div class="context-label">üìñ About This App</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">
          This app helps Christians have better dinner conversations‚Äîcurious, warm, and truthful. Explore what divides Orthodox and Catholic traditions, what unites them, and why practices matter.
        </p>
      </div>

      <div class="grid">
        <div class="card" onclick="switchTab(null,'dinner');">
          <h3 class="card-h3">üé≤ Dinner Tool</h3>
          <p class="card-text">Draw a card, flip for the answer, and keep it kind with bridge phrases.</p>
          <p class="card-subtitle">Deck + flip ‚Ä¢ Rapid Fire Culture ‚Ä¢ Reset/Shuffle</p>
        </div>
        <div class="card" onclick="switchTab(null,'conversations');">
          <h3 class="card-h3">üó£Ô∏è Real Conversations</h3>
          <p class="card-text">Dialogue scenes you can borrow at the table.</p>
        </div>
        <div class="card" onclick="switchTab(null,'rituals');">
          <h3 class="card-h3">‚úùÔ∏è Rituals & Signs</h3>
          <p class="card-text">Holy water, incense, icons‚Äîwhat each means and why it differs.</p>
        </div>
        <div class="card" onclick="switchTab(null,'saints');">
          <h3 class="card-h3">‚ú® Saints ‚Äî Helps With‚Ä¶</h3>
          <p class="card-text">Search saints by what they help with (patronage), plus story + notes.</p>
        </div>
      </div>

      <div class="shared-box">
        <div class="shared-label">Table rule</div>
        <p style="color:#cbd5e1; margin-top:0.25rem;">We don‚Äôt reenact old wounds. We practice charity now.</p>
      </div>
    </section>

    <!-- DINNER -->
    <section id="dinner" class="content-section" role="tabpanel">
      <h2 class="page-title">üé≤ Dinner Conversation Tool</h2>

      <div class="context-box">
        <div class="context-label">üç∑ How to Use This</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">
          Choose a <strong>topic</strong> + <strong>vibe</strong>. Tap <strong>Draw</strong> to deal a card.
          Tap <strong>Flip</strong> for answer/bridge/follow-up. Turn on <strong>Deep Dive</strong> for extra notes.
        </p>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="dTopic" class="filter-select" onchange="updateDinnerStats()">
          <option value="Any">Any Topic</option>
          <option value="Authority">Authority</option>
          <option value="Mary">Mary</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Lent">Lent</option>
          <option value="Prayer">Prayer</option>
          <option value="Icons">Icons</option>
          <option value="History">History</option>
          <option value="DailyLife">Daily Life</option>
          <option value="Culture">Culture (quick cues)</option>
          <option value="Deep Theology">Deep Theology (Level 2)</option>
        </select>

        <select id="dVibe" class="filter-select" onchange="updateDinnerStats()">
          <option value="Gentle">Gentle (curious)</option>
          <option value="Lively">Lively (honest)</option>
          <option value="Spicy">Spicy (respectful debate)</option>
        </select>

        <select id="dKids" class="filter-select" onchange="updateDinnerStats()">
          <option value="No">Adults only</option>
          <option value="Yes">Kids present</option>
        </select>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="deepDiveToggle" type="checkbox" style="width:16px; height:16px; accent-color:#38bdf8;" />
          Deep Dive mode
        </label>

        <label class="badge" style="display:inline-flex; gap:0.5rem; align-items:center; background:#0b1220; border:1px solid rgba(148,163,184,0.25);">
          <input id="soundToggle" type="checkbox" style="width:16px; height:16px; accent-color:#f59e0b;" />
          Sound
        </label>
      </div>

      <div class="tiny" id="dStats"></div>

      <div class="card" style="cursor:default;" aria-live="polite">
        <h3 class="card-h3">üé¥ Dinner Card Deck</h3>

        <div class="deck-wrap" style="margin-top:0.85rem;">
          <div class="deck-visual" aria-hidden="true">
            <div class="deck-card one"></div>
            <div class="deck-card two"></div>
            <div class="deck-card three"></div>
          </div>

          <div class="game-stage">
            <div class="game-card" id="gameCard">
              <div class="flip" id="flipCard" data-topic="">
                <div class="face front">
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:0.75rem;">
                    <div class="kicker" id="frontKicker">Ready</div>
                    <div class="pill" id="cardCounter" style="opacity:0.95;">Card 0 / 0</div>
                  </div>
                  <div class="q" id="frontQ">Tap <strong>Draw</strong> to deal a card.</div>
                  <div class="meta" id="frontMeta"></div>
                  <div class="hintline">Swipe left for next ‚Ä¢ Swipe right for previous ‚Ä¢ Tap Flip for answer</div>
                </div>

                <div class="face back">
                  <div class="kicker" id="backKicker">Answer</div>
                  <div id="backBody" style="color:#cbd5e1; line-height:1.7;"></div>
                </div>
              </div>
            </div>

            <div class="game-actions">
              <button class="btn" onclick="drawDinnerCard()">üÉè Draw</button>
              <button class="btn secondary" onclick="flipDinnerCard()">üîÑ Flip</button>
              <button class="btn secondary" onclick="prevDinnerCard()">‚¨ÖÔ∏è Back</button>
              <button class="btn secondary" onclick="nextDinnerCard()">‚û°Ô∏è Next</button>
              <button class="btn secondary" onclick="rapidFireCulture()">‚ö° Rapid Fire (Top 7)</button>
              <button class="btn secondary" onclick="shuffleDinnerDeck()">üîÄ Shuffle</button>
              <button class="btn secondary" onclick="resetDinnerDeck()">üîÅ Reset</button>
              <button class="btn secondary" onclick="deescalate()">üßä De-escalate</button>
              <button class="btn secondary" onclick="endWithPrayer()">üôè End with Prayer</button>
            </div>
          </div>
        </div>
      </div>

      <div class="grid" style="margin-top:1.25rem;">
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">House Rules</h3>
          <ul class="card-text" style="margin-top:0.75rem; list-style:disc; padding-left:1.25rem;">
            <li>Assume goodwill. Ask before you argue.</li>
            <li>Speak in ‚ÄúI‚Äù statements. No labels.</li>
            <li>Steelman the other side: repeat it fairly first.</li>
            <li>One claim at a time. Don‚Äôt stack 12 issues.</li>
            <li>End with what you share: Jesus is Lord.</li>
          </ul>
        </div>
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">Quick Rescues</h3>
          <div class="card-text" style="margin-top:0.75rem;">
            <p><strong>When it gets hot:</strong> ‚ÄúI think we‚Äôre both protecting something sacred. Can we slow down?‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When someone feels attacked:</strong> ‚ÄúThat came out sharper than I meant. Let me restate it.‚Äù</p>
            <p style="margin-top:0.5rem;"><strong>When stuck:</strong> ‚ÄúWhat do we both agree is true about Christ here?‚Äù</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CONVERSATIONS -->
    <section id="conversations" class="content-section" role="tabpanel">
      <h2 class="page-title">Dinner Table Conversations</h2>
      <input type="text" id="convSearch" class="search-box" placeholder="Search conversations..." onkeyup="renderConversations()">
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <select id="convTopic" class="filter-select" onchange="renderConversations()">
          <option value="All">All Topics</option>
          <option value="Sign of the Cross">Sign of the Cross</option>
          <option value="Holy Water Blessing">Holy Water</option>
          <option value="Religious Art">Icons/Statues</option>
          <option value="Mass Obligation">Attendance</option>
          <option value="Saints and Nature">Saints & Nature</option>
          <option value="Filioque">Filioque</option>
          <option value="Purgatory">Purgatory</option>
          <option value="Eucharist">Eucharist</option>
          <option value="Divorce">Marriage/Divorce</option>
        </select>
        <span class="tiny" id="convCount"></span>
        <button class="btn secondary" style="margin-left:auto;" onclick="dealRandomConversation()">üé≤ Deal a Conversation</button>
      </div>
      <div id="conversationsGrid" class="grid"></div>
    </section>

    <!-- COMMANDMENTS -->
    <section id="commandments" class="content-section" role="tabpanel">
      <h2 class="page-title">The Ten Commandments</h2>
      <div class="context-box">
        <div class="context-label">üìú Mount Sinai & Freedom</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">
          These commandments weren‚Äôt random rules. They were a covenant‚Äîhow to live free after slavery.
        </p>
      </div>
      <div id="commandmentsGrid"></div>
    </section>

    <!-- RITUALS -->
    <section id="rituals" class="content-section" role="tabpanel">
      <h2 class="page-title">Rituals & Signs</h2>
      <div class="context-box">
        <div class="context-label">üîé Why rituals matter</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">Visible gestures reveal deep theology. Tap a card to compare Catholic vs Orthodox.</p>
      </div>
      <div id="ritualsGrid"></div>
    </section>

    <!-- PRACTICES -->
    <section id="practices" class="content-section" role="tabpanel">
      <h2 class="page-title">Church Practices</h2>
      <p style="color:#cbd5e1; margin-bottom:1rem;">Practices aren‚Äôt arbitrary. They express what each church believes worship does to the human person.</p>
      <div id="practicesGrid" class="grid"></div>
    </section>

    <!-- SAINTS -->
    <section id="saints" class="content-section" role="tabpanel">
      <h2 class="page-title">Saints</h2>
      <div class="context-box">
        <div class="context-label">‚ú® Search by ‚Äúhelps with‚Ä¶‚Äù</div>
        <p style="color:#cbd5e1; margin-top:0.5rem;">Use keywords like ‚Äúcancer‚Äù, ‚Äúsleep‚Äù, ‚Äúmothers‚Äù, ‚Äústudents‚Äù, ‚Äúgrief‚Äù.</p>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center;">
        <label style="color:#fcd34d; font-weight:700;">Filter:</label>
        <select id="tradFilter" class="filter-select" onchange="renderSaints()">
          <option value="All">All Traditions</option>
          <option value="Both">Both Orthodox & Catholic</option>
          <option value="Catholic">Catholic Saints</option>
          <option value="Orthodox">Orthodox Saints</option>
        </select>
        <input type="text" id="saintSearch" class="search-box" style="margin-bottom:0; flex:1; min-width:260px;"
               placeholder="Search saints by name, patronage, story‚Ä¶" onkeyup="renderSaints()">
      </div>

      <div class="tiny" id="saintsCount" style="margin-top:0.75rem;"></div>
      <div style="margin-top:0.6rem; display:flex; flex-wrap:wrap; gap:0.5rem; align-items:center;">
        <div id="saintChips" style="display:flex; flex-wrap:wrap; gap:0.5rem;"></div>
        <button class="btn secondary" style="margin-left:auto;" onclick="randomSaint()">üé≤ Random Saint</button>
      </div>

      <div id="saintsGrid" class="grid" style="margin-top:0.75rem;"></div>
    </section>

    <!-- CULTURE -->
    <section id="culture" class="content-section" role="tabpanel">
      <h2 class="page-title">Culture Cues</h2>
      <div id="cultureGrid" class="grid"></div>
    </section>

    <!-- FOUNDATIONS -->
    <section id="foundations" class="content-section" role="tabpanel">
      <h2 class="page-title">Core Differences</h2>
      <div id="foundationsGrid" class="grid"></div>
    </section>

    <!-- THEOLOGY -->
    <section id="theology" class="content-section" role="tabpanel">
      <h2 class="page-title">Theology Deep Dives</h2>
      <div id="theologyGrid" class="grid"></div>
    </section>

    <!-- HISTORY -->
    <section id="history" class="content-section" role="tabpanel">
      <h2 class="page-title">History Moments</h2>
      <div id="historyGrid" class="grid"></div>
    </section>

    <!-- PRAYERS -->
    <section id="prayers" class="content-section" role="tabpanel">
      <h2 class="page-title">Prayers We Share</h2>
      <div style="display:flex; flex-wrap:wrap; gap:0.75rem; align-items:center; margin-bottom:0.75rem;">
        <button class="btn" onclick="prayNow()">üôè Pray Now</button>
        <span class="tiny">(opens a prayer card)</span>
      </div>
      <div id="prayersGrid" class="grid"></div>
    </section>

  </div>

  <div class="footer">Dinner Table Conversations ‚Ä¢ Ecumenical Learning Through Honest Dialogue ‚Ä¢ 2026</div>

  <!-- MODAL -->
  <div id="modal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    "use strict";

    // ===== Helpers =====
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
    function playClick(){
      const t = document.getElementById('soundToggle');
      const on = !!(t && t.checked);
      if (!on) return;
      try {
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if (!Ctx) return;
        const ctx = new Ctx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine'; o.frequency.value = 520; g.gain.value = 0.05;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(()=>{ o.stop(); if (ctx.close) ctx.close(); }, 55);
      } catch(e) {}
    }
    function haptic(){ try { if (navigator.vibrate) navigator.vibrate(12); } catch(e) {} }
    function animateOnce(el, cls){ if(!el) return; el.classList.remove(cls); void el.offsetWidth; el.classList.add(cls); }
    function emptyState(message) {
      return `<div style="grid-column:1 / -1; color:#cbd5e1; opacity:0.95; background:#0f172a; border:1px solid #334155; padding:1rem; border-radius:0.75rem;">${message}</div>`;
    }

    // ===== Navigation =====
    function switchTab(event, tab) {
      document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
      const target = document.getElementById(tab);
      if (target) target.classList.add('active');
      if (event && event.target) event.target.classList.add('active');

      if (tab === 'conversations') renderConversations();
      if (tab === 'commandments') renderCommandments();
      if (tab === 'rituals') renderRituals();
      if (tab === 'practices') renderPractices();
      if (tab === 'saints') renderSaints();
      if (tab === 'culture') renderCulture();
      if (tab === 'foundations') renderFoundations();
      if (tab === 'theology') renderTheology();
      if (tab === 'history') renderHistory();
      if (tab === 'prayers') renderPrayers();
      if (tab === 'dinner') updateDinnerStats();
    }

    // ===== Data (as in your current state; you can paste larger saintsPacked later) =====
    const saintsPacked = [[1,"Saint Aelred of Rievaulx","Both","Mystic ‚Ä¢ Medieval","January 12","Friendship, Spiritual companionship, Loneliness, Community, Monks, Those seeking deep relationships","Aelred was a Cistercian monk known for his writings on friendship. In 'On Spiritual Friendship,' he wrote that friendship is one of the greatest goods‚Äîa path to encountering Christ.","Aelred followed Jesus as a mystic. Aelred was a Cistercian monk known for his writings on friendship.","Integrated spiritual theology with relational depth."],[2,"Saint Alphonsa of the Immaculate Conception","Catholic","Healer ‚Ä¢ Modern","July 28","Pneumonia, Chest infections, Respiratory illness, Indian Catholics","Alphonsa was an Indian nun of the Syro-Malabar Church. She suffered from respiratory illnesses. Despite chronic pneumonia, she dedicated herself to religious life.","Alphonsa followed Jesus as a healer. Alphonsa was an Indian nun of the Syro-Malabar Church.","First female saint of Indian origin canonized by the Church."],[3,"Saint Alponsus Liguori","Catholic","Teacher ‚Ä¢ Medieval","August 1","Moral theology, Bishops, Confessors, Scrupulous people, Moral decision-making, Teachers, Compassion in confession","Alponsus was a bishop and theologian who developed compassionate approaches to moral theology and confession. He rejected harsh scrupulosity. He founded the Redemptorists. He became a Doctor of the Church.","Alponsus followed Jesus as a teacher. Alponsus was a bishop and theologian who developed compassionate approaches to moral theology and confession.","Revolutionized moral theology through emphasis on pastoral compassion."],[4,"Saint Ambrose of Milan","Catholic","Teacher ‚Ä¢ Early","December 7","Bishops, Learning, Bees, Beekeepers, Against poisoning","Ambrose was elected Bishop of Milan while still unbaptized. He became one of the greatest theologians of the early Church. He defended orthodoxy, challenged emperors, and converted Saint Augustine. He is one of the four Latin Doctors of the Church.","Ambrose followed Jesus as a teacher. Ambrose was elected Bishop of Milan while still unbaptized.","One of the four Latin Doctors of the Church. Defended orthodoxy and challenged secular authority."],[5,"Saint Andrew the Apostle","Both","Apostle ‚Ä¢ Early","November 30","Single women, Fishermen, Scotland, Against persecution, Missionaries, Women seeking husbands","Andrew was one of Jesus' first apostles. His most famous act was bringing his brother Peter to Jesus. In Catholic tradition, he became the patron saint of single women seeking marriage.","Andrew followed Jesus as a apostle. Andrew was one of Jesus' first apostles.","Shows the power of bringing others into relationship with Christ."],[6,"Saint Angela Merici","Catholic","Teacher ‚Ä¢ Medieval","January 27","Teachers, Educators, Parents, Girls, Youth, Women religious","Angela founded the Ursulines to educate young girls. She emphasized spiritual formation. Her teaching transformed education for women.","Angela followed Jesus as a teacher. Angela founded the Ursulines to educate young girls.","Pioneered formal education for girls within Christian communities."],[7,"Saint Anthony the Great","Both","Monk ‚Ä¢ Early","January 17","Monks, Hermits, Skin diseases, Butchers, Gravediggers","Anthony was an Egyptian hermit called the father of monasticism. He sold everything and went into the desert. His spiritual struggles became legendary. His life inspired countless monastics.","Anthony followed Jesus as a monk. Anthony was an Egyptian hermit called the father of monasticism.","Father of monasticism; his life shaped Christian ascetic tradition."],[8,"Saint Athanasius","Both","Teacher ‚Ä¢ Early","May 2","Theologians, Defenders of the Trinity","Athanasius defended the divinity of Christ against Arianism. He was exiled multiple times but stayed faithful. He wrote 'On the Incarnation' and helped secure the Nicene faith.","Athanasius followed Jesus as a teacher. Athanasius defended the divinity of Christ against Arianism.","Key defender of Nicene orthodoxy; major influence on Trinitarian doctrine."],[9,"Saint Augustine of Hippo","Catholic","Teacher ‚Ä¢ Early","August 28","Theologians, Philosophers, Augustine orders","Augustine lived a restless life until converting through the prayers of his mother Monica and the witness of Ambrose. His writings shaped Western Christianity. His 'Confessions' remain a classic.","Augustine followed Jesus as a teacher. Augustine lived a restless life until converting through the prayers of his mother Monica and the witness of Ambrose.","One of the most influential theologians in Western Christian history."],[10,"Saint Basil the Great","Both","Teacher ‚Ä¢ Early","January 2","Hospitals, Social justice, Monasticism","Basil was a Cappadocian Father who defended the Trinity and reformed monastic life. He founded hospitals and cared for the poor. His liturgy is used in Orthodoxy.","Basil followed Jesus as a teacher. Basil was a Cappadocian Father who defended the Trinity and reformed monastic life.","Helped define Trinitarian theology and pioneered Christian social care."],[11,"Saint Benedict of Nursia","Both","Monk ‚Ä¢ Early","July 11","Europe, Students, Monks","Benedict founded Western monasticism through his Rule. He emphasized stability, prayer, and work. His communities preserved learning through the Middle Ages.","Benedict followed Jesus as a monk. Benedict founded Western monasticism through his Rule.","His Rule became the backbone of Western monastic life and culture."],[12,"Saint Bonaventure","Catholic","Mystic ‚Ä¢ Medieval","July 15","Theologians, Scholars","Bonaventure was a Franciscan theologian and Doctor of the Church. He united intellectual rigor and mysticism. His writings shaped medieval spirituality.","Bonaventure followed Jesus as a mystic. Bonaventure was a Franciscan theologian and Doctor of the Church.","Known as the 'Seraphic Doctor' for his mystical theology."],[13,"Saint Cecilia","Both","Martyr ‚Ä¢ Early","November 22","Musicians, Singers, Poets, Composers, Instrument makers, Orchestras, Choirs","Cecilia was a noble Christian woman who took a vow of virginity. Her pagan husband Valerian was converted by her faith. She was arrested and executed. Legend says she heard heavenly music on her wedding night.","Cecilia followed Jesus as a martyr. Cecilia was a noble Christian woman who took a vow of virginity.","Represents virgin martyrs and the sanctity of the body in Christian faith."],[14,"Saint Catherine of Siena","Catholic","Mystic ‚Ä¢ Medieval","April 29","Italy, Nurses, Fire prevention","Catherine was a Dominican tertiary who had visions and deep mystical experiences. She advised popes and helped bring the papacy back from Avignon to Rome. She is a Doctor of the Church.","Catherine followed Jesus as a mystic. Catherine was a Dominican tertiary who had visions and deep mystical experiences.","Influenced papal history; one of the great female Doctors of the Church."],[15,"Saint Cyril of Alexandria","Both","Teacher ‚Ä¢ Early","June 27","Theologians, Defenders of Mary as Theotokos","Cyril defended the title Theotokos at the Council of Ephesus and protected Christological orthodoxy. His theology shaped how Christians confess Christ as fully God and fully man.","Cyril followed Jesus as a teacher. Cyril defended the title Theotokos at the Council of Ephesus and protected Christological orthodoxy.","Key figure in the Council of Ephesus and Christological doctrine."],[16,"Saint Dominic","Catholic","Missionary ‚Ä¢ Medieval","August 8","Preachers, Astronomers, Against false witness","Dominic founded the Dominican Order dedicated to preaching and teaching. He emphasized truth, prayer, and compassionate evangelization.","Dominic followed Jesus as a missionary. Dominic founded the Dominican Order dedicated to preaching and teaching.","Founder of one of the Church‚Äôs major teaching orders."],[17,"Saint Ephrem the Syrian","Both","Teacher ‚Ä¢ Early","June 9","Poets, Theologians, Spiritual songwriters","Ephrem wrote hymns and poems defending orthodox faith. His poetic theology shaped Eastern Christianity. He is a Doctor of the Church.","Ephrem followed Jesus as a teacher. Ephrem wrote hymns and poems defending orthodox faith.","A major theological poet; called the 'Harp of the Spirit.'"],[18,"Saint Francis of Assisi","Catholic","Missionary ‚Ä¢ Medieval","October 4","Animals, Peace, Environment","Francis renounced wealth, embraced poverty, and preached Christ‚Äôs love to all creation. He is known for joy, simplicity, and radical imitation of Christ.","Francis followed Jesus as a missionary. Francis renounced wealth, embraces poverty, and preached Christ‚Äôs love to all creation.","Founder of the Franciscans; iconic witness to poverty and peace."],[19,"Saint Gregory the Great","Catholic","Teacher ‚Ä¢ Early","September 3","Popes, Musicians, Scholars","Gregory was a pope who reformed liturgy, cared for the poor, and strengthened missionary work. Gregorian chant bears his name.","Gregory followed Jesus as a teacher. Gregory was a pope who reformed liturgy, cared for the poor, and strengthened missionary work.","His leadership shaped Western worship and pastoral practice."],[20,"Saint Gregory of Nyssa","Both","Teacher ‚Ä¢ Early","March 9","Mystics, Theologians","Gregory of Nyssa was a Cappadocian Father known for mystical theology and deep reflections on the Trinity and spiritual growth.","Gregory followed Jesus as a teacher. Gregory of Nyssa was a Cappadocian Father known for mystical theology and deep reflections on the Trinity and spiritual growth.","Major contributor to Trinitarian theology and mystical tradition."],[21,"Saint Ignatius of Antioch","Both","Martyr ‚Ä¢ Early","October 17","Bishops, Theologians","Ignatius was bishop of Antioch and wrote letters on the way to martyrdom in Rome. He emphasized unity with the bishop and the Eucharist as central to the Church.","Ignatius followed Jesus as a martyr. Ignatius was bishop of Antioch and wrote letters on the way to martyrdom in Rome.","Early witness to Eucharistic realism and church order."],[22,"Saint Irenaeus","Both","Teacher ‚Ä¢ Early","June 28","Theologians, Against heresy","Irenaeus fought Gnosticism and emphasized the unity of Scripture and apostolic tradition. He wrote 'Against Heresies' and taught that Christ recapitulates humanity.","Irenaeus followed Jesus as a teacher. Irenaeus fought Gnosticism and emphasized the unity of Scripture and apostolic tradition.","Key early theologian linking apostles to later Church."],[23,"Saint John Chrysostom","Both","Teacher ‚Ä¢ Early","November 13","Preachers, Rhetoricians","John 'Golden Mouth' preached powerfully about repentance, mercy, and caring for the poor. His liturgy is central in Orthodox worship.","John followed Jesus as a teacher. John 'Golden Mouth' preached powerfully about repentance, mercy, and caring for the poor.","His Divine Liturgy is the most commonly celebrated in Orthodoxy."],[24,"Saint John Paul II","Catholic","Teacher ‚Ä¢ Modern","October 22","Youth, Families, Human dignity","John Paul II emphasized human dignity, forgiveness, and prayer. He supported ecumenical dialogue and encouraged youth to holiness.","John followed Jesus as a teacher. John Paul II emphasized human dignity, forgiveness, and prayer.","Popularized World Youth Day; significant ecumenical outreach."],[25,"Saint Justin Martyr","Both","Martyr ‚Ä¢ Early","June 1","Philosophers, Apologists","Justin was a philosopher who converted to Christianity and defended the faith to Roman authorities. He described early Christian worship and died as a martyr.","Justin followed Jesus as a martyr. Justin was a philosopher who converted to Christianity and defended the faith to Roman authorities.","One of the earliest apologists describing the Mass/Liturgy."],[26,"Saint Macrina the Younger","Both","Teacher ‚Ä¢ Early","July 19","Women, Monastics","Macrina was a sister of Basil the Great and Gregory of Nyssa. She shaped monastic communities and influenced theological thought through her holiness.","Macrina followed Jesus as a teacher. Macrina was a sister of Basil the Great and Gregory of Nyssa.","Influenced Cappadocian Fathers; model of female monastic leadership."],[27,"Saint Monica","Both","Mystic ‚Ä¢ Early","August 27","Mothers, Mothers of difficult children, Widows, Patience, Perseverance in prayer, Difficult children, Suffering mothers, Pray for wayward children","Monica was Augustine's mother. She prayed constantly for his conversion for 12 years. She pursued him across lands, never giving up faith. Her prayers were answered and Augustine became a greatest theologian and saint.","Monica followed Jesus as a mystic. Monica was Augustine's mother.","Shows the power of mother's persevering prayer. Demonstrates grace of conversion."],[28,"Saint Nicholas of Myra","Both","Bishop ‚Ä¢ Early","December 6","Children, Sailors, Gift-givers","Nicholas was known for secret generosity to the poor and courageous faith under persecution. He inspired the later Santa tradition.","Nicholas followed Jesus as a bishop. Nicholas was known for secret generosity to the poor and courageous faith under persecution.","Widely venerated across East and West; source of Santa legends."],[29,"Saint Paul","Both","Apostle ‚Ä¢ Early","June 29","Missionaries, Tentmakers, Conversion, Courage, Writers","Paul persecuted Christians until Christ confronted him on the road to Damascus. He became the great missionary apostle and wrote many New Testament letters.","Paul followed Jesus as a apostle. Paul persecuted Christians until Christ confronted him on the road to Damascus.","His letters shaped Christian theology and mission."],[30,"Saint Peter","Both","Apostle ‚Ä¢ Early","June 29","Fishermen, Popes, Rome","Peter was a fisherman named Simon. Jesus renamed him ‚ÄúRock‚Äù and entrusted him with strengthening the brethren. Peter denied Jesus three times, repented, and became a bold preacher. Tradition holds he was martyred in Rome.","Peter messed up‚Äîbut he said sorry and Jesus still loved him. God helps us start over.","Peter and Paul are celebrated together on June 29 in many traditions."],[31,"Saint Polycarp of Smyrna","Both","Martyr ‚Ä¢ Early","February 23","Hearing, Ear diseases, Healing, Protection against heresy, Courage, Strength, Suffering","Polycarp was a student of Saint John the Apostle who became bishop of Smyrna. At age 86, he was arrested during Roman persecution. He refused to curse Christ. They tried burning him but fire wouldn't consume him, so he was executed by sword.","Polycarp followed Jesus as a martyr. Polycarp was a student of Saint John the Apostle who became bishop of Smyrna.","One of the earliest documented martyrdoms and links to apostolic tradition."],[32,"Saint Teresa of √Åvila","Catholic","Mystic ‚Ä¢ Medieval","October 15","Spiritual directors, Writers, Mystics","Teresa reformed the Carmelite order and wrote classics of mystical prayer. She emphasized interior prayer and friendship with Christ.","Teresa followed Jesus as a mystic. Teresa reformed the Carmelite order and wrote classics of mystical prayer.","Doctor of the Church; major figure in Christian mysticism."],[33,"Saint Th√©r√®se of Lisieux","Catholic","Mystic ‚Ä¢ Modern","October 1","Missionaries, Spiritual depth, Childhood spirituality, Ordinary holiness, Depression, Finding meaning in small things","Th√©r√®se wanted to be a missionary but got tuberculosis and entered a Carmelite convent. She did ordinary things with great love‚Äîthe 'Little Way.' She died at 24 and was canonized in 1925.","Th√©r√®se followed Jesus as a mystic. Th√©r√®se wanted to be a missionary but got tuberculosis and entered a Carmelite convent.","Revolutionized understanding of holiness through ordinary life and small acts."],[34,"Saint Valentine","Both","Martyr ‚Ä¢ Early","February 14","Love, Affection, Young people, Engaged couples, Marriage, Lovers","Saint Valentine's historical identity is unclear. His feast day became associated with love, affection, and courtship. Medieval traditions made him the patron of lovers.","Valentine followed Jesus as a martyr. Saint Valentine's historical identity is unclear.","Shows how uncertain historical figures can embody spiritual truths."],[35,"Saint Vincent de Paul","Catholic","Missionary ‚Ä¢ Medieval","September 27","Charity, Hospitals, The poor, Those seeking charity work, Hospitals, Charitable organizations, Hospices, Sick, Those facing poverty","Vincent was a French priest dedicated to serving the poor. He founded the Vincentians and Daughters of Charity. He worked with prisoners, enslaved people, poor children, and the sick. He revolutionized charitable work.","Vincent followed Jesus as a missionary. Vincent was a French priest dedicated to serving the poor.","Revolutionized charitable work and religious service to the poor."],[36,"Saint Walburga","Both","Healer ‚Ä¢ Medieval","February 25","Women, Healing, Against plague, Strength, Against magic, Leprosy, Skin diseases, Famine, Hunger","Walburga was a nun and missionary. She worked in Germany healing the sick and converting pagans. She became Abbess. After her death, healing oil flowed from her reliquary.","Walburga followed Jesus as a healer. Walburga was a nun and missionary.","Shows healing power continuing after death through saint's intercession."],[37,"Saint Mary, Mother of God (Theotokos)","Both","Mother of Jesus","Aug 15 (Assumption/Dormition)","All Christians","Mary freely said yes to God‚Äôs plan. She carried Christ, raised Him, stood at the Cross, and prayed with the early Church. East and West honor her as Theotokos‚Äî‚ÄúGod-bearer.‚Äù","Mary trusted God even when she didn‚Äôt understand everything. Saying ‚Äúyes‚Äù to God is brave.","Orthodox speak of Dormition; Catholics speak of Assumption‚Äîboth honor her glorification."],[38,"Saint Seraphim of Sarov","Orthodox","Monk, Mystic","January 2","Spiritual direction, joy in Christ","Seraphim lived years in prayer and ascetic struggle. He welcomed visitors with radiant joy, greeting them: ‚ÄúChrist is risen, my joy!‚Äù and taught that the goal of life is acquiring the Holy Spirit.","Seraphim called people ‚Äúmy joy.‚Äù You can spread joy by being kind and praying.","One of the most beloved Russian saints."],[39,"Saint Maria of Paris","Orthodox","Nun, Martyr of Charity","July 20","Mercy and service, Social justice, Refugees, Compassion","A Russian Orthodox nun who served the poor and sheltered Jews during WWII. She was arrested and died in a concentration camp, remembered for courageous love.","Maria helped people in danger‚Äîeven when it was risky. Love can be brave.","Honored as a modern saint of active compassion."],[40,"Saint Nektarios of Aegina","Orthodox","Healer ‚Ä¢ Modern","November 9","Cancer, Healing, Miraculous healings","Nektarios endured slander and hardship, yet remained humble and faithful. He is associated with many healings, especially of cancer.","Nektarios prayed and stayed humble. People ask his prayers for healing.","A modern Orthodox saint known for miracles and humility."],[41,"Saint Paisios of Mount Athos","Orthodox","Healer ‚Ä¢ Modern","July 12","Serious illness, Spiritual direction","Paisios was a modern Athonite monk beloved for compassion and spiritual counsel. Many report healings and answered prayers through his intercession.","Paisios loved people and prayed. You can love people too.","Beloved modern Athonite monk."],[42,"Saint Agatha of Sicily","Both","Martyr ‚Ä¢ Early","February 5","Breast cancer, Breast disease, Women‚Äôs health, Abuse survivors, Nurses","Agatha was an early Christian martyr remembered for courage under persecution and refusal to renounce Christ. She is widely invoked for breast disease and women‚Äôs health.","Agatha was brave and stayed faithful. We ask her prayers for healing and courage.","A major patron saint for breast disease and breast cancer in popular devotion."],[43,"Saint Peregrine Laziosi","Catholic","Healer ‚Ä¢ Medieval","May 4","Cancer, Serious illness, Chronic illness, Caregivers","Peregrine was a Servite priest associated in popular devotion with healing from cancer. Many people ask his prayers when facing serious illness.","Peregrine helps people feel hope when they are sick. Pray and ask God for strength.","Often called a patron saint for those with cancer."],[44,"Servant of God Dorothy Day","Catholic","Witness ‚Ä¢ Modern","November 29","Despair, Suicidal thoughts, Hope, Community, Social justice","Dorothy Day founded the Catholic Worker Movement and is remembered for radical works of mercy.","Dorothy helped poor people and loved Jesus. You can do one kind thing today.","Known for the Catholic Worker Movement."],[45,"Saint Carlo Acutis","Catholic","Witness ‚Ä¢ Modern","October 12","Internet, Technology, Digital ethics, Youth, Leukemia","Carlo was a modern teenager known for joyful faith and using the internet to share devotion.","Carlo loved Jesus and used computers for good. Use your screen time with love.","Sometimes called a patron for internet and digital life."],[46,"Saint Josephine Bakhita","Catholic","Witness ‚Ä¢ Modern","February 8","Human trafficking, Slavery survivors, Trauma healing, Freedom","Bakhita survived slavery and became a religious sister; honored for forgiveness and dignity.","Bakhita shows God can heal deep wounds. Be kind and brave.","A major patron for survivors of trafficking and slavery."],[47,"Saint Pier Giorgio Frassati","Catholic","Witness ‚Ä¢ Modern","July 4","Youth, Social justice, Service, Courage","A young layman known for joy and serving the poor.","Serve with joy.","Beloved patron for youth."],[48,"Saint Paraskeva","Orthodox","Martyr ‚Ä¢ Early","October 14","Women‚Äôs health, Fertility, Protection","Widely venerated Orthodox saint.","Stay faithful.","Venerated in many countries."]];

    const saintsRaw = saintsPacked.map(row => ({
      id: row[0],
      name: row[1],
      tradition: row[2],
      role: row[3],
      feast: row[4],
      patronage: row[5],
      story: row[6],
      kidFriendly: row[7],
      interestingFact: row[8],
    }));

    // Dedupe by (name + tradition) keep richer
    const saintsMap = new Map();
    for (const s of saintsRaw) {
      const key = `${(s.name||'').trim().toLowerCase()}|${(s.tradition||'').trim()}`;
      const existing = saintsMap.get(key);
      if (!existing) { saintsMap.set(key, s); continue; }
      const score = (x) => ((x.story||'').length + (x.patronage||'').length + (x.interestingFact||'').length + (x.kidFriendly||'').length);
      if (score(s) > score(existing)) saintsMap.set(key, s);
    }
    const saints = Array.from(saintsMap.values()).sort((a,b)=> (a.name||'').localeCompare(b.name||'')).map((s,idx)=> ({...s, id: idx+1}));

    const rituals = [
      { id: 1, name: 'The Sign of the Cross', icon: '‚úùÔ∏è',
        catholic: 'Made left to right (forehead, chest, left shoulder, right shoulder), praying: ‚ÄúIn the name of the Father, and of the Son, and of the Holy Spirit.‚Äù',
        orthodox: 'Made right to left (forehead, chest, right shoulder, left shoulder), with three fingers together for the Trinity and two fingers folded for Christ‚Äôs two natures.',
        meaning: 'Both mark the body with Christ‚Äôs redemption and confess the Trinity.',
        history: 'The direction differs by custom across East/West.' },
      { id: 2, name: 'Holy Water: Font vs. Theophany Blessing', icon: 'üíß',
        catholic: 'Often at the entrance as a reminder of baptism; used to bless oneself and homes as a sacramental.',
        orthodox: 'Blessed prominently at Theophany (Christ‚Äôs Baptism). Often taken home and used devotionally.',
        meaning: 'Both see creation sanctified by God.',
        history: 'Different liturgical emphases shaped different common habits.' },
      { id: 3, name: 'Icons vs. Statues', icon: 'üñºÔ∏è',
        catholic: 'Icons and statues are both used; statues are common in the West as devotional art.',
        orthodox: 'Icons are central‚Äîkissed, incensed, carried in procession. Statues are rare in liturgical space.',
        meaning: 'Icons are ‚Äúwindows to heaven,‚Äù tied to the Incarnation.',
        history: 'Icon controversy clarified icon theology and practice.' }
    ];

    const conversations = [
      {
        id: 1,
        title: 'Why Do You Make the Cross Backwards?',
        topic: 'Sign of the Cross',
        tags: ['Gesture', 'Trinity', 'Tradition'],
        speakers: ['Father Dimitri (Orthodox)', 'Mrs. Catherine (Catholic)'],
        context: 'At a church service, Catherine notices Father Dimitri crosses himself right to left.',
        exchange: [
          { speaker: 'Catherine', role: 'Catholic', icon: '‚úùÔ∏è', speech: '‚ÄúFather, I noticed you cross yourself the opposite way from how I do it. I go left to right. Is that‚Ä¶ wrong?‚Äù' },
          { speaker: 'Father Dimitri', role: 'Orthodox', icon: '‚ò¶Ô∏è', speech: '‚ÄúNot wrong at all. Different traditions. We cross right to left‚Äîboth confess the same Trinity.‚Äù' }
        ]
      }
    ];

    const commandments = [
      { num:'1st', catholic:'‚ÄúThou shalt have no other gods before Me.‚Äù', origin:'Given at Mount Sinai as the foundation of covenant freedom.', why:'Protects the heart from idols.', deeper:'Anything ultimate becomes an idol.', kidExplanation:'If something bosses your heart around, it‚Äôs becoming an idol.' }
    ];

    const practices = [
      { id: 1, title: 'Confession: Booth vs. Icon', category: 'Practice',
        content: 'Catholics often confess privately with a screen; Orthodox commonly confess before an icon with the priest nearby. Both seek repentance, healing, and absolution.' }
    ];

    const foundations = [
      { id: 1, title: 'Authority: Pope vs. Councils', icon: 'üëë', description: 'How binding decisions about faith are made.',
        deepDive: 'CATHOLIC: Papal infallibility under specific conditions protects unity.\n\nORTHODOX: Councils discern together.\n\nDINNER TIP: Ask what safeguards keep leaders humble.' }
    ];

    const theologyTopics = [
      { id: 1, title: 'Mary: Immaculate Conception vs. Different Frameworks',
        question: 'Catholics define Mary‚Äôs Immaculate Conception; Orthodox honor Mary deeply but do not frame it the same way. Why?',
        catholicView: 'Mary was preserved from original sin from conception by Christ‚Äôs merits.',
        orthodoxView: 'Different sin framework; caution about late dogmatic definitions; emphasis on Mary‚Äôs free cooperation with grace.',
        sharedTruth: 'Both honor Mary as Theotokos and supremely holy.' }
    ];

    const historyMoments = [
      { id: 1, title: 'One Church, Many Cultures (33‚Äì1054)', year: '33‚Äì1054',
        story: 'East and West were in communion while developing different languages and customs.' }
    ];

    const prayers = [
      { id: 1, title: "The Lord's Prayer", text: 'Our Father... Amen.' },
      { id: 2, title: 'Jesus Prayer', text: 'Lord Jesus Christ, Son of God, have mercy on me, a sinner.' }
    ];

    const dinnerDeck = [
      { topic:'Authority', vibe:'Gentle', kids:'No',
        q:'When you hear ‚ÄúChurch authority,‚Äù what do you hope it protects‚Äîand what do you fear it can harm?',
        ans:'A healthy view of authority protects the Gospel, unity, and pastoral care‚Äîwithout becoming control.',
        bridge:'I‚Äôm not trying to win‚Äî I want to understand what you‚Äôre protecting.',
        follow:'What safeguards keep leaders humble and faithful?' }
    ];

    const cultureCards = [
      {
        title: 'Mass vs Divine Liturgy',
        q: 'Top 7 words you‚Äôll hear (and what they usually mean).',
        top7: [
          '‚ÄúMass‚Äù (Catholic) ‚Äî the Eucharistic service',
          '‚ÄúDivine Liturgy‚Äù (Orthodox) ‚Äî the Eucharistic service',
          '‚ÄúLiturgy‚Äù ‚Äî shorthand for Divine Liturgy in Orthodoxy',
          '‚ÄúVespers‚Äù ‚Äî evening prayer service',
          '‚ÄúMatins/Orthros‚Äù ‚Äî morning prayer service',
          '‚ÄúConfession‚Äù ‚Äî sacramental repentance; form differs',
          '‚ÄúHoly Mysteries‚Äù / ‚ÄúSacraments‚Äù ‚Äî sacred rites'
        ],
        quick: 'If you‚Äôre visiting a Greek parish, say ‚ÄúDivine Liturgy.‚Äù'
      }
    ];

    const cultureDinnerDeck = (() => {
      const vibes = ['Gentle','Lively','Spicy'];
      return vibes.flatMap(v => cultureCards.map(c => ({
        topic:'Culture', vibe:v, kids:'No',
        q:`${c.title} ‚Äî ${c.q}`,
        ans:c.quick,
        bridge:'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow:'What‚Äôs the story behind it in your family?',
        deep:`<div><strong>Top 7:</strong><ol style="padding-left:1.25rem;margin-top:0.5rem;line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      })));
    })();

    const deescalations = [
      'Let‚Äôs pause. I think we‚Äôre both trying to honor Christ. Can we slow down and restate gently?'
    ];

    const unityPrayers = [
      'Lord Jesus Christ, make us one in truth and love. Heal our pride, deepen our repentance, and teach us to listen. Amen.'
    ];

    // ===== Renderers =====
    function renderConversations() {
      const grid = document.getElementById('conversationsGrid');
      const search = (document.getElementById('convSearch')?.value || '').toLowerCase();
      const topic = document.getElementById('convTopic')?.value || 'All';
      const filtered = conversations.filter(c => {
        const matchTopic = topic === 'All' || c.topic === topic;
        const hay = (c.title + ' ' + c.topic + ' ' + (c.tags||[]).join(' ') + ' ' + c.context).toLowerCase();
        return matchTopic && (!search || hay.includes(search));
      });
      const count = document.getElementById('convCount');
      if (count) count.textContent = `${filtered.length} conversation${filtered.length===1?'':'s'}`;
      if (!filtered.length) { grid.innerHTML = emptyState('No conversations match your search.'); return; }
      grid.innerHTML = filtered.map(c => `
        <div class="card" onclick="openModal(event,'conv-${c.id}')">
          <h3 class="card-h3">${escapeHtml(c.title)}</h3>
          <div style="margin-top:0.5rem;"><span class="badge badge-topic">${escapeHtml(c.topic)}</span></div>
          <p class="card-text">${escapeHtml(c.context)}</p>
        </div>
      `).join('');
    }

    function renderCommandments() {
      const container = document.getElementById('commandmentsGrid');
      if (!container) return;
      container.innerHTML = commandments.map(cmd => `
        <div class="ritual-card" onclick="openModal(event,'cmd-${cmd.num}')">
          <div class="ritual-name">${cmd.num} Commandment</div>
          <div class="ritual-desc">${escapeHtml(cmd.catholic)}</div>
        </div>
      `).join('');
    }

    function renderRituals() {
      const container = document.getElementById('ritualsGrid');
      if (!container) return;
      container.innerHTML = rituals.map(r => `
        <div class="ritual-card" onclick="openModal(event,'rit-${r.id}')">
          <div class="ritual-name">${r.icon} ${escapeHtml(r.name)}</div>
          <div class="ritual-desc"><strong>Catholic:</strong> ${escapeHtml(r.catholic)}</div>
        </div>
      `).join('');
    }

    function renderPractices() {
      const grid = document.getElementById('practicesGrid');
      if (!grid) return;
      grid.innerHTML = practices.map(p => `
        <div class="card" onclick="openModal(event,'prac-${p.id}')">
          <h3 class="card-h3">${escapeHtml(p.title)}</h3>
          <p class="card-subtitle">Category: ${escapeHtml(p.category)}</p>
          <p class="card-text">${escapeHtml(p.content)}</p>
        </div>
      `).join('');
    }

    function setSaintSearch(term){
      const input = document.getElementById('saintSearch');
      if (input) input.value = term;
      renderSaints();
    }

    function renderSaints() {
      const chipWrap = document.getElementById('saintChips');
      if (chipWrap && !chipWrap.__built) {
        const chips = ['Cancer','Breast cancer','Anxiety','Sleep','Grief','Mothers','Students','Work','Protection','Healing'];
        chipWrap.innerHTML = chips.map(t => `<button class="pill" style="cursor:pointer;" onclick="setSaintSearch('${t.replace(/'/g,"\\'")}')">${t}</button>`).join('');
        chipWrap.__built = true;
      }

      const grid = document.getElementById('saintsGrid');
      const search = (document.getElementById('saintSearch')?.value || '').toLowerCase();
      const trad = (document.getElementById('tradFilter')?.value || 'All');

      const filtered = saints.filter(s => {
        const hay = ((s.name||'')+' '+(s.role||'')+' '+(s.patronage||'')+' '+(s.story||'')+' '+(s.interestingFact||'')).toLowerCase();
        const matchSearch = !search || hay.includes(search);
        const matchTrad = trad === 'All' || s.tradition === trad;
        return matchSearch && matchTrad;
      });

      const count = document.getElementById('saintsCount');
      if (count) count.textContent = `${filtered.length} saint${filtered.length===1?'':'s'}`;

      if (!filtered.length) { grid.innerHTML = emptyState('No saints match that search/filter.'); return; }

      grid.innerHTML = filtered.map(s => {
        const badgeClass = s.tradition === 'Both' ? 'badge-both' : s.tradition === 'Orthodox' ? 'badge-orthodox' : 'badge-catholic';
        const helps = (s.patronage || '').split(',').map(x=>x.trim()).filter(Boolean).slice(0,4).join(', ') || '‚Äî';
        const more = (s.patronage || '').split(',').map(x=>x.trim()).filter(Boolean).length > 4 ? '‚Ä¶' : '';
        return `
          <div class="card" onclick="openModal(event,'saint-${s.id}')">
            <h3 class="card-h3">${escapeHtml(s.name)}</h3>
            <span class="badge ${badgeClass}">${escapeHtml(s.tradition)}</span>
            <p class="card-subtitle"><strong>Helps with:</strong> ${escapeHtml(helps)}${more}</p>
            <p class="card-subtitle">Role: ${escapeHtml(s.role || '‚Äî')}</p>
            <p class="card-subtitle">Feast: ${escapeHtml(s.feast || '‚Äî')}</p>
            <p class="card-text">${escapeHtml((s.story||'').slice(0,130))}${(s.story||'').length>130?'‚Ä¶':''}</p>
          </div>
        `;
      }).join('');
    }

    function randomSaint(){
      playClick(); haptic();
      const list = saints.slice();
      if (!list.length) return;
      const s = list[Math.floor(Math.random()*list.length)];
      openModal(null, `saint-${s.id}`);
    }

    function renderCulture() {
      const grid = document.getElementById('cultureGrid');
      if (!grid) return;
      grid.innerHTML = cultureCards.map(c => `
        <div class="card" style="cursor:default;">
          <h3 class="card-h3">${escapeHtml(c.title)}</h3>
          <p class="card-text"><strong>Question:</strong> ${escapeHtml(c.q)}</p>
          <details class="shared-box" style="margin-top:0.75rem;">
            <summary style="cursor:pointer; color:#e2e8f0; font-weight:800;">Reveal Top 7</summary>
            <ol style="padding-left:1.25rem; margin-top:0.6rem; color:#cbd5e1; line-height:1.7;">
              ${c.top7.map(x => `<li>${escapeHtml(x)}</li>`).join('')}
            </ol>
            ${c.quick ? `<div class="shared-box" style="margin-top:0.75rem;"><div class="shared-label">Quick answer</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(c.quick)}</div></div>` : ''}
          </details>
        </div>
      `).join('');
    }

    function renderFoundations() {
      const grid = document.getElementById('foundationsGrid');
      if (!grid) return;
      grid.innerHTML = foundations.map(f => `
        <div class="card" onclick="openModal(event,'found-${f.id}')">
          <h3 class="card-h3">${escapeHtml(f.icon)} ${escapeHtml(f.title)}</h3>
          <p class="card-text">${escapeHtml(f.description)}</p>
        </div>
      `).join('');
    }

    function renderTheology() {
      const grid = document.getElementById('theologyGrid');
      if (!grid) return;
      grid.innerHTML = theologyTopics.map(t => `
        <div class="card" onclick="openModal(event,'theo-${t.id}')">
          <h3 class="card-h3">${escapeHtml(t.title)}</h3>
          <p class="card-text">${escapeHtml(t.question)}</p>
        </div>
      `).join('');
    }

    function renderHistory() {
      const grid = document.getElementById('historyGrid');
      if (!grid) return;
      grid.innerHTML = historyMoments.map(h => `
        <div class="card" onclick="openModal(event,'hist-${h.id}')">
          <h3 class="card-h3">${escapeHtml(h.title)}</h3>
          <p class="card-subtitle">${escapeHtml(h.year)}</p>
          <p class="card-text">${escapeHtml(h.story)}</p>
        </div>
      `).join('');
    }

    function renderPrayers() {
      const grid = document.getElementById('prayersGrid');
      if (!grid) return;
      grid.innerHTML = prayers.map(p => `
        <div class="card" onclick="openModal(event,'prayer-${p.id}')">
          <h3 class="card-h3">${escapeHtml(p.title)}</h3>
          <p class="card-text">${escapeHtml(p.text)}</p>
        </div>
      `).join('');
    }

    // ===== Modal =====
    function openModal(event, id) {
      if (event) event.stopPropagation();
      const modal = document.getElementById('modal');
      const content = document.getElementById('modalContent');

      if (id.startsWith('conv-')) {
        const convId = parseInt(id.split('-')[1],10);
        const conv = conversations.find(c=>c.id===convId);
        let h = `<h2>${escapeHtml(conv.title)}</h2>`;
        h += `<div class="context-box"><div class="context-label">Setting</div><p style="margin-top:0.5rem;color:#cbd5e1;">${escapeHtml(conv.context)}</p></div>`;
        h += conv.exchange.map(ex => {
          const iconClass = ex.role === 'Orthodox' ? 'orthodox' : 'catholic';
          return `
            <div style="margin-bottom:1.25rem;">
              <div style="display:flex; align-items:center; margin-bottom:0.5rem;">
                <span class="speaker-icon ${iconClass}">${escapeHtml(ex.icon)}</span>
                <div>
                  <div style="color:#fcd34d; font-weight:800;">${escapeHtml(ex.speaker)}</div>
                  <div style="color:#b45309; font-size:0.85rem;">${escapeHtml(ex.role)}</div>
                </div>
              </div>
              <div class="speech">${escapeHtml(ex.speech)}</div>
            </div>
          `;
        }).join('');
        content.innerHTML = h;
      }
      else if (id.startsWith('cmd-')) {
        const cmdNum = id.split('-')[1];
        const cmd = commandments.find(c=>c.num===cmdNum);
        content.innerHTML = `
          <h2>The ${escapeHtml(cmd.num)} Commandment</h2>
          <p style="color:#cbd5e1; margin-top:0.5rem; font-style:italic;">${escapeHtml(cmd.catholic)}</p>
          <h3>Origin</h3><p>${escapeHtml(cmd.origin)}</p>
          <h3>Why</h3><p>${escapeHtml(cmd.why)}</p>
          <h3>Deeper</h3><p>${escapeHtml(cmd.deeper)}</p>
          <div class="shared-box"><div class="shared-label">For kids</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(cmd.kidExplanation)}</div></div>
        `;
      }
      else if (id.startsWith('rit-')) {
        const rid = parseInt(id.split('-')[1],10);
        const r = rituals.find(x=>x.id===rid);
        content.innerHTML = `
          <h2>${escapeHtml(r.icon)} ${escapeHtml(r.name)}</h2>
          <h3>Catholic</h3><p>${escapeHtml(r.catholic)}</p>
          <h3>Orthodox</h3><p>${escapeHtml(r.orthodox)}</p>
          <h3>Meaning</h3><p>${escapeHtml(r.meaning)}</p>
          <h3>History</h3><p>${escapeHtml(r.history)}</p>
        `;
      }
      else if (id.startsWith('prac-')) {
        const pid = parseInt(id.split('-')[1],10);
        const p = practices.find(x=>x.id===pid);
        content.innerHTML = `<h2>${escapeHtml(p.title)}</h2><p>${escapeHtml(p.content)}</p>`;
      }
      else if (id.startsWith('saint-')) {
        const sid = parseInt(id.split('-')[1],10);
        const s = saints.find(x=>x.id===sid);
        const badgeClass = s.tradition === 'Both' ? 'badge-both' : s.tradition === 'Orthodox' ? 'badge-orthodox' : 'badge-catholic';
        content.innerHTML = `
          <h2>${escapeHtml(s.name)}</h2>
          <span class="badge ${badgeClass}">${escapeHtml(s.tradition)}</span>
          <p class="modal-label">Helps with (Patronage)</p><p>${escapeHtml(s.patronage || '‚Äî')}</p>
          <p class="modal-label">Role</p><p>${escapeHtml(s.role || '‚Äî')}</p>
          <p class="modal-label">Feast Day</p><p>${escapeHtml(s.feast || '‚Äî')}</p>
          <div class="shared-box"><div class="shared-label">Story</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(s.story || '')}</div></div>
          <div class="shared-box"><div class="shared-label">For kids</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(s.kidFriendly || '‚Äî')}</div></div>
          <div class="shared-box"><div class="shared-label">Note</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(s.interestingFact || '‚Äî')}</div></div>
        `;
      }
      else if (id.startsWith('found-')) {
        const fid = parseInt(id.split('-')[1],10);
        const f = foundations.find(x=>x.id===fid);
        content.innerHTML = `<h2>${escapeHtml(f.icon)} ${escapeHtml(f.title)}</h2><p>${escapeHtml(f.description)}</p><div class="shared-box" style="white-space:pre-wrap;">${escapeHtml(f.deepDive)}</div>`;
      }
      else if (id.startsWith('theo-')) {
        const tid = parseInt(id.split('-')[1],10);
        const t = theologyTopics.find(x=>x.id===tid);
        content.innerHTML = `
          <h2>${escapeHtml(t.title)}</h2>
          <h3>The Question</h3><p>${escapeHtml(t.question)}</p>
          <h3>Catholic View</h3><p>${escapeHtml(t.catholicView)}</p>
          <h3>Orthodox View</h3><p>${escapeHtml(t.orthodoxView)}</p>
          <div class="shared-box"><div class="shared-label">What we share</div><div style="color:#cbd5e1;margin-top:0.25rem;">${escapeHtml(t.sharedTruth)}</div></div>
        `;
      }
      else if (id.startsWith('hist-')) {
        const hid = parseInt(id.split('-')[1],10);
        const h = historyMoments.find(x=>x.id===hid);
        content.innerHTML = `<h2>${escapeHtml(h.title)}</h2><p class="modal-label">${escapeHtml(h.year)}</p><p>${escapeHtml(h.story)}</p>`;
      }
      else if (id.startsWith('prayer-')) {
        const pid = parseInt(id.split('-')[1],10);
        const p = prayers.find(x=>x.id===pid);
        content.innerHTML = `<h2>${escapeHtml(p.title)}</h2><div class="shared-box"><div style="color:#cbd5e1;font-style:italic;">${escapeHtml(p.text)}</div></div>`;
      }
      else {
        content.innerHTML = `<h2>Details</h2><p>Open a card to see details.</p>`;
      }

      modal.classList.add('active');
    }

    function closeModal(e) {
      if (!e || e.target.id === 'modal') document.getElementById('modal').classList.remove('active');
    }
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    // ===== Dinner Tool Logic =====
    function getDeepDive(card) {
      const topic = card.topic || 'Any';
      const d = (topic === 'Authority') ? {
        why: 'Authority questions often hide a deeper fear: ‚ÄúWill truth be protected without power becoming abuse?‚Äù',
        mis: 'Most people are protecting something sacred: unity, truth, or conscience.',
        hist: 'First-millennium patterns included both primacy and councils in different ways.',
        gentle: 'Try: ‚ÄúWhat safeguards protect humility and truth?‚Äù'
      } : {
        why: 'Truth with love ‚Äî clarity without contempt.',
        mis: 'Disagreement isn‚Äôt necessarily lack of faith.',
        hist: 'Christians have disagreed since early centuries; saints model humility.',
        gentle: 'Try: ‚ÄúHelp me understand what you mean by that word.‚Äù'
      };
      return `
        <div><strong>Why this matters:</strong> ${escapeHtml(d.why)}</div>
        <div style="margin-top:0.4rem;"><strong>Common misunderstanding:</strong> ${escapeHtml(d.mis)}</div>
        <div style="margin-top:0.4rem;"><strong>History anchor:</strong> ${escapeHtml(d.hist)}</div>
        <div style="margin-top:0.4rem;"><strong>Try saying it like this:</strong> ${escapeHtml(d.gentle)}</div>
      `;
    }

    function getDinnerPool() {
      const topic = document.getElementById('dTopic')?.value || 'Any';
      const vibe  = document.getElementById('dVibe')?.value || 'Gentle';
      const deck = (topic === 'Culture') ? cultureDinnerDeck : dinnerDeck;
      return deck.filter(card => {
        const matchTopic = (topic === 'Any') || (topic === 'Culture') || (card.topic === topic);
        const matchVibe  = card.vibe === vibe;
        return matchTopic && matchVibe;
      });
    }

    function updateDinnerStats() {
      const pool = getDinnerPool();
      const el = document.getElementById('dStats');
      if (!el) return;
      const topic = document.getElementById('dTopic')?.value || 'Any';
      const vibe  = document.getElementById('dVibe')?.value || 'Gentle';
      const kids  = document.getElementById('dKids')?.value || 'No';
      el.textContent = `Deck available: ${pool.length} card${pool.length===1?'':'s'} ‚Ä¢ Topic: ${topic} ‚Ä¢ Vibe: ${vibe} ‚Ä¢ Kids: ${kids}`;
    }

    const dinnerHistory = [];
    let dinnerIndex = -1;

    function pushCard(card){
      if (dinnerIndex < dinnerHistory.length - 1) dinnerHistory.splice(dinnerIndex + 1);
      dinnerHistory.push(card);
      dinnerIndex = dinnerHistory.length - 1;
    }

    function renderDinnerCard(card) {
      const flip = document.getElementById('flipCard');
      const frontKicker = document.getElementById('frontKicker');
      const frontQ = document.getElementById('frontQ');
      const frontMeta = document.getElementById('frontMeta');
      const backBody = document.getElementById('backBody');
      const counter = document.getElementById('cardCounter');
      if (!card || !flip || !frontKicker || !frontQ || !frontMeta || !backBody) return;

      flip.setAttribute('data-topic', card.topic || '');
      flip.classList.remove('flipped');

      if (counter) counter.textContent = `Card ${dinnerIndex >= 0 ? dinnerIndex+1 : 0} / ${dinnerHistory.length}`;

      frontKicker.textContent = `${card.topic} ‚Ä¢ ${card.vibe}`;
      frontQ.innerHTML = `<strong>Question:</strong> ${escapeHtml(card.q)}`;

      const kidsPill = card.kids === 'Yes'
        ? '<span class="pill">üßí Kids-friendly</span>'
        : '<span class="pill" style="border-color:rgba(248,113,113,0.35);">üîû Adults-only</span>';

      frontMeta.innerHTML = `
        <span class="pill">üè∑Ô∏è ${escapeHtml(card.topic)}</span>
        <span class="pill">‚ú® ${escapeHtml(card.vibe)}</span>
        ${kidsPill}
      `;

      const deepOn = !!document.getElementById('deepDiveToggle')?.checked;
      const deepHtml = deepOn ? (card.deep || getDeepDive(card)) : '';

      backBody.innerHTML = `
        <div style="margin-top:0.25rem;"><strong>Answer / Why it matters:</strong> ${escapeHtml(card.ans || '')}</div>
        <div class="shared-box" style="margin-top:0.85rem;">
          <div class="shared-label">Bridge Phrase</div>
          <div style="margin-top:0.25rem;">${escapeHtml(card.bridge || '')}</div>
        </div>
        <div class="shared-box" style="margin-top:0.85rem;">
          <div class="shared-label">Follow-up</div>
          <div style="margin-top:0.25rem;">${escapeHtml(card.follow || '')}</div>
        </div>
        ${deepOn ? `<div class="shared-box" style="margin-top:0.85rem;"><div class="shared-label">Deep Dive</div><div style="margin-top:0.25rem;">${deepHtml}</div></div>` : ''}
      `;
    }

    function drawDinnerCard() {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');

      const pool = getDinnerPool();
      if (!pool.length) {
        const frontQ = document.getElementById('frontQ');
        if (frontQ) frontQ.textContent = 'No cards match your settings. Try switching vibe or topic.';
        const counter = document.getElementById('cardCounter');
        if (counter) counter.textContent = 'Card 0 / 0';
        return;
      }
      const card = pool[Math.floor(Math.random()*pool.length)];
      pushCard(card);
      renderDinnerCard(card);
    }

    function nextDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');

      if (dinnerIndex < dinnerHistory.length - 1) {
        dinnerIndex += 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      } else {
        drawDinnerCard();
      }
    }

    function prevDinnerCard() {
      playClick();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');
      if (dinnerIndex > 0) {
        dinnerIndex -= 1;
        renderDinnerCard(dinnerHistory[dinnerIndex]);
      }
    }

    function flipDinnerCard(force) {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');
      const flip = document.getElementById('flipCard');
      if (!flip) return;
      const want = (force === true) ? true : (force === false) ? false : !flip.classList.contains('flipped');
      if (want) flip.classList.add('flipped'); else flip.classList.remove('flipped');
    }

    function rapidFireCulture() {
      playClick(); haptic();
      if (!Array.isArray(cultureCards) || cultureCards.length === 0) return;

      const c = cultureCards[Math.floor(Math.random() * cultureCards.length)];
      const card = {
        topic: 'Culture',
        vibe: 'Top 7',
        kids: 'No',
        q: `${c.title} ‚Äî ${c.q}`,
        ans: c.quick || 'Quick cue: follow the room.',
        bridge: 'Curiosity first: ‚ÄúTell me how you learned that habit.‚Äù',
        follow: 'What‚Äôs the story behind it in your family?',
        deep: `<div><strong>Top 7:</strong><ol style="padding-left:1.25rem;margin-top:0.5rem;line-height:1.7;">${c.top7.map(x=>`<li>${escapeHtml(x)}</li>`).join('')}</ol></div>`
      };

      const game = document.getElementById('gameCard');
      animateOnce(game, 'deal-animate');

      pushCard(card);
      renderDinnerCard(card);
      setTimeout(()=>flipDinnerCard(true), 80);
    }

    // Shuffle (safe no-op): does NOT change deck/history
    function shuffleDinnerDeck() {
      playClick(); haptic();
      const game = document.getElementById('gameCard');
      animateOnce(game, 'pulse-animate');
      const stats = document.getElementById('dStats');
      if (!stats) return;
      const prev = stats.textContent || '';
      stats.textContent = prev + '  ‚Ä¢  Shuffled';
      setTimeout(()=>{ stats.textContent = prev; }, 900);
    }

    // Reset (real reset): clears history + resets UI
    function resetDinnerDeck() {
      playClick(); haptic();
      dinnerHistory.length = 0;
      dinnerIndex = -1;
      const flip = document.getElementById('flipCard');
      if (flip) flip.classList.remove('flipped');

      const frontKicker = document.getElementById('frontKicker');
      const frontQ = document.getElementById('frontQ');
      const frontMeta = document.getElementById('frontMeta');
      const backBody = document.getElementById('backBody');
      const counter = document.getElementById('cardCounter');

      if (frontKicker) frontKicker.textContent = 'Ready';
      if (frontQ) frontQ.innerHTML = 'Tap <strong>Draw</strong> to deal a card.';
      if (frontMeta) frontMeta.innerHTML = '';
      if (backBody) backBody.innerHTML = '';
      if (counter) counter.textContent = 'Card 0 / 0';

      updateDinnerStats();
    }

    // De-escalate and End with Prayer (now work in the deck)
    function deescalate() {
      playClick(); haptic();
      const msg = deescalations[Math.floor(Math.random()*deescalations.length)];
      const card = {
        topic: 'De-escalate',
        vibe: 'Gentle',
        kids: 'No',
        q: msg,
        ans: 'Tone is the answer here. Slow down, restate gently, and protect love.',
        bridge: '‚ÄúI think we‚Äôre both trying to honor Christ. Can we slow down?‚Äù',
        follow: 'Ask: ‚ÄúWhat‚Äôs the most important thing you want me to understand?‚Äù'
      };
      pushCard(card);
      renderDinnerCard(card);
      setTimeout(()=>flipDinnerCard(true), 80);
    }

    function endWithPrayer() {
      playClick(); haptic();
      const p = unityPrayers[Math.floor(Math.random()*unityPrayers.length)];
      const card = {
        topic: 'Prayer',
        vibe: 'Gentle',
        kids: 'Yes',
        q: 'End with prayer together?',
        ans: p,
        bridge: 'Thank you for sharing honestly.',
        follow: 'Optional: each person names one thing they appreciated about the other‚Äôs faith.'
      };
      pushCard(card);
      renderDinnerCard(card);
      setTimeout(()=>flipDinnerCard(true), 80);
    }

    // Swipe support
    (function bindDinnerSwipe(){
      const el = document.getElementById('gameCard');
      if (!el) return;
      let sx = 0, sy = 0;
      el.addEventListener('touchstart', (e)=>{
        const t = e.touches && e.touches[0];
        if (!t) return;
        sx = t.clientX; sy = t.clientY;
      }, {passive:true});
      el.addEventListener('touchend', (e)=>{
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;
        const dx = t.clientX - sx;
        const dy = t.clientY - sy;
        if (Math.abs(dx) < 45 || Math.abs(dx) < Math.abs(dy)) return;
        if (dx < 0) nextDinnerCard(); else prevDinnerCard();
      }, {passive:true});
    })();

    // Boot
    renderConversations();
    renderCommandments();
    renderRituals();
    renderPractices();
    renderSaints();
    renderCulture();
    renderFoundations();
    renderTheology();
    renderHistory();
    renderPrayers();
    updateDinnerStats();

    // Expose for inline onclick
    Object.assign(window, {
      switchTab,
      renderConversations,
      renderCommandments,
      renderRituals,
      renderPractices,
      renderSaints,
      renderCulture,
      renderFoundations,
      renderTheology,
      renderHistory,
      renderPrayers,
      openModal,
      closeModal,
      setSaintSearch,
      randomSaint,
      drawDinnerCard,
      flipDinnerCard,
      prevDinnerCard,
      nextDinnerCard,
      rapidFireCulture,
      shuffleDinnerDeck,
      resetDinnerDeck,
      deescalate,
      endWithPrayer
    });
  </script>
</body>
</html>
